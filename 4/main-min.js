function initThemeToggle(){const e=document.getElementById("theme-toggle");"dark"===localStorage.getItem("color-theme")||!localStorage.getItem("color-theme")&&window.matchMedia("(prefers-color-scheme: dark)").matches?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),e.addEventListener("click",(function(){document.documentElement.classList.toggle("dark"),document.documentElement.classList.contains("dark")?localStorage.setItem("color-theme","dark"):localStorage.setItem("color-theme","light"),window.editor&&window.editor.updateOptions({theme:document.documentElement.classList.contains("dark")?"vs-dark":"vs"})}))}function initEnhancedTabs(){console.log("Initializing vanilla JS tabs");const e=document.querySelectorAll('#default-tab button[role="tab"]'),t=document.querySelectorAll('#default-tab-content > div[role="tabpanel"]');if(0!==e.length&&0!==t.length)try{!function(){let t="file-tab";const r=localStorage.getItem("activeTab");r&&document.getElementById(r)&&(t=r),e.forEach((e=>{e.addEventListener("click",(()=>{n(e.id)}))})),n(t)}()}catch(n){console.error("Error initializing tabs:",n);const r=e[0];if(r){const e=r.getAttribute("data-tabs-target"),n=document.querySelector(e);n&&(t.forEach((e=>{e.classList.add("hidden")})),n.classList.remove("hidden"),r.setAttribute("aria-selected","true"),r.classList.add("text-blue-600","border-blue-600"),r.classList.remove("border-transparent"))}}else console.error("No tab elements found");function n(n){const r=document.getElementById(n);if(!r)return void console.warn(`Tab button ${n} not found`);const o=r.getAttribute("data-tabs-target")?.substring(1);if(!o)return void console.warn(`Tab target for ${n} not found`);localStorage.setItem("activeTab",n),t.forEach((e=>{e.classList.add("hidden"),e.classList.remove("animate-fadeIn")})),e.forEach((e=>{e.setAttribute("aria-selected","false"),e.classList.remove("text-blue-600","border-blue-600"),e.classList.add("border-transparent")})),r.setAttribute("aria-selected","true"),r.classList.add("text-blue-600","border-blue-600"),r.classList.remove("border-transparent");const a=document.getElementById(o);a&&(a.classList.remove("hidden"),a.classList.add("animate-fadeIn")),function(e){const t=document.querySelector(".mb-4.border-b.border-gray-200.dark\\:border-gray-700"),n=document.getElementById("breadcrumbs");t&&n&&("terminal"===e||"config"===e||"setting"===e?(t.classList.add("hidden"),n.classList.add("hidden")):(t.classList.remove("hidden"),n.classList.remove("hidden")))}(o),"function"==typeof handleTabSwitch&&handleTabSwitch("#"+o),console.log(`Tab activated: ${n} -> #${o}`)}}function initSettings(){loadSettings(),document.getElementById("light-theme-btn")?.addEventListener("click",(()=>{document.documentElement.classList.remove("dark"),localStorage.setItem("color-theme","light"),updateEditorTheme("vs")})),document.getElementById("dark-theme-btn")?.addEventListener("click",(()=>{document.documentElement.classList.add("dark"),localStorage.setItem("color-theme","dark"),updateEditorTheme("vs-dark")})),document.getElementById("system-theme-btn")?.addEventListener("click",(()=>{localStorage.removeItem("color-theme"),window.matchMedia("(prefers-color-scheme: dark)").matches?(document.documentElement.classList.add("dark"),updateEditorTheme("vs-dark")):(document.documentElement.classList.remove("dark"),updateEditorTheme("vs"))}));const e=document.getElementById("font-size");e&&e.addEventListener("input",(e=>{const t=e.target.value;document.documentElement.style.fontSize=t+"px",localStorage.setItem("font-size",t)}));const t=document.getElementById("terminal-font-size");t&&t.addEventListener("input",(e=>{const t=e.target.value,n=document.querySelector("terminal content");n&&(n.style.fontSize=t+"px"),localStorage.setItem("terminal-font-size",t)}));const n=document.getElementById("enable-animations");n&&n.addEventListener("change",(e=>{document.body.classList.toggle("disable-animations",!e.target.checked),localStorage.setItem("enable-animations",e.target.checked)}));const r=document.getElementById("show-hidden");r&&r.addEventListener("change",(e=>{localStorage.setItem("show-hidden-files",e.target.checked),loadDirectory(currentDir,1,csrf,key,isEnc)}));const o=document.getElementById("show-file-size");o&&o.addEventListener("change",(e=>{localStorage.setItem("show-file-size",e.target.checked),loadDirectory(currentDir,1,csrf,key,isEnc)}));const a=document.getElementById("show-file-date");a&&a.addEventListener("change",(e=>{localStorage.setItem("show-file-date",e.target.checked),loadDirectory(currentDir,1,csrf,key,isEnc)}));const i=document.getElementById("default-sort");i&&i.addEventListener("change",(e=>{localStorage.setItem("default-sort",e.target.value),loadDirectory(currentDir,1,csrf,key,isEnc)}));const s=document.getElementById("terminal-wrap");s&&s.addEventListener("change",(e=>{localStorage.setItem("terminal-wrap",e.target.checked),window.terminal&&window.terminal.setOption("wrap",e.target.checked)}));const l=document.getElementById("terminal-bell");l&&l.addEventListener("change",(e=>{localStorage.setItem("terminal-bell",e.target.checked),window.terminal&&window.terminal.setOption("bellStyle",e.target.checked?"sound":"none")}));const c=document.getElementById("terminal-theme");c&&c.addEventListener("change",(e=>{localStorage.setItem("terminal-theme",e.target.value),window.terminal&&window.terminal.setOption("theme",e.target.value)}));const d=document.getElementById("editor-theme");d&&d.addEventListener("change",(e=>{const t=e.target.value;"system"===t?(updateEditorTheme(window.matchMedia("(prefers-color-scheme: dark)").matches?"vs-dark":"vs"),localStorage.setItem("editor-theme","system")):(updateEditorTheme(t),localStorage.setItem("editor-theme",t))}));const u=document.getElementById("tab-size");u&&u.addEventListener("change",(e=>{const t=e.target.value;window.editor&&window.editor.setOption("tabSize",parseInt(t)),localStorage.setItem("tab-size",t)}));const g=document.getElementById("word-wrap");g&&g.addEventListener("change",(e=>{window.editor&&window.editor.setOption("lineWrapping",e.target.checked),localStorage.setItem("word-wrap",e.target.checked)}));const m=document.getElementById("auto-close-brackets");m&&m.addEventListener("change",(e=>{window.editor&&window.editor.setOption("autoCloseBrackets",e.target.checked),localStorage.setItem("auto-close-brackets",e.target.checked)}));const f=document.getElementById("highlight-active-line");f&&f.addEventListener("change",(e=>{window.editor&&window.editor.setOption("styleActiveLine",e.target.checked),localStorage.setItem("highlight-active-line",e.target.checked)}));const p=document.getElementById("default-items");p&&p.addEventListener("change",(e=>{const t=e.target.value;localStorage.setItem("default-items-per-page",t);const n=document.getElementById("itemLimit");if(n){n.value=t;const e=new Event("change");n.dispatchEvent(e)}})),document.getElementById("save-settings")?.addEventListener("click",(()=>{saveSettings(),triggerAlert("success","Settings saved successfully!")}))}function loadSettings(){const e=localStorage.getItem("font-size")||"14";document.documentElement.style.fontSize=e+"px";const t=document.getElementById("font-size");t&&(t.value=e);const n=localStorage.getItem("terminal-font-size")||"14",r=document.querySelector("terminal content");r&&(r.style.fontSize=n+"px");const o=document.getElementById("terminal-font-size");o&&(o.value=n);const a="false"!==localStorage.getItem("enable-animations");document.body.classList.toggle("disable-animations",!a);const i=document.getElementById("enable-animations");i&&(i.checked=a);const s="true"===localStorage.getItem("show-hidden-files"),l=document.getElementById("show-hidden");l&&(l.checked=s);const c="false"!==localStorage.getItem("show-file-size"),d=document.getElementById("show-file-size");d&&(d.checked=c);const u="false"!==localStorage.getItem("show-file-date"),g=document.getElementById("show-file-date");g&&(g.checked=u);const m=localStorage.getItem("default-sort")||"date-desc",f=document.getElementById("default-sort");f&&(f.value=m);const p="false"!==localStorage.getItem("terminal-wrap"),h=document.getElementById("terminal-wrap");h&&(h.checked=p);const y="true"===localStorage.getItem("terminal-bell"),b=document.getElementById("terminal-bell");b&&(b.checked=y);const w=localStorage.getItem("terminal-theme")||"default",v=document.getElementById("terminal-theme");v&&(v.value=w);const x=localStorage.getItem("editor-theme")||"system",k=document.getElementById("editor-theme");k&&(k.value=x);const S=localStorage.getItem("tab-size")||"4",E=document.getElementById("tab-size");E&&(E.value=S);const I="false"!==localStorage.getItem("word-wrap"),L=document.getElementById("word-wrap");L&&(L.checked=I);const A="false"!==localStorage.getItem("auto-close-brackets"),B=document.getElementById("auto-close-brackets");B&&(B.checked=A);const T="false"!==localStorage.getItem("highlight-active-line"),M=document.getElementById("highlight-active-line");M&&(M.checked=T);const F=localStorage.getItem("default-items-per-page")||"50",$=document.getElementById("default-items");$&&($.value=F);const C=document.getElementById("itemLimit");C&&F&&(C.value=F)}function saveSettings(){const e=document.getElementById("font-size");e&&localStorage.setItem("font-size",e.value);const t=document.getElementById("terminal-font-size");t&&localStorage.setItem("terminal-font-size",t.value);const n=document.getElementById("enable-animations");n&&localStorage.setItem("enable-animations",n.checked);const r=document.getElementById("show-hidden");r&&localStorage.setItem("show-hidden-files",r.checked);const o=document.getElementById("show-file-size");o&&localStorage.setItem("show-file-size",o.checked);const a=document.getElementById("show-file-date");a&&localStorage.setItem("show-file-date",a.checked);const i=document.getElementById("default-sort");i&&localStorage.setItem("default-sort",i.value);const s=document.getElementById("terminal-wrap");s&&localStorage.setItem("terminal-wrap",s.checked);const l=document.getElementById("terminal-bell");l&&localStorage.setItem("terminal-bell",l.checked);const c=document.getElementById("terminal-theme");c&&localStorage.setItem("terminal-theme",c.value);const d=document.getElementById("editor-theme");d&&localStorage.setItem("editor-theme",d.value);const u=document.getElementById("tab-size");u&&localStorage.setItem("tab-size",u.value);const g=document.getElementById("word-wrap");g&&localStorage.setItem("word-wrap",g.checked);const m=document.getElementById("auto-close-brackets");m&&localStorage.setItem("auto-close-brackets",m.checked);const f=document.getElementById("highlight-active-line");f&&localStorage.setItem("highlight-active-line",f.checked);const p=document.getElementById("default-items");p&&localStorage.setItem("default-items-per-page",p.value)}function updateEditorTheme(e){window.editorThemePreference=e;let t="eclipse";if(("vs-dark"===e||"system"===e&&window.matchMedia("(prefers-color-scheme: dark)").matches)&&(t="dracula"),window.editor&&"function"==typeof window.editor.setOption)try{window.editor.setOption("theme",t);const e=document.getElementById("editorContainer");e&&("dracula"===t?(e.classList.add("dark-editor"),e.classList.remove("light-editor")):(e.classList.add("light-editor"),e.classList.remove("dark-editor")));const n=document.getElementById("editorStatus");n&&("dracula"===t?(n.classList.add("dark-status"),n.classList.remove("light-status")):(n.classList.add("light-status"),n.classList.remove("dark-status"))),console.log("Editor theme updated to:",t)}catch(e){console.error("Error updating editor theme:",e)}else console.log("CodeMirror editor not available, theme will be applied when editor loads")}function initGlobalKeyboardShortcuts(){const e=[{key:"Delete",action:"Delete selected files"},{key:"Ctrl+A",action:"Select all files"},{key:"Ctrl+C",action:"Copy selected files"},{key:"Ctrl+X",action:"Cut selected files"},{key:"Ctrl+V",action:"Paste files"},{key:"Alt+F",action:"Search files"},{key:"F2",action:"Rename selected file"},{key:"F5",action:"Refresh directory"},{key:"Alt+Up",action:"Navigate to parent directory"},{key:"Escape",action:"Deselect all files / Close dialogs"},{key:"?",action:"Show this help dialog"}];function t(){let t='<div class="overflow-x-auto"><table class="w-full text-sm text-left">';t+='<thead class="text-xs uppercase bg-gray-100 dark:bg-gray-700"><tr><th class="px-6 py-3">Key</th><th class="px-6 py-3">Action</th></tr></thead><tbody>',e.forEach((e=>{t+=`<tr class="border-b dark:border-gray-700"><td class="px-6 py-4 font-medium">${e.key}</td><td class="px-6 py-4">${e.action}</td></tr>`})),t+="</tbody></table></div>",Swal.fire({title:"Keyboard Shortcuts",html:t,customClass:{popup:"dark:bg-gray-800 dark:text-white"}})}const n=document.getElementById("keyboardShortcutsBtn");n&&n.addEventListener("click",t),document.addEventListener("keydown",(function(e){if("INPUT"===e.target.tagName||"TEXTAREA"===e.target.tagName||e.target.classList.contains("CodeMirror")||document.querySelector("#terminal:not(.hidden)"))return;if(!window.fileManagerState)return void console.error("fileManagerState is not initialized");const n=window.fileManagerState?.currentDir||phpVars?.currentDir,r=phpVars?.csrf,o=phpVars?.encryptionKey?CryptoJS.enc.Utf8.parse(phpVars.encryptionKey):null,a=phpVars?.isEnc;window.fileManagerState.selectedFiles||(window.fileManagerState.selectedFiles=[]);const i=window.fileManagerState.selectedFiles||[];switch(!0){case"Delete"===e.key:if(console.log("Delete key pressed, selected files:",i.length),i.length>0){if(e.preventDefault(),"INPUT"===document.activeElement.tagName||"TEXTAREA"===document.activeElement.tagName||document.activeElement.isContentEditable)return;const t=[...i];window.showConfirmation("Delete Files",`Are you sure you want to delete ${t.length} file(s)?`,"Delete",(()=>{console.log("Files to delete:",t),"function"==typeof window.sendBulkActionRequest?window.sendBulkActionRequest({action:"delete",files:t,onSuccess:()=>{"function"==typeof window.clearFileSelection&&window.clearFileSelection(),window.triggerAlert("success","Files deleted successfully"),window.loadDirectory(n,1,r,o,a)}}):window.performBulkAction("delete",t,n,r,o,a)}))}break;case e.ctrlKey&&"a"===e.key:console.log("Alt+A pressed"),e.preventDefault();const s=document.querySelectorAll(".file-checkbox"),l=document.getElementById("selectAll");s.forEach((e=>{e.checked=!0,window.updateSelectedFiles(e.dataset.file,!0)})),l&&(l.checked=!0),window.triggerAlert("info",`Selected ${s.length} file(s)`);break;case e.ctrlKey&&"c"===e.key:if(console.log("Alt+C pressed, selected files:",i.length),i.length>0){e.preventDefault();const t=i.map((e=>e.includes("/")?e:`${n}/${e}`));"function"==typeof window.saveToLocalStorage?(window.saveToLocalStorage(t),localStorage.removeItem("clipboard-action"),window.triggerAlert("success",`Copied ${i.length} file(s) to clipboard`)):(console.error("saveToLocalStorage function not found"),window.triggerAlert("warning","Copy operation failed"))}break;case e.Ctrl&&"x"===e.key:if(console.log("Alt+X pressed, selected files:",i.length),i.length>0){e.preventDefault();const t=i.map((e=>e.includes("/")?e:`${n}/${e}`));"function"==typeof window.saveToLocalStorage?(window.saveToLocalStorage(t),localStorage.setItem("clipboard-action","cut"),window.triggerAlert("info",`Cut ${i.length} file(s) to clipboard`)):(console.error("saveToLocalStorage function not found"),window.triggerAlert("warning","Cut operation failed"))}break;case e.Ctrl&&"v"===e.key:if(console.log("Alt+V pressed"),e.preventDefault(),"function"==typeof window.getFromLocalStorage){const e=window.getFromLocalStorage();e&&e.length>0?(console.log("Pasting files:",e),console.log("Current directory:",n),window.triggerAlert("info",`Pasting ${e.length} item(s)...`),"function"==typeof window.sendBulkActionRequest?window.sendBulkActionRequest({action:"paste",files:e,onSuccess:()=>{"function"==typeof window.clearFileSelection&&window.clearFileSelection(),window.triggerAlert("success","Files pasted successfully"),window.loadDirectory(n,1,r,o,a),"cut"===localStorage.getItem("clipboard-action")&&("function"==typeof window.freeclipbroad&&window.freeclipbroad(),localStorage.removeItem("clipboard-action"))}}):(window.performBulkAction("paste",e,n,r,o,a),"cut"===localStorage.getItem("clipboard-action")&&("function"==typeof window.freeclipbroad&&window.freeclipbroad(),localStorage.removeItem("clipboard-action")))):window.triggerAlert("warning","No items in clipboard")}else console.error("getFromLocalStorage function not found"),window.triggerAlert("warning","Paste operation failed");break;case e.altKey&&"f"===e.key:if(console.log("Alt+F pressed"),e.preventDefault(),"function"==typeof window.showAdvancedSearch)window.showAdvancedSearch();else{const e=document.getElementById("searchInput");e?e.focus():window.triggerAlert("info","Search function not available")}break;case"F2"===e.key:console.log("F2 pressed, selected files:",i.length),1===i.length?(e.preventDefault(),window.renameFile(i[0],r,n,o,a)):i.length>1&&window.triggerAlert("warning","Please select only one file to rename");break;case"F5"===e.key:console.log("F5 pressed"),e.preventDefault();let c=document.getElementById("itemLimit"),d=c?c.value:"50";window.loadDirectory(n,1,r,o,a,d),window.triggerAlert("info","Refreshing Files...");break;case e.altKey&&"ArrowUp"===e.key:console.log("Alt+Up pressed"),e.preventDefault();const u=(window.fileManagerState?.currentDir||phpVars?.currentDir||"/").split("/").filter((e=>""!==e));u.pop();const g=u.length>0?"/"+u.join("/"):"/",m=document.getElementById("itemLimit"),f=m?m.value:"50";window.loadDirectory(g,1,phpVars.csrf,phpVars.encryptionKey?CryptoJS.enc.Utf8.parse(phpVars.encryptionKey):null,phpVars.isEnc,f),"function"==typeof window.updateActiveTabPath&&window.updateActiveTabPath(g),window.fileManagerState&&(window.fileManagerState.currentDir=g),window.triggerAlert("info","Navigated to parent directory");break;case"Escape"===e.key:console.log("Escape pressed");const p=document.querySelector(".modal:not(.hidden)"),h=document.querySelector("#context-menu:not(.hidden)");if(p||h)return;e.preventDefault(),document.querySelectorAll(".file-checkbox").forEach((e=>{e.checked=!1}));const y=document.getElementById("selectAll");y&&(y.checked=!1),window.fileManagerState.selectedFiles=[],window.triggerAlert("info","Deselected all files");break;case"?"===e.key:console.log("? key pressed"),e.preventDefault(),t();break}}))}function exposeUtilityFunctions(){window.updateSelectedFiles="function"==typeof updateSelectedFiles?updateSelectedFiles:function(){console.error("updateSelectedFiles not found")},window.updateBreadcrumbs="function"==typeof updateBreadcrumbs?updateBreadcrumbs:function(e){},window.showAdvancedSearch=function(){if(!window.phpVars)return console.error("phpVars not found"),void triggerAlert("danger","Required configuration is missing. Please refresh the page and try again.");const e=addNewTab("Advanced Search","search");switchToTab(e);const t=document.getElementById(`${e}-content`);if(!t)return void console.error("Search tab content not found");t.innerHTML="";const n=document.createElement("div");n.className="search-form bg-white dark:bg-gray-800 p-4 rounded-lg shadow mb-4",n.innerHTML=`\n            <h2 class="text-xl font-semibold mb-4 text-gray-800 dark:text-white">Advanced Search</h2>\n            <form id="advanced-search-form" class="space-y-4" onsubmit="event.preventDefault(); performAdvancedSearch(); return false;">\n                \x3c!-- Search Mode Selector --\x3e\n                <div class="mb-6">\n                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Search Mode</label>\n                    <div class="flex space-x-4">\n                        <label class="inline-flex items-center">\n                            <input type="radio" name="search-mode" value="text" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300" checked onchange="toggleSearchMode('text')">\n                            <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">Text Search</span>\n                        </label>\n                        <label class="inline-flex items-center">\n                            <input type="radio" name="search-mode" value="permission" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300" onchange="toggleSearchMode('permission')">\n                            <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">Permission Search</span>\n                        </label>\n                    </div>\n                </div>\n\n                \x3c!-- Common Settings --\x3e\n                <div class="mb-4">\n                    <div>\n                        <label for="search-path" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Search Path</label>\n                        <input type="text" id="search-path" name="search-path" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="Directory path" value="${window.fileManagerState?.currentDir||"."}">\n                    </div>\n                </div>\n\n                \x3c!-- Text Search Section --\x3e\n                <div id="text-search-section" class="space-y-4">\n                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">\n                        <div>\n                            <label for="search-query" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Search Query</label>\n                            <input type="text" id="search-query" name="search-query" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="Enter search text or pattern">\n                        </div>\n                    <div>\n                        <label for="file-extensions" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">File Extensions</label>\n                        <input type="text" id="file-extensions" name="file-extensions" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="e.g. php,js,html,css">\n                    </div>\n                    </div>\n\n                    <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">\n                        <h3 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">Text Search Options</h3>\n                        <div class="space-y-2">\n                        <div class="flex items-center">\n                            <input type="checkbox" id="case-sensitive" name="case-sensitive" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">\n                            <label for="case-sensitive" class="ml-2 block text-sm text-gray-700 dark:text-gray-300">Case Sensitive</label>\n                        </div>\n                        <div class="flex items-center">\n                            <input type="checkbox" id="use-regex" name="use-regex" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">\n                            <label for="use-regex" class="ml-2 block text-sm text-gray-700 dark:text-gray-300">Use Regex</label>\n                        </div>\n                        </div>\n                    </div>\n                </div>\n\n                \x3c!-- Permission Search Section --\x3e\n                <div id="permission-search-section" class="space-y-4 hidden">\n                    <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">\n                        <h3 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">Permission Filters</h3>\n                        <div class="space-y-2">\n                        <div class="flex items-center">\n                            <input type="checkbox" id="writable-only" name="writable-only" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">\n                            <label for="writable-only" class="ml-2 block text-sm text-gray-700 dark:text-gray-300">Writable Files Only</label>\n                        </div>\n                            <div class="flex items-center">\n                                <input type="checkbox" id="writable-folders" name="writable-folders" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">\n                                <label for="writable-folders" class="ml-2 block text-sm text-gray-700 dark:text-gray-300">Writable Folders Only</label>\n                            </div>\n                            <div class="flex items-center">\n                                <input type="checkbox" id="executable-only" name="executable-only" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">\n                                <label for="executable-only" class="ml-2 block text-sm text-gray-700 dark:text-gray-300">Executable Files</label>\n                            </div>\n                            <div class="flex items-center">\n                                <input type="checkbox" id="suid-binaries" name="suid-binaries" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">\n                                <label for="suid-binaries" class="ml-2 block text-sm text-gray-700 dark:text-gray-300">SUID Binaries</label>\n                            </div>\n                            <div class="flex items-center">\n                                <input type="checkbox" id="include-hidden" name="include-hidden" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">\n                                <label for="include-hidden" class="ml-2 block text-sm text-gray-700 dark:text-gray-300">Include Hidden Files/Folders</label>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                \x3c!-- Common Options --\x3e\n                <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">\n                    <h3 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">Search Settings</h3>\n                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">\n                        <div>\n                            <label for="max-results" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Max Results</label>\n                            <input type="number" id="max-results" name="max-results" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" value="1000" min="10" max="10000">\n                        </div>\n                        <div>\n                            <label for="batch-size" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Batch Size</label>\n                            <input type="number" id="batch-size" name="batch-size" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" value="200" min="50" max="1000" title="Number of files to process per batch">\n                        </div>\n                        <div class="flex items-center pt-6">\n                            <input type="checkbox" id="recursive-search" name="recursive-search" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded" checked>\n                            <label for="recursive-search" class="ml-2 block text-sm text-gray-700 dark:text-gray-300">Recursive Search</label>\n                        </div>\n                    </div>\n                </div>\n                <div class="flex justify-end">\n                    <button type="submit" class="inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">\n                        <svg class="mr-2 -ml-1 h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">\n                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />\n                        </svg>\n                        Search\n                    </button>\n                </div>\n            </form>\n        `;const r=document.createElement("div");r.id="search-results-container",r.className="search-results bg-white dark:bg-gray-800 p-4 rounded-lg shadow",r.innerHTML='\n            <div class="flex justify-between items-center mb-4">\n                <h2 class="text-xl font-semibold text-gray-800 dark:text-white">Search Results</h2>\n                <div id="search-stats" class="text-sm text-gray-500 dark:text-gray-400"></div>\n            </div>\n            <div id="search-results" class="space-y-4">\n                <div class="text-gray-500 dark:text-gray-400 text-center py-8">Enter a search query and click Search</div>\n            </div>\n        ',t.appendChild(n),t.appendChild(r);const o=document.getElementById("advanced-search-form");o&&o.addEventListener("submit",(function(e){return e.preventDefault(),performAdvancedSearch(),!1}))},window.toggleSearchMode=function(e){const t=document.getElementById("text-search-section"),n=document.getElementById("permission-search-section"),r=document.getElementById("search-query");"text"===e?(t.classList.remove("hidden"),n.classList.add("hidden"),r.setAttribute("required","")):(t.classList.add("hidden"),n.classList.remove("hidden"),r.removeAttribute("required"))},window.performAdvancedSearch=function(e=null){const t=document.querySelector('input[name="search-mode"]:checked').value,n=document.getElementById("search-path")?.value||".",r=document.getElementById("file-extensions")?.value||"",o=document.getElementById("max-results")?.value||1e3,a=document.getElementById("recursive-search")?.checked||!0,i=parseInt(document.getElementById("batch-size")?.value||"200",10),s=document.getElementById("search-query")?.value||"",l=document.getElementById("case-sensitive")?.checked||!1,c=document.getElementById("use-regex")?.checked||!1,d=document.getElementById("writable-only")?.checked||!1,u=document.getElementById("writable-folders")?.checked||!1,g=document.getElementById("executable-only")?.checked||!1,m=document.getElementById("suid-binaries")?.checked||!1,f=document.getElementById("include-hidden")?.checked||!1;if("text"===t&&!s&&!e)return void triggerAlert("warning","Please enter a search query for text search");if(!("permission"!==t||d||u||g||m))return void triggerAlert("warning","Please select at least one permission filter");if(!e){const e=(p=n)&&""!==p.trim()?(p.startsWith("/")&&console.warn("Using absolute path for search: "+p),{valid:!0}):{valid:!1,message:"Search path cannot be empty"};if(!e.valid)return void triggerAlert("warning",e.message)}var p;const h=window.phpVars?.csrf||"",y=window.phpVars?.encryptionKey||"",b=window.phpVars?.isEnc||!1;if(!h)return console.error("CSRF token not found in phpVars"),void triggerAlert("danger","Security token missing. Please refresh the page and try again.");const w=document.getElementById("search-results");if(w&&!e?(w.innerHTML='\n                <div class="flex justify-center items-center py-8">\n                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"></div>\n                    <span class="ml-2 text-gray-600 dark:text-gray-300">Searching...</span>\n                </div>\n            ',window.currentSearch={query:s,path:n,extensions:r,maxResults:o,caseSensitive:l,useRegex:c,recursive:a,writableOnly:d,writableFolders:u,executableOnly:g,suidBinaries:m,includeHidden:f,results:{},totalMatches:0}):e||(window.currentSearch={query:s,path:n,extensions:r,maxResults:o,caseSensitive:l,useRegex:c,recursive:a,writableOnly:d,writableFolders:u,executableOnly:g,suidBinaries:m,includeHidden:f,results:{},totalMatches:0}),e){const e=document.getElementById("search-progress");e&&(e.innerHTML='\n                    <div class="flex items-center">\n                        <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-blue-500 mr-2"></div>\n                        <span>Continuing search...</span>\n                    </div>\n                ')}console.log("Sending advanced search request:",{searchQuery:s,searchPath:n,fileExtensions:r,maxResults:o,caseSensitive:l,useRegex:c,recursive:a,writableOnly:d,writableFolders:u,executableOnly:g,suidBinaries:m,includeHidden:f,searchToken:e,batchSize:i});let v=y;"1"===b&&"string"==typeof y&&(v=CryptoJS.enc.Utf8.parse(y),console.log("Using formatted encryption key for advanced search")),sendRequest({csrf:h,action:"advanced_search",search_mode:t,search_query:"text"===t?s:"",search_path:n,file_extensions:r,max_results:o,case_sensitive:l,use_regex:c,recursive:a,writable_only:d,writable_folders:u,executable_only:g,suid_binaries:m,include_hidden:f,search_token:e,batch_size:i},v,b).then((t=>{console.log("Search response received:",t),displaySearchResults(t,null!==e)})).catch((e=>{console.error("Search error:",e),w&&(w.innerHTML=`\n                    <div class="text-red-500 dark:text-red-400 text-center py-4">\n                        Error: ${e.message||"Failed to perform search"}\n                    </div>\n                    <div class="mt-4 p-4 bg-red-50 dark:bg-red-900 border border-red-200 dark:border-red-800 rounded-md">\n                        <h3 class="font-medium text-red-800 dark:text-red-300 mb-2">Troubleshooting tips:</h3>\n                        <ul class="list-disc pl-5 text-sm text-red-700 dark:text-red-400 space-y-1">\n                            <li>Check if the search path exists and is accessible</li>\n                            <li>Try using a relative path like "./subdirectory" instead of an absolute path</li>\n                            <li>If using regex, verify your pattern is valid</li>\n                            <li>Try reducing the batch size if searching many files</li>\n                            <li>Check browser console for more detailed error information</li>\n                        </ul>\n                    </div>\n                `),triggerAlert("danger","Search failed: "+(e.message||"Unknown error"))}))},window.displaySearchResults=function(e,t=!1){const n=document.getElementById("search-results"),r=document.getElementById("search-stats");if(!n)return void console.error("Results container not found");if(e.error)return void(n.innerHTML=`\n                <div class="text-red-500 dark:text-red-400 text-center py-4">\n                    Error: ${e.error}\n                </div>\n            `);if(t&&window.currentSearch?(Object.assign(window.currentSearch.results,e.results),window.currentSearch.totalMatches=e.total_matches):(window.currentSearch||(window.currentSearch={}),window.currentSearch.results=e.results,window.currentSearch.totalMatches=e.total_matches),r&&(r.textContent=`Found ${window.currentSearch.totalMatches} matches in ${Object.keys(window.currentSearch.results).length} files`,e.memory_limit_reached&&(r.innerHTML+='\n                    <div class="mt-2 text-amber-600 dark:text-amber-400">\n                        <svg class="inline-block w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>\n                        </svg>\n                        Search was truncated due to memory limits. Try narrowing your search or searching in smaller directories.\n                    </div>\n                '),!e.search_complete)){const t=e.files_remaining||0,n=e.files_processed||0,o=n+t,a=o>0?Math.round(n/o*100):0;r.innerHTML+=`\n                    <div id="search-progress" class="mt-2">\n                        <div class="flex items-center justify-between mb-1">\n                            <span class="text-sm text-gray-700 dark:text-gray-300">\n                                Processed ${n} of ${o} files (${a}%)\n                            </span>\n                        </div>\n                        <div class="w-full bg-gray-200 rounded-full h-2.5 dark:bg-gray-700">\n                            <div class="bg-blue-600 h-2.5 rounded-full" style="width: ${a}%"></div>\n                        </div>\n                        <div class="flex justify-between mt-2">\n                            <div class="flex items-center">\n                                <input type="checkbox" id="auto-continue-search" class="mr-2">\n                                <label for="auto-continue-search" class="text-sm text-gray-700 dark:text-gray-300">Auto-continue</label>\n                            </div>\n                            <button id="continue-search" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 dark:bg-blue-600 dark:hover:bg-blue-700">\n                                Continue Search\n                            </button>\n                        </div>\n                    </div>\n                `}if(0===window.currentSearch.totalMatches&&e.search_complete)return void(n.innerHTML=`\n                <div class="text-gray-500 dark:text-gray-400 text-center py-8">\n                    No results found for "${e.search_query}"\n                </div>\n            `);let o="";if(Object.keys(window.currentSearch.results).sort(((e,t)=>window.currentSearch.results[t].length-window.currentSearch.results[e].length)).forEach((t=>{const n=window.currentSearch.results[t],r=t.split("/").pop(),a=e.writable_files&&e.writable_files.includes(t)?'<span class="ml-2 px-2 py-0.5 text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300 rounded">Writable</span>':'<span class="ml-2 px-2 py-0.5 text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300 rounded">No Writable</span>';o+=`\n                <div class="file-result border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden mb-4">\n                    <div class="file-header bg-gray-100 dark:bg-gray-700 px-4 py-2 flex justify-between items-center">\n                        <div class="flex items-center">\n                            <span class="font-medium text-gray-800 dark:text-white">${r}</span>\n                            <span class="ml-2 text-sm text-gray-500 dark:text-gray-400">${n.length} matches</span>\n                            ${a}\n                        </div>\n                        <div class="flex space-x-2">\n                            <button class="text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 text-sm" \n                                    onclick="viewEditFile('${t}', '${window.phpVars?.csrf||""}', '${window.phpVars?.encryptionKey||""}', ${window.phpVars?.isEnc||!1})">\n                                Edit\n                            </button>\n                            <button class="text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-300 text-sm toggle-matches" \n                                    data-file="${t}">\n                                Hide Matches\n                            </button>\n                        </div>\n                    </div>\n                    <div class="file-matches bg-white dark:bg-gray-800 p-2">\n                        <div class="text-xs text-gray-500 dark:text-gray-400 mb-2">${t}</div>\n                        <div class="matches-list space-y-1">\n            `,n.forEach((e=>{const n=e.line_content.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");let r=n;if(!document.getElementById("use-regex")?.checked){const e=document.getElementById("search-query")?.value||"";if(e){const t=document.getElementById("case-sensitive")?.checked?"g":"gi",o=new RegExp(e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),t);r=n.replace(o,'<mark class="bg-yellow-200 dark:bg-yellow-700">$&</mark>')}}o+=`\n                    <div class="match-line hover:bg-gray-50 dark:hover:bg-gray-700 p-1 rounded">\n                        <a href="#" class="flex" onclick="viewEditFileAtLine('${t}', ${e.line_number}, '${window.phpVars?.csrf||""}', '${window.phpVars?.encryptionKey||""}', ${window.phpVars?.isEnc||!1}); return false;">\n                            <span class="line-number w-12 inline-block text-right pr-2 text-gray-500 dark:text-gray-400 select-none">${e.line_number}</span>\n                            <span class="line-content font-mono text-gray-800 dark:text-gray-200 overflow-x-auto">${r}</span>\n                        </a>\n                    </div>\n                `})),o+="\n                        </div>\n                    </div>\n                </div>\n            "})),n.innerHTML=o,document.querySelectorAll(".toggle-matches").forEach((e=>{e.addEventListener("click",(function(){this.getAttribute("data-file");const e=this.closest(".file-result").querySelector(".matches-list");"none"===e.style.display?(e.style.display="block",this.textContent="Hide Matches"):(e.style.display="none",this.textContent="Show Matches")}))})),!e.search_complete){const t=document.getElementById("continue-search"),n=document.getElementById("auto-continue-search");if(t&&t.addEventListener("click",(function(){performAdvancedSearch(e.search_token)})),n){"true"===localStorage.getItem("search-auto-continue")&&(n.checked=!0),n.addEventListener("change",(function(){localStorage.setItem("search-auto-continue",this.checked)})),n.checked&&setTimeout((()=>{performAdvancedSearch(e.search_token)}),1e3)}}},window.viewEditFileAtLine=function(e,t,n,r,o){console.log(`Attempting to open ${e} at line ${t}`),viewEditFile(e,n,r,o);let a=0;const i=function(){if(console.log(`Checking for editor (attempt ${a+1}/20)`),window.editor){console.log(`Editor found, navigating to line ${t}`);try{window.editor.setCursor(t-1,0),window.editor.addLineClass(t-1,"background","bg-yellow-100"),window.editor.scrollIntoView({line:t-1,ch:0},100),console.log("Successfully positioned editor at line",t)}catch(e){console.error("Error positioning editor:",e),triggerAlert("warning","Could not position to the selected line. Please try manually navigating to line "+t)}}else a++,a<20?(console.log(`Editor not ready yet, attempt ${a}/20`),setTimeout(i,300)):(console.error("Editor failed to initialize after multiple attempts"),triggerAlert("warning","Could not position to the selected line. Please try manually navigating to line "+t))};setTimeout(i,800)},window.saveToLocalStorage=saveToLocalStorage,window.getFromLocalStorage=getFromLocalStorage,window.freeclipbroad="function"==typeof freeclipbroad?freeclipbroad:function(){console.error("freeclipbroad not found")},window.performBulkAction="function"==typeof performBulkAction?performBulkAction:function(){console.error("performBulkAction not found")},window.sendBulkActionRequest=function({action:e,files:t,options:n=null,onSuccess:r=null,onError:o=null}){const a=window.fileManagerState?.currentDir||phpVars?.currentDir,i=phpVars?.csrf,s=phpVars?.encryptionKey?CryptoJS.enc.Utf8.parse(phpVars.encryptionKey):null,l=phpVars?.isEnc;"function"==typeof progr&&progr(),console.log(`Sending ${e} request for ${t.length} file(s)`);const c={csrf:i,action:e,file:t,dir:a};"zip"===e&&n&&(c.zipExt=n.zipFileName,c.compressionLevel=n.compressionLevel||"5",c.archiveFormat=n.archiveFormat||"zip");const d=JSON.stringify(c),u="1"===l?encrypt(d,s):d;$.post("",u,(function(e){try{const t="1"===l?decrypt(e,s):e,n=JSON.parse(t);console.log("Response:",n),n.error?(triggerAlert("warning",n.error),o&&o(n.error)):n.success?r?r(n):triggerAlert("success",n.success):r?r(n):triggerAlert("success","Operation completed successfully")}catch(e){console.error("Error processing response:",e),triggerAlert("error","Failed to process server response"),o&&o(e)}"function"==typeof dprogr&&dprogr()})).fail((function(e,t,n){console.error("Request failed:",t,n),triggerAlert("error","Request failed: "+(n||"Unknown error")),o&&o(n),"function"==typeof dprogr&&dprogr()}))},window.renameFile="function"==typeof renameFile?renameFile:function(){console.error("renameFile not found")},window.loadDirectory="function"==typeof loadDirectory?loadDirectory:function(){console.error("loadDirectory not found")},window.triggerAlert="function"==typeof triggerAlert?triggerAlert:function(){console.error("triggerAlert not found")},window.showConfirmation="function"==typeof showConfirmation?showConfirmation:function(){console.error("showConfirmation not found")},window.encrypt="function"==typeof encrypt?encrypt:function(){console.error("encrypt not found")},window.decrypt="function"==typeof decrypt?decrypt:function(){console.error("decrypt not found")},window.progr="function"==typeof progr?progr:function(){console.error("progr not found")},window.dprogr="function"==typeof dprogr?dprogr:function(){console.error("dprogr not found")}}function handleTabSwitch(e){const t=document.querySelector(`[data-tabs-target="${e}"]`),n=document.querySelector(e);if(!t||!n)return void console.error("Tab elements not found:",e);document.querySelectorAll('[role="tab"]').forEach((e=>{e.setAttribute("aria-selected","false"),e.classList.remove("text-blue-600","border-blue-600"),e.classList.add("border-transparent")})),document.querySelectorAll('[role="tabpanel"]').forEach((e=>{e.classList.add("hidden")})),t.setAttribute("aria-selected","true"),t.classList.add("text-blue-600","border-blue-600"),t.classList.remove("border-transparent"),n.classList.remove("hidden"),n.classList.add("animate-fadeIn");const r=document.querySelector(".mb-4.border-b.border-gray-200.dark\\:border-gray-700"),o=document.getElementById("breadcrumbs");if(r&&o)if("#terminal"===e||"#config"===e||"#setting"===e||"#sql"===e||"#network"===e){console.log("Hiding navigation elements for tab:",e),r.classList.add("hidden"),o.classList.add("hidden");const t=document.getElementById("fileManagerUI");t&&(t.style.display="none",t.classList.add("hidden")),document.querySelectorAll(".tabs-panel").forEach((e=>{e.classList.add("hidden")}))}else if(r.classList.remove("hidden"),o.classList.remove("hidden"),"#file"===e){const e=document.getElementById("fileManagerUI");e&&(e.style.display="block",e.classList.remove("hidden"),document.querySelectorAll(".tabs-panel").forEach((e=>{e.classList.add("hidden")})))}"function"==typeof window.updateKeydownListener&&setTimeout(window.updateKeydownListener,100)}function saveToLocalStorage(e){try{const t=e.map((e=>{if(e.startsWith("/")||e.includes(":/"))return e;const t=window.fileManagerState?.currentDir||phpVars?.currentDir;return t.endsWith("/")?t+e:t+"/"+e}));return localStorage.setItem("copiedFiles",JSON.stringify(t)),console.log("Saved to clipboard:",t),t}catch(e){return console.error("Error saving to localStorage:",e),[]}}function getFromLocalStorage(){try{const e=localStorage.getItem("copiedFiles");if(!e)return console.log("No files found in clipboard"),[];const t=JSON.parse(e);return console.log("Retrieved from clipboard:",t),t}catch(e){return console.error("Error retrieving from localStorage:",e),[]}}function initNetworkTools(){const e=document.getElementById("portScannerForm");e&&e.addEventListener("submit",(function(e){e.preventDefault(),performPortScan()}));const t=document.getElementById("getNetworkInfo");t&&t.addEventListener("click",(function(){getNetworkInfo()}));const n=document.getElementById("getArpTable");n&&n.addEventListener("click",(function(){getArpTable()}));const r=document.getElementById("pingForm");r&&r.addEventListener("submit",(function(e){e.preventDefault(),performPing()}));const o=document.getElementById("dnsLookupForm");o&&o.addEventListener("submit",(function(e){e.preventDefault(),performDnsLookup()}));const a=document.getElementById("tracerouteForm");a&&a.addEventListener("submit",(function(e){e.preventDefault(),performTraceroute()}));const i=document.getElementById("whoisForm");i&&i.addEventListener("submit",(function(e){e.preventDefault(),performWhoisLookup()}))}function performPortScan(){const e=document.getElementById("hostInput").value,t=parseInt(document.getElementById("startPortInput").value),n=parseInt(document.getElementById("endPortInput").value),r=parseInt(document.getElementById("timeoutInput").value),o=document.getElementById("commonPortsOnly").checked;if(!e)return void triggerAlert("warning","Please enter a host/IP address");const a=document.getElementById("portScanResults"),i=document.getElementById("scanStatus"),s=document.getElementById("portScanResultsBody");a.classList.remove("hidden"),i.textContent=`Scanning ${e}...`,s.innerHTML='<tr><td colspan="3" class="text-center py-2">Scanning...</td></tr>';sendNetworkRequest("port_scan",{host:e,start_port:t,end_port:n,timeout:r,common_ports_only:o}).then((e=>{if(e.error)return triggerAlert("warning",e.error),i.textContent=`Scan failed: ${e.error}`,void(s.innerHTML='<tr><td colspan="3" class="text-center py-2 text-red-500">Scan failed</td></tr>');i.textContent=`Scan completed for ${e.host}`,s.innerHTML="";const t=e.results.filter((e=>"open"===e.status)),n=e.results.filter((e=>"closed"===e.status));if(0===t.length)s.innerHTML='<tr><td colspan="3" class="text-center py-2">No open ports found</td></tr>';else if(t.forEach((e=>{const t=document.createElement("tr");t.innerHTML=`\n                            <td class="px-4 py-2">${e.port}</td>\n                            <td class="px-4 py-2"><span class="px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">open</span></td>\n                            <td class="px-4 py-2">${e.service||"unknown"}</td>\n                        `,s.appendChild(t)})),n.length>0){const e=document.createElement("tr");e.innerHTML=`\n                            <td colspan="3" class="px-4 py-2 text-gray-500 italic">${n.length} port(s) closed or filtered</td>\n                        `,s.appendChild(e)}})).catch((e=>{triggerAlert("warning","Error performing port scan"),i.textContent="Scan failed",s.innerHTML='<tr><td colspan="3" class="text-center py-2 text-red-500">Error connecting to server</td></tr>'}))}function getNetworkInfo(){const e=document.getElementById("networkInfoResults");e.classList.remove("hidden"),e.innerHTML='<div class="text-center py-2">Loading network information...</div>',sendNetworkRequest("network_info",{}).then((t=>{if(t.error)return triggerAlert("warning",t.error),void(e.innerHTML=`<div class="text-center py-2 text-red-500">${t.error}</div>`);let n='<div class="space-y-4">';0===t.interfaces.length?n+='<div class="text-center py-2">No network interfaces found</div>':t.interfaces.forEach((e=>{n+=`\n                            <div class="border-b pb-3 dark:border-gray-600">\n                                <h4 class="font-medium text-gray-800 dark:text-gray-200">${e.name}</h4>\n                                <div class="mt-2">\n                        `,0===e.addresses.length?n+='<p class="text-sm text-gray-600 dark:text-gray-400">No addresses</p>':e.addresses.forEach((e=>{n+=`\n                                    <div class="flex flex-col text-sm">\n                                        <span class="text-gray-700 dark:text-gray-300">\n                                            <span class="font-medium">${e.family}:</span> ${e.address}\n                                        </span>\n                                        <span class="text-gray-600 dark:text-gray-400">\n                                            Netmask: ${e.netmask||"N/A"}\n                                        </span>\n                                    </div>\n                                `})),n+="</div></div>"})),n+="</div>",e.innerHTML=n})).catch((t=>{triggerAlert("warning","Error getting network information"),e.innerHTML='<div class="text-center py-2 text-red-500">Error connecting to server</div>'}))}function getArpTable(){const e=document.getElementById("arpTableResults");e.classList.remove("hidden"),e.innerHTML='<div class="text-center py-2">Loading ARP table...</div>',sendNetworkRequest("arp_table",{}).then((t=>{if(t.error)return triggerAlert("warning",t.error),void(e.innerHTML=`<div class="text-center py-2 text-red-500">${t.error}</div>`);if(0===t.arp_table.length)return void(e.innerHTML='<div class="text-center py-2">No ARP entries found</div>');let n='\n                    <table class="w-full text-sm text-left text-gray-500 dark:text-gray-400">\n                        <thead class="text-xs text-gray-700 uppercase bg-gray-100 dark:bg-gray-800 dark:text-gray-400">\n                            <tr>\n                                <th scope="col" class="px-4 py-2">IP Address</th>\n                                <th scope="col" class="px-4 py-2">MAC Address</th>\n                                <th scope="col" class="px-4 py-2">Interface</th>\n                            </tr>\n                        </thead>\n                        <tbody>\n                ';t.arp_table.forEach((e=>{n+=`\n                        <tr>\n                            <td class="px-4 py-2">${e.ip}</td>\n                            <td class="px-4 py-2">${e.mac}</td>\n                            <td class="px-4 py-2">${e.interface}</td>\n                        </tr>\n                    `})),n+="</tbody></table>",e.innerHTML=n})).catch((t=>{triggerAlert("warning","Error getting ARP table"),e.innerHTML='<div class="text-center py-2 text-red-500">Error connecting to server</div>'}))}function performPing(){const e=document.getElementById("pingHost").value,t=parseInt(document.getElementById("pingCount").value),n=parseInt(document.getElementById("pingTimeout").value);if(!e)return void triggerAlert("warning","Please enter a host/IP address");const r=document.getElementById("pingResults"),o=r.querySelector("div");r.classList.remove("hidden"),o.innerHTML='<div class="text-center py-2">Pinging '+e+"...</div>";sendNetworkRequest("ping",{host:e,count:t,timeout:n}).then((e=>{if(e.error)return triggerAlert("warning",e.error),void(o.innerHTML=`<div class="text-center py-2 text-red-500">${e.error}</div>`);let t="";e.results.forEach((e=>{t+=e+"<br>"})),o.innerHTML=t})).catch((e=>{triggerAlert("warning","Error performing ping"),o.innerHTML='<div class="text-center py-2 text-red-500">Error connecting to server</div>'}))}function performDnsLookup(){const e=document.getElementById("dnsHost").value,t=document.getElementById("dnsType").value;if(!e)return void triggerAlert("warning","Please enter a domain name");const n=document.getElementById("dnsResults"),r=n.querySelector("div");n.classList.remove("hidden"),r.innerHTML='<div class="text-center py-2">Looking up '+e+"...</div>";sendNetworkRequest("dns_lookup",{host:e,type:t}).then((n=>{if(n.error)return triggerAlert("warning",n.error),void(r.innerHTML=`<div class="text-center py-2 text-red-500">${n.error}</div>`);if(0===n.results.length)return void(r.innerHTML=`<div class="text-center py-2">No ${t} records found for ${e}</div>`);let o='<div class="space-y-4">';n.results.forEach((e=>{o+=`\n                        <div class="border-b pb-3 dark:border-gray-600">\n                            <h4 class="font-medium text-gray-800 dark:text-gray-200">${e.type} Record</h4>\n                            <div class="mt-2 space-y-1">\n                    `;const t=e.data;for(const[e,n]of Object.entries(t))"type"!==e&&"class"!==e&&(o+=`\n                                <div class="text-sm">\n                                    <span class="font-medium text-gray-700 dark:text-gray-300">${e}:</span>\n                                    <span class="text-gray-600 dark:text-gray-400">${n}</span>\n                                </div>\n                            `);o+="</div></div>"})),o+="</div>",r.innerHTML=o})).catch((e=>{triggerAlert("warning","Error performing DNS lookup"),r.innerHTML='<div class="text-center py-2 text-red-500">Error connecting to server</div>'}))}function performTraceroute(){const e=document.getElementById("tracerouteHost").value,t=parseInt(document.getElementById("tracerouteMaxHops").value),n=parseInt(document.getElementById("tracerouteTimeout").value);if(!e)return void triggerAlert("warning","Please enter a host/IP address");const r=document.getElementById("tracerouteResults"),o=r.querySelector("div");r.classList.remove("hidden"),o.innerHTML='<div class="text-center py-2">Tracing route to '+e+"...</div>";sendNetworkRequest("traceroute",{host:e,max_hops:t,timeout:n}).then((e=>{if(e.error)return triggerAlert("warning",e.error),void(o.innerHTML=`<div class="text-center py-2 text-red-500">${e.error}</div>`);let n='<div class="font-mono">';n+=`<div class="mb-2">Traceroute to ${e.host}, ${t} hops max:</div>`,e.results.forEach(((e,t)=>{n+=`<div>${e}</div>`})),n+="</div>",o.innerHTML=n})).catch((e=>{triggerAlert("warning","Error performing traceroute"),o.innerHTML='<div class="text-center py-2 text-red-500">Error connecting to server</div>'}))}function performWhoisLookup(){const e=document.getElementById("whoisDomain").value;if(!e)return void triggerAlert("warning","Please enter a domain or IP address");const t=document.getElementById("whoisResults"),n=t.querySelector("div");t.classList.remove("hidden"),n.innerHTML='<div class="text-center py-2">Looking up WHOIS information for '+e+"...</div>";sendNetworkRequest("whois",{domain:e}).then((t=>{if(t.error)return triggerAlert("warning",t.error),void(n.innerHTML=`<div class="text-center py-2 text-red-500">${t.error}</div>`);t.results?n.textContent=t.results:n.innerHTML=`<div class="text-center py-2">No WHOIS information found for ${e}</div>`})).catch((e=>{triggerAlert("warning","Error performing WHOIS lookup"),n.innerHTML='<div class="text-center py-2 text-red-500">Error connecting to server</div>'}))}function sendNetworkRequest(e,t){return new Promise(((n,r)=>{progr();const o={action:"network_tool",tool:e,params:t,csrf:phpVars.csrf},a=JSON.stringify(o),i="1"===phpVars.isEnc,s=CryptoJS.enc.Utf8.parse(phpVars.encryptionKey),l=i?encrypt(a,s):a;fetch("",{method:"POST",body:l}).then((e=>e.text())).then((e=>{try{let t;if(dprogr(),i)try{console.log("Attempting to decrypt response");const n=decrypt(e,s);console.log("Decrypted data:",n.substring(0,100)+"..."),t=JSON.parse(n)}catch(n){console.error("Decryption error:",n),console.log("Attempting direct JSON parse as fallback"),t=JSON.parse(e)}else t=JSON.parse(e);n(t)}catch(t){console.error("Error processing response:",t),console.error("Raw response:",e),dprogr(),r(t)}})).catch((e=>{console.error("Network error:",e),dprogr(),r(e)}))}))}function restoreOpenEditorFiles(){try{const t=localStorage.getItem("fileManager_openFiles");if(!t)return console.log("No saved editor files found in localStorage"),!1;const n=JSON.parse(t);if(!Array.isArray(n)||0===n.length)return console.log("Invalid or empty editor files data in localStorage"),!1;console.log("Restoring editor files:",n);const r=phpVars.csrf,o=phpVars.isEnc,a=CryptoJS.enc.Utf8.parse(phpVars.encryptionKey);async function e(e,t,n,r){try{const o=await sendRequest({csrf:t,action:"check_file_exists",file:e},n,r);return o&&!0===o.exists}catch(e){return console.error("Error checking if file exists:",e),!1}}return(async()=>{triggerAlert("info",`Restoring ${n.length} previously opened files...`);const t={success:[],failed:[]};for(let i=0;i<n.length;i++){const s=n[i];try{await e(s,r,a,o)?await new Promise((e=>{setTimeout((()=>{viewEditFile(s,r,a,o),t.success.push(s),e()}),300)})):(console.warn(`File not found: ${s}`),t.failed.push(s))}catch(e){console.error(`Error restoring file ${s}:`,e),t.failed.push(s)}}if(t.failed.length>0){const e=n.filter((e=>!t.failed.includes(e)));localStorage.setItem("fileManager_openFiles",JSON.stringify(e)),t.failed.length===n.length?triggerAlert("warning","Could not restore any previously opened files."):triggerAlert("warning",`Restored ${t.success.length} files. ${t.failed.length} files could not be found.`)}else t.success.length>0&&triggerAlert("success",`Successfully restored ${t.success.length} previously opened files.`);return t.success.length>0})()}catch(e){return console.error("Error restoring editor files from localStorage:",e),triggerAlert("warning","Failed to restore previously opened files."),!1}}document.addEventListener("DOMContentLoaded",(function(){if(window.loadTabsFromLocalStorage&&"function"==typeof window.loadTabsFromLocalStorage){window.loadTabsFromLocalStorage()&&restoreOpenEditorFiles()}document.getElementById("sql-tab")?.addEventListener("click",(function(){"function"==typeof window.initSQLExplorer&&window.initSQLExplorer()})),"function"==typeof window.initContextMenu&&window.initContextMenu(),exposeUtilityFunctions(),initGlobalKeyboardShortcuts(),window.clearFileSelection=function(){window.fileManagerState&&(window.fileManagerState.selectedFiles=[]),document.querySelectorAll(".file-checkbox:checked").forEach((e=>{e.checked=!1}));let e=document.getElementById("selectAll");e&&(e.checked=!1,e.indeterminate=!1),document.querySelectorAll("#fileList tr.bg-blue-50, #fileList tr.dark\\:bg-blue-900\\/20").forEach((e=>{e.classList.remove("bg-blue-50","dark:bg-blue-900/20")}))};const e=phpVars.csrf;let t=phpVars.currentDir;const n=phpVars.isEnc,r=CryptoJS.enc.Utf8.parse(phpVars.encryptionKey),o=phpVars.currentDir;let a;var i=phpVars.terPWD,s="",l=[],c=0,d=!1,u=0,g=0,m="",f=[],p="";let h=phpVars.cmList;window.editorThemePreference=localStorage.getItem("editor-theme"),"system"===window.editorThemePreference&&(window.editorThemePreference=window.matchMedia("(prefers-color-scheme: dark)").matches?"vs-dark":"vs");function y(e,t,n,r="",o){const a=document.documentElement.classList.contains("dark");Swal.fire({title:e,html:`\n                <div class="flex flex-col w-full">\n                    <label for="dialog-input" class="text-left mb-2 text-gray-700 dark:text-gray-300 text-sm font-medium">${t}</label>\n                    <input id="dialog-input" type="text" value="${r}" class="w-full p-3 text-gray-800 dark:text-gray-200 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50">\n                </div>\n            `,showCancelButton:!0,confirmButtonText:n,cancelButtonText:"Cancel",customClass:{popup:"dark:bg-gray-800 dark:text-gray-200",title:"text-gray-800 dark:text-gray-200",confirmButton:"bg-blue-600 hover:bg-blue-700 text-white",cancelButton:"bg-gray-500 hover:bg-gray-600 text-white"},background:a?"#1F2937":"#FFFFFF",focusConfirm:!1,preConfirm:()=>{const e=document.getElementById("dialog-input").value;return e&&""!==e.trim()?e:(Swal.showValidationMessage("You need to enter a value!"),!1)}}).then((e=>{e.isConfirmed&&e.value&&o(e.value)}))}function b(e,t,n,r){const o=document.documentElement.classList.contains("dark");Swal.fire({title:e,text:t,icon:"warning",iconColor:o?"#FBBF24":"#F59E0B",showCancelButton:!0,confirmButtonText:n,cancelButtonText:"Cancel",customClass:{popup:"dark:bg-gray-800 dark:text-gray-200",title:"text-gray-800 dark:text-gray-200",confirmButton:"bg-blue-600 hover:bg-blue-700 text-white",cancelButton:"bg-gray-500 hover:bg-gray-600 text-white"},background:o?"#1F2937":"#FFFFFF"}).then((e=>{e.isConfirmed&&r()}))}const w=localStorage.getItem("default-items-per-page");if(w){const e=document.getElementById("itemLimit");e&&(e.value=w)}if(loadTabsFromLocalStorage()){const e=fileManagerState.tabs.find((e=>e.active));e&&(t=e.path)}initializeFileManager(e,t,n,r),E(),$(document).on("click","#location-tabs button",(function(e){if(e.target.classList.contains("fa-times"))return;const t=$(this).data("tab-id");if(!fileManagerState.tabs.find((e=>e.id===t)))return;document.querySelectorAll('[role="tabpanel"]').forEach((e=>{e.classList.add("hidden")})),document.querySelectorAll("[data-tabs-target]").forEach((e=>{const t=e.getAttribute("data-tabs-target");t&&document.querySelector(t)&&document.querySelector(t).classList.add("hidden")})),function(e){window.switchToTab(e)}(t);const n=document.createElement("span");n.className="absolute inset-0 bg-blue-500 opacity-30 rounded-t-lg animate-ripple",this.appendChild(n),setTimeout((()=>n.remove()),600)})),$(document).on("click","[data-close-tab]",(function(o){o.stopPropagation();const a=$(this).data("close-tab");$(this).closest("li").addClass("animate-tab-closing"),setTimeout((()=>{!function(o){if(fileManagerState.tabs.length<=1)return;const a=fileManagerState.tabs.findIndex((e=>e.id===o));if(-1===a)return;const i=fileManagerState.tabs[a].active;if("editor"===fileManagerState.tabs[a].type){const e=fileManagerState.tabs[a].path;e&&window.saveOpenedFilesState&&window.saveOpenedFilesState(e,"remove")}if(fileManagerState.tabs.splice(a,1),i){const o=Math.max(0,a-1);fileManagerState.tabs[o].active=!0,fileManagerState.activeTabId=fileManagerState.tabs[o].id;const i=fileManagerState.tabs[o].type,s=document.getElementById("fileManagerUI");if(s)if("filemanager"===i){s.classList.remove("hidden"),s.style.display="block",document.querySelectorAll(".tabs-panel").forEach((e=>{e.classList.add("hidden")})),t=fileManagerState.tabs[o].path,updateCurrentPath();let a=document.getElementById("itemLimit"),i=a?a.value:"50";loadDirectory(t,1,e,r,n,i)}else{s.classList.add("hidden"),s.style.display="none";const e=document.getElementById(`${fileManagerState.activeTabId}-content`);e&&(document.querySelectorAll(".tabs-panel").forEach((e=>{e.classList.add("hidden")})),e.classList.remove("hidden"),window.editor&&setTimeout((()=>window.editor.refresh()),10))}}E(),saveTabsToLocalStorage()}(a)}),150)})),$("#add-tab-btn").click((function(){L(),$(this).addClass("animate-pulse"),setTimeout((()=>{$(this).removeClass("animate-pulse")}),500)})),window.addEventListener("resize",function(e,t){let n;return function(...r){const o=()=>{clearTimeout(n),e(...r)};clearTimeout(n),n=setTimeout(o,t)}}(I,100)),initThemeToggle(),initSettings();const v=document.getElementById("selectAll");function x(e){console.log("Select All checkbox changed:",e.target.checked);const t=e.target.checked,n=document.querySelectorAll(".file-checkbox");console.log("Found file checkboxes:",n.length),window.fileManagerState||(window.fileManagerState={selectedFiles:[]}),window.fileManagerState.selectedFiles=[],n.forEach((e=>{if(e.checked=t,t){const t=e.dataset.fullPath||e.dataset.file;updateSelectedFiles(t,!0,!0);e.closest("tr").classList.add("bg-blue-50","dark:bg-blue-900/20")}else{e.closest("tr").classList.remove("bg-blue-50","dark:bg-blue-900/20")}})),console.log("Updated selected files:",window.fileManagerState.selectedFiles),console.log("Selected file count:",window.fileManagerState.selectedFiles.length)}v&&(v.removeEventListener("change",x),v.addEventListener("change",x));const k=document.getElementById("fileList");function S(e){const t=$("#breadcrumbs ol"),n=e.split("/").filter((e=>""!==e));let r="";r+='\n            <li class="inline-flex items-center">\n                <a href="#" class="breadcrumb-link" data-path="/">\n                    /\n                </a>\n            </li>\n        ',n.forEach(((e,t)=>{const o="/"+n.slice(0,t+1).join("/");r+=`\n                <li class="inline-flex items-center">\n                    <i class="fas fa-chevron-right mx-2 text-gray-500"></i>\n                    <a href="#" class="breadcrumb-link" data-path="${o}">${e}</a>\n                </li>\n            `})),t.html(r)}function E(){const e=document.getElementById("location-tabs");if(!e)return;e.innerHTML="",fileManagerState.tabs.forEach((t=>{const n=document.createElement("li");n.className="mr-1 flex-shrink-0",n.setAttribute("role","presentation");const r=t.name||A(t.path);let o="fa-folder";"Root"!==r&&"Home"!==r||(o="fa-home");n.innerHTML=`\n                <button class="${t.active?"inline-flex items-center p-3 border-b-2 rounded-t-lg text-blue-600 border-blue-600 active dark:text-blue-500 dark:border-blue-500 bg-white dark:bg-gray-800 shadow-sm":"inline-flex items-center p-3 border-b-2 border-transparent rounded-t-lg hover:text-gray-600 hover:border-gray-300 dark:hover:text-gray-300 dark:hover:border-gray-300 bg-gray-50 dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600"} transition-all duration-200 group" \n                        data-tab-id="${t.id}" \n                        type="button" \n                        role="tab">\n                    <i class="fas ${o} mr-2 ${t.active?"text-blue-500":"group-hover:text-blue-400"} transition-colors"></i>\n                    <span class="truncate max-w-[100px] md:max-w-[150px]">${r}</span>\n                    ${"tab-1"!==t.id?`\n                        <i class="fas fa-times ml-2 p-1 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-full text-xs opacity-0 group-hover:opacity-100 hover:text-red-500 transition-all" data-close-tab="${t.id}"></i>\n                    `:""}\n                </button>\n            `,e.appendChild(n)}));const t=e.querySelector('button[data-tab-id="'+fileManagerState.activeTabId+'"]');t&&(t.classList.add("animate-pulse"),setTimeout((()=>{t.classList.remove("animate-pulse")}),500),requestAnimationFrame((()=>{const n=t.getBoundingClientRect(),r=e.getBoundingClientRect();n.left<r.left?e.scrollLeft+=n.left-r.left-16:n.right>r.right&&(e.scrollLeft+=n.right-r.right+16)}))),I()}function I(){const e=document.getElementById("location-tabs");if(!e)return;if(e.scrollWidth>e.clientWidth){if(e.classList.add("tabs-overflow"),!document.getElementById("tab-scroll-left")){const t=document.createElement("button");t.id="tab-scroll-left",t.className="absolute left-0 top-0 bottom-0 px-1 bg-gradient-to-r from-white to-transparent dark:from-gray-800 dark:to-transparent z-10 opacity-80 hover:opacity-100 transition-opacity",t.innerHTML='<i class="fas fa-chevron-left"></i>',t.addEventListener("click",(()=>{e.scrollBy({left:-150,behavior:"smooth"})}));const n=document.createElement("button");n.id="tab-scroll-right",n.className="absolute right-0 top-0 bottom-0 px-1 bg-gradient-to-l from-white to-transparent dark:from-gray-800 dark:to-transparent z-10 opacity-80 hover:opacity-100 transition-opacity",n.innerHTML='<i class="fas fa-chevron-right"></i>',n.addEventListener("click",(()=>{e.scrollBy({left:150,behavior:"smooth"})})),e.parentElement.appendChild(t),e.parentElement.appendChild(n)}}else e.classList.remove("tabs-overflow"),document.getElementById("tab-scroll-left")?.remove(),document.getElementById("tab-scroll-right")?.remove()}function L(e,t="filemanager"){return window.addNewTab(e,t)}function A(e){const t=e.endsWith("/")?e.slice(0,-1):e;if(""===t||"/"===t)return"Root";const n=t.split("/");return n[n.length-1]||"Root"}function B({action:o,files:a,options:i=null,onSuccess:s=null,onError:l=null}){progr();const c={action:o,file:a,dir:t,csrf:e};i&&Object.assign(c,i);const d=JSON.stringify(c),u="1"===n?encrypt(d,r):d;if("telegram_backup"===o){const e=new AbortController,t=setTimeout((()=>e.abort()),1e3);fetch("",{method:"POST",body:u,signal:e.signal}).then((e=>{if(clearTimeout(t),!e.ok)throw new Error("Network response was not ok");return e.text()})).then((e=>{try{const t="1"===n?decrypt(e,r):e,o=JSON.parse(t);o.error?(triggerAlert("warning",o.error),l&&l(o.error)):s&&s(o)}catch(e){console.error("Error processing response:",e),triggerAlert("error","Failed to process server response"),l&&l(e)}dprogr()})).catch((e=>{"AbortError"===e.name?(console.log("Background process started"),s&&s({status:"Backup started in background"})):(console.error("Request failed:",e),triggerAlert("error","Request failed: "+e.message),l&&l(e)),dprogr()}))}else $.post("",u,(function(e){try{const t="1"===n?decrypt(e,r):e,o=JSON.parse(t);console.log("Response:",o),o.error?(triggerAlert("warning",o.error),l&&l(o.error)):o.success?s?s(o):triggerAlert("success",o.success):s?s(o):triggerAlert("success","Operation completed successfully")}catch(e){console.error("Error processing response:",e),triggerAlert("error","Failed to process server response"),l&&l(e)}dprogr()})).fail((function(e,t,n){console.error("Request failed:",t,n),triggerAlert("error","Request failed: "+(n||"Unknown error")),l&&l(n),dprogr()}))}k&&k.addEventListener("change",(function(e){if(e.target.classList.contains("file-checkbox")){const t=e.target.checked;updateSelectedFiles(e.target.dataset.file,t);const n=document.querySelectorAll(".file-checkbox"),r=Array.from(n).every((e=>e.checked)),o=Array.from(n).some((e=>e.checked));v&&(v.checked=r,v.indeterminate=!r&&o)}})),document.addEventListener("click",(function(o){if(o.target.classList.contains("fa-trash-alt")){const a=o.target.dataset.file;deleteFile(a,e,t,r,n)}})),$(".fa-folder-plus").click((function(){y("Create Folder","Enter the name of new folder: ","mkdir","NewFolder",(o=>{o&&(data={csrf:e,action:"mkdir",dir:t,dirName:o},handleCreate(data,"folder",r,n,t,e))}))})),$(".fa-file-circle-plus").click((function(){y("Create File","Enter the name of new File: ","touch","File",(o=>{o&&(data={csrf:e,action:"touch",dir:t,dirName:o},handleCreate(data,"file",r,n,t,e))}))})),$(".codeme").click((function(){y("Execute PHP Code","Enter the PHP code to execute:","Execute","",(o=>{o&&""!==o.trim()&&sendRequest({csrf:e,action:"execute",code:o.trim(),dir:t},r,n).then((e=>{e.output&&(triggerAlert("success","Code executed successfully"),Swal.fire({title:"Execution Result",html:`<pre class="text-left">${e.output}</pre>`,width:"80%",customClass:{popup:"dark:bg-gray-800 dark:text-white",htmlContainer:"overflow-auto max-h-[70vh]"}}))})).catch((e=>{triggerAlert("warning","Error executing code: "+e)}))}))})),$("#searchBar").on("keyup",(function(){const o=$(this).val().toLowerCase();console.log("Search query:",o),o.length>0?$("#clearSearch").show():$("#clearSearch").hide(),window.fileManagerState?"function"==typeof window.renderFiles?window.renderFiles(window.fileManagerState.files,t,e,r,n):console.error("renderFiles function not found"):console.error("fileManagerState is not initialized")})),$("#clearSearch").on("click",(function(){$("#searchBar").val("").focus(),$(this).hide(),"function"==typeof window.renderFiles&&window.fileManagerState&&window.renderFiles(window.fileManagerState.files,t,e,r,n)})),document.addEventListener("click",(function(t){if(t.target.classList.contains("fa-download")){const o=t.target.dataset.file;console.log("filePath "+A(o)),dwn(o,e,r,n)}})),$(window).on("scroll",(function(){if($(window).scrollTop()+$(window).height()>=$(document).height()-100){let o=document.getElementById("itemLimit").value;fileManagerState.currentPage<fileManagerState.totalPages&&!fileManagerState.isLoading&&(fileManagerState.currentPage++,loadDirectory(t,fileManagerState.currentPage,e,r,n,o))}})),$("th[data-sort]").click((function(){const o=$(this).data("sort");if(console.log("Sorting by column:",o),!window.fileManagerState)return void console.error("fileManagerState is not initialized");window.fileManagerState.currentSort.column===o?window.fileManagerState.currentSort.direction="asc"===window.fileManagerState.currentSort.direction?"desc":"asc":(window.fileManagerState.currentSort.column=o,window.fileManagerState.currentSort.direction="asc"),console.log("Sort state:",window.fileManagerState.currentSort),"function"==typeof window.sortFiles?window.sortFiles():console.error("sortFiles function not found"),"function"==typeof window.renderFiles?window.renderFiles(window.fileManagerState.files,t,e,r,n):console.error("renderFiles function not found"),$("th[data-sort]").find("i.fas").removeClass("fa-sort-up fa-sort-down").addClass("fa-sort");const a=$(this).find("i.fas");a.removeClass("fa-sort"),"asc"===window.fileManagerState.currentSort.direction?a.addClass("fa-sort-up"):a.addClass("fa-sort-down")})),$(document).on("click",".directory-link",(function(o){o.preventDefault();let i=document.getElementById("itemLimit").value;const s=$(this).data("path");s&&s!==t&&(t=s,a=t,console.log(a),updateCurrentPath(),loadDirectory(t,1,e,r,n,i),updateActiveTabPath(t))})),window.updateCurrentPath=function(){S(t)},$("#breadcrumbs").on("dblclick",(function(o){console.log("Double-click detected"),o.preventDefault();const a=$("#breadcrumbs ol"),i=t,s=$("<input>",{type:"text",value:i,class:"w-96 px-2 py-1 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"});console.log("originalPath"+i),a.html(`<li class="inline-flex items-center">${s.prop("outerHTML")}</li>`),a.find("input").focus(),a.find("input").on("blur",(function(){$(this).val().trim();S(i)})),a.find("input").on("keydown",(function(o){if(13===o.keyCode){o.preventDefault();const a=$(this).val().trim();a&&(t=a,updateCurrentPath(),loadDirectory(t,1,e,r,n),updateActiveTabPath(t))}}))})),$(document).on("click",".breadcrumb-link",(function(o){o.preventDefault();const i=$(this).data("path");if(i){t=i,updateCurrentPath(),a=t,console.log(a);let o=document.getElementById("itemLimit"),s=o?o.value:"50";loadDirectory(t,1,e,r,n,s),updateActiveTabPath(t)}})),$(document).on("click","#goHome",(function(i){i.preventDefault(),t=o,updateCurrentPath(),a=t;let s=document.getElementById("itemLimit"),l=s?s.value:"50";loadDirectory(t,1,e,r,n,l),updateActiveTabPath(t),$(this).addClass("animate-pulse"),setTimeout((()=>{$(this).removeClass("animate-pulse")}),300)})),window.switchToTab=function(o){const a=fileManagerState.tabs.find((e=>e.id===o));if(!a)return;fileManagerState.tabs.forEach((e=>e.active=!1)),a.active=!0,fileManagerState.activeTabId=o,E(),document.querySelectorAll('[role="tabpanel"]').forEach((e=>{e.classList.add("hidden")}));let i=document.getElementById(`${o}-content`);if(!i&&("editor"===a.type||"search"===a.type)){console.log("Creating tab content element for tab:",o);const e=document.getElementById("tabs-content");if(!e)return void console.error("Tabs content container not found!");i=document.createElement("div"),i.id=`${o}-content`,i.className="tabs-panel w-full",e.appendChild(i)}document.querySelectorAll(".tabs-panel").forEach((e=>{e.classList.add("hidden")}));const s=document.getElementById("fileManagerUI");if("editor"===a.type||"search"===a.type)if(console.log("Handling editor/search tab"),s?(console.log("Hiding fileManagerUI"),s.classList.add("hidden"),s.style.display="none"):console.warn("fileManagerUI element not found"),i){i.classList.remove("hidden");const e=i.querySelector(".editor-container");e&&(e.style.height="90vh",e.style.width="100%",window.editor&&setTimeout((()=>window.editor.refresh()),10))}else console.error("Tab content not found for ID:",`${o}-content`);else{const o=document.getElementById("file");if(s){console.log("Showing fileManagerUI"),s.classList.remove("hidden"),s.style.display="block",o&&o.classList.remove("hidden"),t=a.path,updateCurrentPath();let i=document.getElementById("itemLimit"),l=i?i.value:"50";loadDirectory(t,1,e,r,n,l)}else console.warn("fileManagerUI element not found")}saveTabsToLocalStorage()},window.addNewTab=function(e=null,n="filemanager"){const r=`tab-${Date.now()}`;fileManagerState.tabs.forEach((e=>e.active=!1)),fileManagerState.tabs.push({id:r,path:t,active:!0,name:e||A(t),type:n}),fileManagerState.activeTabId=r,E();const o=document.getElementById("fileManagerUI");return o&&("filemanager"===n?(o.classList.remove("hidden"),o.style.display="block",document.querySelectorAll(".tabs-panel").forEach((e=>{e.classList.add("hidden")}))):(o.classList.add("hidden"),o.style.display="none")),saveTabsToLocalStorage(),r},window.updateActiveTabPath=function(e){const t=fileManagerState.tabs.find((e=>e.id===fileManagerState.activeTabId));t&&(t.path=e,t.name=A(e),E(),saveTabsToLocalStorage())},$("#bulkActions").change((function(){const o=$(this).val();setTimeout((()=>{$(this).val("")}),100);const a=()=>{const e=document.querySelectorAll(".file-checkbox:checked"),t=[];return e.forEach((e=>{const n=e.dataset.fullPath||e.dataset.file;n&&t.push(n)})),t},i=a();if(console.log("Bulk action triggered:",o),console.log("Selected files:",i),console.log("Selected files count:",i.length),0!==i.length||"paste"===o)switch(o){case"delete":b("Delete Files",`Are you sure you want to delete ${i.length} file(s)?`,"Delete",(()=>{const o=a();o.length>0?(console.log("Sending files for deletion:",o),B({action:"delete",files:o,onSuccess:()=>{clearFileSelection(),triggerAlert("success","Files deleted successfully"),loadDirectory(t,1,e,r,n)}})):triggerAlert("warning","No files selected for deletion.")}));break;case"zip":!function(e,t,n,r="",o){const a=document.documentElement.classList.contains("dark"),i=a?"bg-gray-800 text-white border-gray-700":"bg-white text-gray-900 border-gray-300";Swal.fire({title:e,html:`\n                <div class="flex flex-col space-y-4">\n                    <div class="w-full">\n                        <label for="zipFileName" class="text-sm font-medium block mb-1">\n                            ${t}\n                        </label>\n                        <input id="zipFileName" type="text" value="${r}" \n                               class="w-full p-2 border rounded ${i}">\n                    </div>\n                    <div class="w-full">\n                        <label for="compressionLevel" class="text-sm font-medium block mb-1">\n                            Compression Level:\n                        </label>\n                        <select id="compressionLevel" class="w-full p-2 border rounded ${i}">\n                            <option value="0">Store only (no compression)</option>\n                            <option value="1">Fastest (lowest compression)</option>\n                            <option value="5" selected>Normal (balanced)</option>\n                            <option value="9">Maximum (slowest)</option>\n                        </select>\n                    </div>\n                    <div class="w-full">\n                        <label for="archiveFormat" class="text-sm font-medium block mb-1">\n                            Archive Format:\n                        </label>\n                        <select id="archiveFormat" class="w-full p-2 border rounded ${i}">\n                            <option value="zip" selected>ZIP (.zip)</option>\n                            <option value="tar">TAR (.tar)</option>\n                            <option value="tar.gz">TAR GZ (.tar.gz)</option>\n                            <option value="tar.bz2">TAR BZ2 (.tar.bz2)</option>\n                            <option value="tar.xz">TAR XZ (.tar.xz)</option>\n                            <option value="gz">GZIP (.gz)</option>\n                        </select>\n                    </div>\n                </div>\n            `,focusConfirm:!1,showCancelButton:!0,confirmButtonText:n,cancelButtonText:"Cancel",customClass:{popup:a?"bg-gray-800 text-white":"bg-white text-gray-900",confirmButton:"bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded",cancelButton:"bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded mr-2"},preConfirm:()=>{const e=document.getElementById("zipFileName").value,t=document.getElementById("compressionLevel").value,n=document.getElementById("archiveFormat").value;return e?{zipFileName:e,compressionLevel:t,archiveFormat:n}:(Swal.showValidationMessage("Please enter a filename"),!1)}}).then((e=>{e.isConfirmed&&e.value&&o(e.value)}))}("Create Zip Archive","Enter the name for the zip file:","Create","archive.zip",(o=>{if(o){const i=a();if(0===i.length)return void triggerAlert("warning","No files selected for archiving.");const s=o.archiveFormat;let l=o.zipFileName;l.toLowerCase().endsWith("."+s)||(l.includes(".")&&(l=l.substring(0,l.lastIndexOf("."))),l+="."+s),o.zipFileName=l,B({action:"zip",files:i,options:o,onSuccess:()=>{clearFileSelection(),triggerAlert("success","Archive created successfully"),loadDirectory(t,1,e,r,n)}})}}));break;case"unzip":if(i.length>1){const o=i.map((e=>{const t=e.split(".").pop().toLowerCase();if(["gz","bz2","xz"].includes(t)){if(e.substring(0,e.lastIndexOf(".")).toLowerCase().endsWith(".tar"))return`tar.${t}`}return t}));if(!o.every((e=>e===o[0])))return void b("Warning: Different Archive Types","You've selected different types of archives. This may cause extraction issues. Continue anyway?","Continue",(()=>{const o=a();o.length>0&&B({action:"unzip",files:o,onSuccess:()=>{clearFileSelection(),triggerAlert("success","Archives extracted successfully"),loadDirectory(t,1,e,r,n)}})}))}b("Extract Archive",i.length>1?`Extract ${i.length} archives to the current directory?`:`Extract "${i[0]}" to the current directory?`,"Extract",(()=>{const o=a();o.length>0&&B({action:"unzip",files:o,onSuccess:()=>{clearFileSelection(),triggerAlert("success","Archives extracted successfully"),loadDirectory(t,1,e,r,n)}})}));break;case"copy":if(i.length>0){const e=i.map((e=>e.includes("/")?e:`${t}/${e}`));localStorage.setItem("copiedFiles",JSON.stringify(e)),triggerAlert("success",`${i.length} file(s) copied to clipboard`)}break;case"paste":try{const o=JSON.parse(localStorage.getItem("copiedFiles")||"[]");o.length>0?B({action:"paste",files:o,onSuccess:()=>{clearFileSelection(),triggerAlert("success","Files pasted successfully"),loadDirectory(t,1,e,r,n),localStorage.removeItem("copiedFiles")}}):triggerAlert("warning","No files in clipboard to paste")}catch(e){console.error("Error reading clipboard:",e),triggerAlert("error","Failed to read clipboard data")}break;case"telegram_backup":b("Secure Backup to Telegram",`Are you sure you want to backup ${i.length} file(s) to Telegram? All files and folders will be compressed with maximum compression (level 9) and protected with strong AES-256 encryption using a random password.`,"Secure Backup",(()=>{const e=a();e.length>0?(console.log("Sending files for Telegram backup:",e),triggerAlert("info","Sending files to Telegram with maximum compression and password protection. This may take a while for large files..."),B({action:"telegram_backup",files:e,onSuccess:e=>{clearFileSelection(),"Backup started in background"===e.status?triggerAlert("info","Backup started in background. You can continue using the app."):e.success?triggerAlert("success",e.success):e.warning?triggerAlert("warning",e.warning):triggerAlert("success","Files are being backed up.")},onError:e=>{triggerAlert("error","Failed to backup files: "+e)}})):triggerAlert("warning","No files selected for backup.")}));break;default:console.log("Unknown action:",o);break}else triggerAlert("info","No files selected! Please select files to perform bulk actions.")}));const T=document.getElementById("dropZone"),M=document.getElementById("fileInput"),F=document.getElementById("uploadForm"),C=document.getElementById("uploadProgress"),P=document.getElementById("progressBar"),D=document.getElementById("progressText");if(T&&M&&F&&C&&P&&D){function q(e){e.preventDefault(),e.stopPropagation()}function z(o){C.classList.remove("hidden"),P.style.width="0%",D.textContent="Uploading...";const a=new FormData(F);a.append("updir",t),a.append("csrf",e),fetch("",{method:"POST",body:a}).then((e=>e.json())).then((o=>{o.success?(D.textContent="Upload complete!",setTimeout((()=>C.classList.add("hidden")),3e3),loadDirectory(t,1,e,r,n)):D.textContent=o.error||"Upload failed. Please try again."})).catch((e=>{D.textContent="Upload failed. Please try again.",console.error("Error:",e)}))}["dragenter","dragover","dragleave","drop"].forEach((e=>{T.addEventListener(e,q,!1)})),["dragenter","dragover"].forEach((e=>{T.addEventListener(e,(()=>T.classList.add("bg-blue-50","dark:bg-gray-600")),!1)})),["dragleave","drop"].forEach((e=>{T.addEventListener(e,(()=>T.classList.remove("bg-blue-50","dark:bg-gray-600")),!1)})),T.addEventListener("drop",(function(e){const n=e.dataTransfer.files;n.length>0&&(M.files=n,a=t,z(a))}),!1),M.addEventListener("change",z),T.addEventListener("click",(()=>M.click()))}function N(e,t,n,r,o){if(progr(),console.log("Saving file content for:",e),!t)return triggerAlert("warning","File content is empty."),void dprogr();if(!e)return triggerAlert("warning","No file path specified."),void dprogr();const a=document.querySelector(`[data-file-path="${e}"]`);let i="";if(a){const e=a.id.replace("-content",""),t=document.getElementById(`file-type-select-${e}`);t&&(i=t.value)}sendRequest({csrf:n,action:"save_content",file:e,content:t,file_type:i},r,o).then((e=>{console.log("File saved successfully:",e),triggerAlert("success","File saved successfully"),dprogr()})).catch((e=>{console.error("Error saving file:",e),triggerAlert("danger","Failed to save file: "+e),dprogr()}))}function H(e){switch(e.split(".").pop().toLowerCase()){case"js":return"javascript";case"php":return"php";case"html":case"htm":return"htmlmixed";case"css":return"css";case"json":return"application/json";case"xml":return"xml";case"md":return"markdown";case"py":return"python";case"rb":return"ruby";case"java":return"text/x-java";case"c":return"text/x-csrc";case"cpp":case"cc":case"h":case"hpp":return"text/x-c++src";case"cs":return"text/x-csharp";case"go":return"text/x-go";case"rs":return"text/x-rustsrc";case"ts":return"text/typescript";case"sql":return"sql";case"sh":case"bash":return"shell";case"yml":case"yaml":return"yaml";case"txt":return"text";default:return"plaintext"}}document.addEventListener("click",(function(t){if(t.target.classList.contains("file-link")){t.preventDefault();!function(e,t,n,r){progr(),console.log("ViewEditFile called for:",e);try{const o=e.split("/").pop(),a=(o.split(".").pop()||"").toLowerCase();if([...["jpg","jpeg","png","gif","bmp","webp","svg","ico"],...["mp4","webm","ogg","avi","mov","wmv","flv","mkv"],...["mp3","wav","ogg","aac","flac","m4a"],...["pdf"],...["doc","docx","xls","xlsx","ppt","pptx"]].includes(a)&&"function"==typeof window.showFilePreviewModal)return window.showFilePreviewModal(e,o,a,t,n,r),void dprogr()}catch(e){console.warn("Preview detection failed:",e)}try{const a=L(e.split("/").pop(),"editor");function o(o){o.dataset.filePath=e,o.innerHTML="";const i=document.createElement("div");i.className="editor-container",i.style.width="100%",i.style.height="90vh",i.style.border="1px solid #ddd",i.style.position="relative",o.appendChild(i);const s=document.createElement("div");s.className="file-type-selector fixed top-4 right-4 z-50",s.innerHTML=`\n                    <select id="file-type-select-${a}" class="bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded px-3 py-2 text-sm">\n                        <option value="">Auto-detect</option>\n                        <option value="javascript">JavaScript</option>\n                        <option value="php">PHP</option>\n                        <option value="htmlmixed">HTML</option>\n                        <option value="css">CSS</option>\n                        <option value="application/json">JSON</option>\n                        <option value="xml">XML</option>\n                        <option value="markdown">Markdown</option>\n                        <option value="python">Python</option>\n                        <option value="text/x-java">Java</option>\n                        <option value="text/x-csrc">C</option>\n                        <option value="text/x-c++src">C++</option>\n                        <option value="sql">SQL</option>\n                        <option value="shell">Shell/Bash</option>\n                        <option value="yaml">YAML</option>\n                        <option value="text">Plain Text</option>\n                    </select>\n                `,o.appendChild(s),sendRequest({csrf:t,action:"view_content",file:e},n,r).then((s=>{if(console.log("File content fetched successfully, length:",s.content?.length),"undefined"==typeof CodeMirror)return console.error("CodeMirror is not defined!"),i.innerHTML=`<pre style="white-space: pre-wrap; padding: 1rem;">${s.content}</pre>`,triggerAlert("warning","CodeMirror not found. Displaying content in plain text mode."),void dprogr();const l=s.file_type||H(e),c=CodeMirror(i,{value:s.content||"",mode:l,theme:document.documentElement.classList.contains("dark")?"dracula":"eclipse",lineNumbers:!0,lineWrapping:!0,matchBrackets:!0,autoCloseBrackets:!0,styleActiveLine:!0});window.editor=c,c.setSize("100%","100%");const d=document.getElementById(`file-type-select-${a}`);if(d){Array.from(d.options).find((e=>e.value===l))&&(d.value=l),d.addEventListener("change",(()=>{const o=d.value||H(e);c.setOption("mode",o),sendRequest({csrf:t,action:"view_content",file:e,file_type:o},n,r),setTimeout((()=>c.refresh()),50)}))}let u=o.querySelector(".save-file-btn");u||(u=document.createElement("button"),u.className="save-file-btn fixed bottom-4 right-4 bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded shadow-lg z-50",u.innerHTML='<i class="fas fa-save mr-2"></i> Save',u.addEventListener("click",(()=>{const o=c.getValue();N(e,o,t,n,r)})),o.appendChild(u)),setTimeout((()=>{c&&(c.refresh(),c.focus())}),100),dprogr()})).catch((e=>{console.error("Error fetching file content:",e),i.innerHTML='<div class="p-4 text-red-500">Failed to load file content: '+e+"</div>",dprogr()}))}console.log("Created new tab with ID:",a),window.saveOpenedFilesState&&window.saveOpenedFilesState(e,"add"),setTimeout((()=>{const e=document.getElementById("fileManagerUI");e&&(e.classList.add("hidden"),e.style.display="none",console.log("fileManagerUI hidden"));const t=document.getElementById("tabs-content");if(!t)return console.error("Tabs content container not found"),dprogr(),void triggerAlert("warning","Failed to initialize editor. Try refreshing the page.");let n=document.getElementById(`${a}-content`);n||(console.log("Creating new tab content with ID:",`${a}-content`),n=document.createElement("div"),n.id=`${a}-content`,n.className="tabs-panel w-full",t.appendChild(n)),document.querySelectorAll(".tabs-panel").forEach((e=>{e.classList.add("hidden")})),document.querySelectorAll('[role="tabpanel"]').forEach((e=>{e.classList.add("hidden")})),n.classList.remove("hidden"),o(n)}),100)}catch(e){console.error("Error in viewEditFile:",e),dprogr()}}(t.target.dataset.file,e,r,n)}})),function(){const t=document.getElementById("cancelEdit"),o=document.getElementById("cancelEditBtn"),a=document.getElementById("editorLanguage"),i=document.getElementById("saveFile");t&&t.addEventListener("click",(function(){const e=document.getElementById("editorModal");e&&e.classList.add("hidden")})),o&&o.addEventListener("click",(function(){const e=document.getElementById("editorModal");e&&e.classList.add("hidden")})),a&&a.addEventListener("change",(function(){if(window.editor){const e=this.value,t={javascript:"javascript",php:"php",html:"htmlmixed",css:"css",json:"javascript",plaintext:"null"}[e]||"null";window.editor.setOption("mode",t);const n=document.getElementById("editorStatus");n&&(n.textContent=`Language changed to ${e}`)}})),i&&i.addEventListener("click",(function(){const t=window.editor?window.editor.getValue():"",o=document.getElementById("editorModal"),a=o&&o.dataset.filePath?o.dataset.filePath:"",i=document.getElementById("editorStatus");i&&(i.textContent="Saving..."),N(a,t,e,r,n)}))}();function O(){const e=document.querySelector('[role="tab"][aria-selected="true"]')?.getAttribute("data-tabs-target"),t=document.querySelector(".mb-4.border-b.border-gray-200.dark\\:border-gray-700"),n=document.getElementById("breadcrumbs");e&&t&&n?"#terminal"===e||"#config"===e||"#setting"===e?(t.classList.add("hidden"),n.classList.add("hidden")):(t.classList.remove("hidden"),n.classList.remove("hidden")):console.warn("Could not find all required elements for navigation toggle")}function R(){s="",c=0,u=0,g=0,p="",d=!1}function V(){$("line.current bl").remove(),$("line.current").removeClass("current")}function _(){$("terminal content").append('<line class="current"><path>'+i+"</path> <sp></sp> <t><bl></bl></t></line>")}function U(){let e=$("line.current t").html(),t=1==e.split(" ").length?"<cm>"+e+"</cm>":"<cm>"+e.split(" ")[0]+"</cm> <code>"+e.split(" ").slice(1).join(" ").replace(/</g,"&lt;").replace(/>/g,"&gt;")+"</code>";$("line.current t").html(t.replace("&lt;bl&gt;&lt;/bl&gt;","<bl></bl>"))}function j(e=""){""===e?e=s:u=0;let t=e.substr(0,e.length+u),n=e.substr(e.length+u);$("line.current t").html(t+"<bl></bl>"+n)}window.initializeEditor=function(e,t="plaintext",n="editorContainer"){progr();const r=document.getElementById(n);if(!r)return console.error("Editor container not found:",n),void dprogr();const o=document.documentElement.classList.contains("dark")?"dracula":"eclipse";try{const a={"Ctrl-S":function(e){const t=r.closest('[id$="-content"]');if(t){const e=t.querySelector(".save-file-btn");e&&e.click()}else{const e=document.getElementById("saveFile");e&&e.click()}return!1},"Ctrl-F":"findPersistent","Ctrl-H":"replace","Ctrl-/":"toggleComment",Tab:function(e){return e.somethingSelected()?e.indentSelection("add"):e.replaceSelection("    ","end"),!0},"Shift-Tab":function(e){return e.indentSelection("subtract"),!0},"Ctrl-Q":function(e){return e.foldCode(e.getCursor()),!1},Esc:function(e){return e.getOption("fullScreen")&&e.setOption("fullScreen",!1),!1}};r.innerHTML="";const i=CodeMirror(r,{value:e||"",mode:t,theme:o,lineNumbers:!0,indentUnit:4,smartIndent:!0,indentWithTabs:!1,lineWrapping:!0,matchBrackets:!0,autoCloseBrackets:!0,autoCloseTags:!0,styleActiveLine:!0,selectionPointer:!0,tabSize:parseInt(localStorage.getItem("tab-size")||"4"),extraKeys:a,scrollbarStyle:"native",undoDepth:200,historyEventDelay:200});window.editor=i,i.setSize("100%","100%"),setTimeout((()=>{i&&i.focus()}),100),setTimeout((()=>{i&&i.refresh()}),50),console.log(`CodeMirror editor initialized with mode: ${t} in container: ${n}`)}catch(e){console.error("Error initializing CodeMirror editor:",e),triggerAlert("warning","Failed to initialize the editor. Please try again.")}finally{dprogr()}},window.createEditor=function(e,t){if(console.log("createEditor called - redirecting to initializeEditor"),"function"!=typeof window.initializeEditor)return console.error("initializeEditor function not found"),void triggerAlert("warning","Editor initialization failed. Please refresh the page.");if(!document.getElementById("editorContainer"))return console.error("Editor container not found"),void triggerAlert("warning","Editor container not found in DOM. Please refresh the page.");try{window.initializeEditor(e,t)}catch(e){console.error("Error in createEditor:",e),triggerAlert("warning","Failed to initialize editor. Please try again.")}},$(document).ready((function(){window.fileManagerState||(window.fileManagerState={files:[],totalPages:1,currentPage:1,currentSort:{column:"name",direction:"asc"},selectedFiles:[],tabs:[{id:"tab-1",path:t,active:!0,name:"Home"}],activeTabId:"tab-1"});const o=document.getElementById("itemLimit");let a="50";if(o&&o.value)a=o.value;else{const e=localStorage.getItem("default-items-per-page");e&&(a=e,o&&(o.value=a))}function y(e){var t="number"==typeof e.which?e.which:e.keyCode;8===t||9===t||46===t?(e.preventDefault(),""!==s&&(8===t?function(){0!==g&&(g=0,s=p);let e=s.substr(0,s.length+u),t=s.substr(s.length+u);s=e.substr(0,e.length-1)+t,j(),U()}():46===t?function(){let e=s.substr(0,s.length+u),t=s.substr(s.length+u);s=e+t.substr(1),0!==u&&u++;j(),U()}():9===t&&function(){if(m!==s)if(m=s,f=[],1===s.split(" ").length){let e=h.concat(Object.keys(J));f=e.filter((function(e){return e.length>s.length&&e.substr(0,s.length).toLowerCase()==s.toLowerCase()})).reverse().sort((function(e,t){return t.length-e.length}))}else if(2===s.split(" ").length){let t=s.split(" ")[0],n=s.split(" ")[1];var e="";if("cd"===t||"cp"===t||"mv"===t||"cat"===t){switch(t){case"cd":e="ls -d "+n+"*/";break;case"cp":case"mv":e="ls -d "+n+"*/";break;case"cat":e="ls -p | grep -v /";break;default:e=""}$.ajax({type:"POST",async:!1,data:{command:e,path:i},cache:!1,success:function(e){e=$.parseJSON(e),f=e.result.split("<br>").filter((function(e){return 0!==e.length}))}})}}f.length&&f.length>Math.abs(g)?(g--,j(p=(2===s.split(" ").length?s.split(" ")[0]+" ":"")+f[f.length+g]),U()):(g=0,p="",j(),U())}())):e.ctrlKey&&67===t?(g=0,V(),_(),R()):13===t?(0!==g&&(g=0,s=p),s.toLowerCase().split(" ")[0]in J?J[s.toLowerCase().split(" ")[0]](s.split(" ").slice(1)):0!==s.length&&$.ajax({type:"POST",async:!1,data:{command:s,path:i},cache:!1,success:function(e){e=$.parseJSON(e),i=e.path,$("terminal content").append("<line><br>"+e.result+"</line>")}}),V(),function(e){e.length>=2&&(0===l.length||l[l.length-1]!==e)&&(l[l.length]=e)}(s),_(),R(),$("terminal content").scrollTop($("terminal content").prop("scrollHeight"))):35!==t&&36!==t&&37!==t&&39!==t||""===s?38!==t&&40!==t||""!==s&&!d?(32===t||222===t||220===t||t>=45&&t<=195&&!(t>=112&&t<=123)&&46!=t&&91!=t&&93!=t&&144!=t&&145!=t&&45!=t)&&(!function(e){const t=Date.now();if(window.lastTypeTimestamp&&t-window.lastTypeTimestamp<10)return;window.lastTypeTimestamp=t,c=0,d=!1,0!==g&&(g=0,s=p);if("/"===s[s.length-1]&&"/"===e)return;let n=s.substr(0,s.length+u),r=s.substr(s.length+u);s=n+e+r,j(),U()}(e.key),$("terminal content").scrollTop($("terminal content").prop("scrollHeight"))):(e.preventDefault(),38===t&&l.length&&l.length>=-1*c+1?(c--,s=l[l.length+c],j(),U(),d=!0):40===t&&l.length&&l.length>=-1*c&&0!==c&&(c++,s=0===c?"":l[l.length+c],j(),U(),d=0!==c)):(e.preventDefault(),$("line.current bl").remove(),0!==g&&(g=0,s=p),35===t&&(u=0),36===t&&(u=-1*s.length),37===t&&s.length!==Math.abs(u)&&u--,39===t&&0!==u&&u++,j(),U())}function b(){$(document).off("keydown",y),$("#terminal").is(":visible")?($(document).on("keydown",y),console.log("Terminal keydown listener attached")):console.log("Terminal keydown listener removed")}loadDirectory(t,1,e,r,n,a),setTimeout((function(){const{column:e,direction:t}=window.fileManagerState.currentSort;$("th[data-sort]").find("i.fas").removeClass("fa-sort-up fa-sort-down").addClass("fa-sort");const n=$(`th[data-sort="${e}"]`);if(n.length){const e=n.find("i.fas");e.removeClass("fa-sort"),e.addClass("asc"===t?"fa-sort-up":"fa-sort-down")}}),500),b(),window.updateKeydownListener=b,$("[data-tabs-target]").off("click.terminal").on("click.terminal",(function(){setTimeout((()=>{window.updateKeydownListener&&window.updateKeydownListener()}),100)}))})),document.addEventListener("DOMContentLoaded",(function(){O(),document.querySelectorAll("[data-tabs-target]").forEach((e=>{e.addEventListener("click",(function(){setTimeout(O,50)}))}));const e=new MutationObserver((e=>{e.forEach((e=>{"aria-selected"===e.attributeName&&O()}))}));document.querySelectorAll('[role="tab"]').forEach((t=>{e.observe(t,{attributes:!0,attributeFilter:["aria-selected"]})}))})),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",O):O();var J={clear:function(){$("terminal content").html("")},history:function(e){var t=[];let n=e.length&&Number.isInteger(Number(e[0]))?Number(e[0]):0;if(0!=n&&n<=l.length)for(var r=l.length-n;r<l.length;r++)t[t.length]=r+1+" &nbsp;"+l[r];else l.forEach((function(e,n){t[t.length]=n+1+" &nbsp;"+e}));$("terminal content").append("<line>"+t.join("<br>")+"</line>")}};updateCurrentPath(),document.getElementById("itemLimit").addEventListener("change",(o=>{const a=o.target.value;console.log("Items per page changed to:",a),localStorage.setItem("default-items-per-page",a),window.fileManagerState.currentPage=1,loadDirectory(t,1,e,r,n,a)})),document.addEventListener("click",(function(o){o.target.classList.contains("codeme")&&function(e,t,n,r,o){const a=document.documentElement.classList.contains("dark");Swal.fire({title:"Execute PHP Code",html:'\n                <div class="flex flex-col w-full">\n                    <label for="php-code-input" class="text-left mb-2 text-gray-700 dark:text-gray-300 text-sm font-medium">Enter the PHP code to execute:</label>\n                    <textarea id="php-code-input" rows="8" class="w-full p-3 text-gray-800 dark:text-gray-200 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50 font-mono text-sm"></textarea>\n                </div>\n            ',showCancelButton:!0,confirmButtonText:"Execute",cancelButtonText:"Cancel",customClass:{popup:"dark:bg-gray-800 dark:text-gray-200",title:"text-gray-800 dark:text-gray-200",confirmButton:"bg-blue-600 hover:bg-blue-700 text-white",cancelButton:"bg-gray-500 hover:bg-gray-600 text-white"},background:a?"#1F2937":"#FFFFFF",focusConfirm:!1,preConfirm:()=>{const e=document.getElementById("php-code-input").value;return e&&""!==e.trim()?e:(Swal.showValidationMessage("Please enter PHP code to execute"),!1)}}).then((e=>{if(e.isConfirmed&&e.value){const i=e.value;sendRequest({csrf:t,action:"execute",code:i.trim(),dir:n},r,o).then((e=>{Swal.fire({title:"PHP Execution Result",html:`<div class="bg-white dark:bg-gray-800 rounded-lg p-4 shadow-md">\n                                    <pre class="text-left overflow-auto max-h-96 text-gray-800 dark:text-gray-200 font-mono text-sm bg-gray-100 dark:bg-gray-700 p-4 rounded">${e.output}</pre>\n                                  </div>`,icon:"info",confirmButtonText:"Close",customClass:{popup:"dark:bg-gray-800 dark:text-gray-200",title:"text-gray-800 dark:text-gray-200",confirmButton:"bg-blue-600 hover:bg-blue-700 text-white",htmlContainer:"p-0"},background:a?"#1F2937":"#FFFFFF",iconColor:"#3B82F6"})})).catch((e=>{triggerAlert("warning",e),console.error("Error executing PHP code:",e)}))}}))}(0,e,t,r,n)}))})),window.initEditorLanguageSelector=function(){const e=document.getElementById("editorLanguage");e&&!e.dataset.initialized&&(e.addEventListener("change",(function(){const e=this.value;if(window.editor&&e)try{window.editor.setOption("mode",e),console.log("Editor mode changed to:",e);const t=document.getElementById("editorStatus");if(t){const n=(t.textContent||"").replace(/\|.*\|/,`| ${e} |`);t.textContent=n}}catch(e){console.error("Error changing editor mode:",e)}})),e.dataset.initialized="true",console.log("Editor language selector initialized"))},document.addEventListener("DOMContentLoaded",(function(){document.querySelectorAll("[data-tabs-target]").forEach((e=>{e.addEventListener("click",(function(){handleTabSwitch(this.getAttribute("data-tabs-target"))}))}));const e=document.querySelector('[role="tab"][aria-selected="true"]');handleTabSwitch(e?e.getAttribute("data-tabs-target"):"#file")})),window.showConfirmation="function"==typeof showConfirmation?showConfirmation:function(){console.error("showConfirmation not found")},window.diagnoseFunctions=function(){console.log("--- Function Diagnostic Report ---"),console.log("updateSelectedFiles:","function"==typeof window.updateSelectedFiles?"Available ":"Missing "),console.log("saveToLocalStorage:","function"==typeof window.saveToLocalStorage?"Available ":"Missing "),console.log("getFromLocalStorage:","function"==typeof window.getFromLocalStorage?"Available ":"Missing "),console.log("freeclipbroad:","function"==typeof window.freeclipbroad?"Available ":"Missing "),console.log("performBulkAction:","function"==typeof window.performBulkAction?"Available ":"Missing "),console.log("renameFile:","function"==typeof window.renameFile?"Available ":"Missing "),console.log("loadDirectory:","function"==typeof window.loadDirectory?"Available ":"Missing "),console.log("triggerAlert:","function"==typeof window.triggerAlert?"Available ":"Missing "),console.log("showConfirmation:","function"==typeof window.showConfirmation?"Available ":"Missing "),console.log("showAdvancedSearch:","function"==typeof window.showAdvancedSearch?"Available ":"Missing "),console.log("--- fileManagerState Report ---"),console.log("fileManagerState:",window.fileManagerState?"Available ":"Missing "),window.fileManagerState&&(console.log("selectedFiles:",Array.isArray(window.fileManagerState.selectedFiles)?`Available  (${window.fileManagerState.selectedFiles.length} items)`:"Missing "),console.log("currentDir:",window.fileManagerState.currentDir||"Not set")),console.log("--- phpVars Report ---"),console.log("phpVars:",window.phpVars?"Available ":"Missing "),window.phpVars&&(console.log("csrf:",window.phpVars.csrf?"Available ":"Missing "),console.log("isEnc:",void 0!==window.phpVars.isEnc?"Available ":"Missing "),console.log("encryptionKey:",window.phpVars.encryptionKey?"Available ":"Missing "))},document.addEventListener("DOMContentLoaded",(function(){initThemeToggle(),initEnhancedTabs(),initSettings(),initGlobalKeyboardShortcuts(),exposeUtilityFunctions(),"undefined"==typeof phpVars||window.phpVars?window.phpVars||console.warn("phpVars not found in global scope"):(window.phpVars=phpVars,console.log("phpVars initialized globally")),document.querySelector(".advanced-search")?.addEventListener("click",(function(){"function"==typeof window.showAdvancedSearch?window.showAdvancedSearch():(console.error("Advanced search function not found"),triggerAlert("warning","Advanced search feature is not available"))}))})),window.saveTabsToLocalStorage=function(){try{const e=fileManagerState.tabs.map((e=>({id:e.id,path:e.path,active:e.active,name:e.name,type:e.type||"filemanager"})));localStorage.setItem("fileManager_activeTabId",fileManagerState.activeTabId),localStorage.setItem("fileManager_tabs",JSON.stringify(e));const t=fileManagerState.tabs.filter((e=>"editor"===e.type));if(t.length>0){const e=t.map((e=>e.path));localStorage.setItem("fileManager_openFiles",JSON.stringify(e))}}catch(e){console.error("Error saving tabs to localStorage:",e)}},window.loadTabsFromLocalStorage=function(){try{const e=localStorage.getItem("fileManager_tabs");if(!e)return console.log("No saved tabs found in localStorage"),!1;const t=JSON.parse(e);if(!Array.isArray(t)||0===t.length)return console.log("Invalid or empty tabs data in localStorage"),!1;const n=localStorage.getItem("fileManager_activeTabId");return fileManagerState.tabs=t,n&&fileManagerState.tabs.find((e=>e.id===n))?(fileManagerState.activeTabId=n,fileManagerState.tabs.forEach((e=>{e.active=e.id===n}))):(fileManagerState.tabs[0].active=!0,fileManagerState.activeTabId=fileManagerState.tabs[0].id),!0}catch(e){return console.error("Error loading tabs from localStorage:",e),!1}},document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("network-tab");e&&e.addEventListener("click",(function(){initNetworkTools()}))}));
