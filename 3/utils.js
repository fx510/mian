function e(e,t,n){if(!e.csrf)throw new Error("CSRF token is missing.");const o=JSON.stringify(e);let r=t;"1"===n&&"string"==typeof t&&(r=CryptoJS.enc.Utf8.parse(t));const a="1"===n?c(o,r):o;return new Promise((e,t)=>{console.log("Sending request with encryption:","1"===n),$.post("",a).done(o=>{try{let a;if(console.log("Raw response:",o.substring(0,50)+(o.length>50?"...":"")),"1"===n)try{a=d(o,r),console.log("Decryption succeeded")}catch(e){console.error("Decryption failed:",e),console.log("Attempting to parse response as-is"),a=o}else a=o;const i=JSON.parse(a);i.error?t(new Error(i.error)):e(i)}catch(e){console.error("Failed to parse response:",e),console.error("Raw response:",o),t(new Error("Failed to parse server response. Check console for details.")),s("warning","Failed to parse server response")}}).fail((e,n,o)=>{console.error("Network error:",n,o),console.error("Status code:",e.status),console.error("Response text:",e.responseText),t(new Error(`Network error: ${n} - ${o||e.status}`)),s("warning",`Request failed: ${n} ${o||""}`)})})}function t(e,t,n,o){const r=document.documentElement.classList.contains("dark");Swal.fire({title:e,text:t,icon:"warning",showCancelButton:!0,confirmButtonText:n,cancelButtonText:"Cancel",customClass:{popup:r?"bg-gray-900 text-white":"bg-white text-gray-900",confirmButton:r?"bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded":"bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded",cancelButton:r?"bg-gray-700 hover:bg-gray-800 text-white font-bold py-2 px-4 rounded":"bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded"}}).then(e=>{e.isConfirmed&&o()})}function n(t,n,o,r,i){!function(e,t,n,o,r){const a=document.documentElement.classList.contains("dark");Swal.fire({title:e,input:"text",inputLabel:t,inputValue:o,showCancelButton:!0,confirmButtonText:n,cancelButtonText:"Cancel",customClass:{popup:a?"bg-gray-900 text-white":"bg-white text-gray-900",confirmButton:a?"bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded":"bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded",cancelButton:a?"bg-gray-700 hover:bg-gray-800 text-white font-bold py-2 px-4 rounded":"bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded",input:a?"bg-gray-800 text-white border-gray-700":"bg-white text-gray-900 border-gray-300"}}).then(e=>{if(e.isConfirmed){const t=e.value.trim();r(t)}})}("Rename File","Enter the new name for the file:","Rename",t,l=>{l&&l.trim()!==t&&e({csrf:n,action:"rename",oldName:t,newName:l.trim(),dir:o},r,i).then(()=>{s("success","File renamed successfully!"),a(o,1,n,r,i)}).catch(e=>{s("warning",e),console.error("Error renaming file:",e)})})}function o(){isLoading||(isLoading=!0,NProgress.start())}function r(){NProgress.done(),isLoading=!1}function a(e,t,n,a,l,d){if(o(),!d){const e=localStorage.getItem("default-items-per-page");d=e?parseInt(e,10):50}"string"==typeof d&&("all"===d.toLowerCase()||(d=parseInt(d,10))),"all"!==d&&(isNaN(d)||d<=0)&&(d=50);const u={csrf:n,action:"list",dir:e,page:t,itemsPerPage:d},f=JSON.stringify(u),g="1"===l?c(f,a):f;$.post("",g,function(o){i(o,l,a,e,t,n),r()}).fail(function(){s("warning","An error occurred while loading the directory."),r()})}function i(e,t,n,o,r,a){try{let i="1"===t?d(e,n):e;const l=JSON.parse(i);if(window.fileManagerState||(window.fileManagerState={files:[],totalPages:1,currentPage:1,totalItems:0,itemsPerPage:50,currentSort:{column:"name",direction:"asc"},selectedFiles:[]}),l.error)s("warning",l.error);else{window.fileManagerState.files=l.files,window.fileManagerState.totalPages=l.totalPages,window.fileManagerState.currentPage=r,window.fileManagerState.currentDir=o,window.fileManagerState.totalItems=l.totalItems||0;const e=document.getElementById("itemLimit");window.fileManagerState.itemsPerPage=e?"all"===e.value?"all":parseInt(e.value,10):50,"function"==typeof window.updateCurrentPath&&window.updateCurrentPath(o),f(l.files,o,a,n,t),"function"==typeof window.updateBreadcrumbs&&window.updateBreadcrumbs(o),"function"==typeof window.updateActiveTabPath&&(window.updateActiveTabPath(o),"function"==typeof window.saveTabsToLocalStorage&&window.saveTabsToLocalStorage()),L()}}catch(e){s("warning","Failed to parse server response."),console.error("Error parsing directory response:",e)}}function l(e,t,n,o,r){let a,i,l,s="text-blue-600 dark:text-blue-400";e.wr?(a="text-green-600 dark:text-green-400",i="Writable",l="bg-green-50 dark:bg-green-900/10"):e.perms&&e.perms.includes("r")?(a="text-yellow-600 dark:text-yellow-400",i="Read Only",l="bg-yellow-50 dark:bg-yellow-900/10"):(a="text-blue-600 dark:text-blue-400",i="No Read/Write Access",l="bg-blue-50 dark:bg-blue-900/10");e.is_dir?s="text-yellow-600 dark:text-yellow-400":e.name.endsWith(".php")||e.name.endsWith(".py")||e.name.endsWith(".js")?s="text-green-600 dark:text-green-400":(e.name.endsWith(".zip")||e.name.endsWith(".tar")||e.name.endsWith(".gz"))&&(s="text-amber-600 dark:text-amber-400");const c=`${t}/${e.name}`,d=`file-checkbox-${e.name.replace(/[^a-zA-Z0-9]/g,"_")}`,u=window.fileManagerState&&window.fileManagerState.selectedFiles&&(window.fileManagerState.selectedFiles.includes(c)||window.fileManagerState.selectedFiles.includes(e.name)),f=u?"checked":"";let g="border-b border-gray-200 dark:border-gray-700 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-150";return g+=u?" bg-blue-50 dark:bg-blue-900/20":" "+l,`\n        <tr class="${g}" data-file="${e.name}" data-full-path="${c}">\n            <td class="py-1 px-3 text-left">\n                <input type="checkbox" id="${d}" \n                    class="file-checkbox w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 dark:focus:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600" \n                    data-file="${e.name}" \n                    data-full-path="${c}" \n                    ${f} \n                />\n            </td>\n            <td class="py-3 px-6 text-left text-gray-900 dark:text-gray-300">\n                <div class="flex items-center">\n                    <i class="fas ${e.icon} mr-2 ${s}"></i>\n                ${e.is_dir?`<a href="#" class="font-medium directory-link hover:text-blue-600 dark:hover:text-blue-400 transition-colors duration-150" data-path="${c}">${e.name}</a>`:`<a href="#" class="font-medium file-link hover:text-blue-600 dark:hover:text-blue-400 transition-colors duration-150" data-file="${c}">${e.name}</a>`}\n                </div>\n            </td>\n            <td class="py-3 px-6 text-left text-gray-900 dark:text-gray-300">${e.size}</td>\n            <td class="py-3 px-6 text-left text-gray-900 dark:text-gray-300">${e.mtime}</td>\n            <td class="py-3 px-6 text-left text-gray-900 dark:text-gray-300">${e.owner}</td>\n            <td class="py-3 px-6 text-left" title="${i}">\n                ${S(e.perms,e.wr)}\n            </td>\n            <td class="py-3 px-6 text-left text-gray-900 dark:text-gray-300">\n                <div class="flex space-x-2">\n                ${e.is_dir?`<button class="p-1 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors duration-150">\n                              <i class="fas fa-edit text-yellow-600 dark:text-yellow-400" title="Rename" data-file="${e.name}"></i>\n                           </button>\n                           <button class="p-1 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors duration-150">\n                              <i class="fas fa-trash-alt text-red-600 dark:text-red-400" title="Delete" data-file="${c}"></i>\n                           </button>`:`<button class="p-1 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors duration-150">\n                              <i class="fas fa-edit text-yellow-600 dark:text-yellow-400" title="Rename" data-file="${e.name}"></i>\n                           </button>\n                           <button class="p-1 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors duration-150">\n                              <i class="fas fa-trash-alt text-red-600 dark:text-red-400" title="Delete" data-file="${c}"></i>\n                           </button>\n                           <button class="p-1 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors duration-150">\n                              <i class="fas fa-download text-green-600 dark:text-green-400" title="Download" data-file="${c}"></i>\n                           </button>`}\n                </div>\n            </td>\n        </tr>\n    `}function s(e,t){document.dispatchEvent(new CustomEvent("show-alert",{detail:{type:e,message:t}}))}function c(e,t){return CryptoJS.AES.encrypt(CryptoJS.enc.Utf8.parse(e),t,{mode:CryptoJS.mode.ECB,padding:CryptoJS.pad.Pkcs7}).toString()}function d(e,t){return CryptoJS.AES.decrypt(e,t,{mode:CryptoJS.mode.ECB,padding:CryptoJS.pad.Pkcs7}).toString(CryptoJS.enc.Utf8)}function u(e,t){if(!e||!Array.isArray(e))return console.error("Invalid files array provided to searchFiles"),[];if(!t||""===t.trim())return e;const n=t.toLowerCase().trim();return e.filter(e=>!!e&&(e.name&&e.name.toLowerCase().includes(n)||e.owner&&e.owner.toLowerCase().includes(n)||e.perms&&e.perms.toLowerCase().includes(n)||e.size&&e.size.toString().toLowerCase().includes(n)||e.mtime&&e.mtime.toLowerCase().includes(n)))}function f(e,t,n,o,r){const a=document.getElementById("searchBar")||document.querySelector("#searchBar"),i=a?a.value.toLowerCase().trim():"",s=document.getElementById("fileList");if(!s)return void console.error("File list element not found");if(!e||0===e.length)return s.innerHTML='<tr><td colspan="7" class="py-4 text-center text-gray-500">No files found</td></tr>',void L();const c=u(e,i);0===c.length?s.innerHTML='<tr><td colspan="7" class="py-4 text-center text-gray-500">No matching files found</td></tr>':s.innerHTML=c.map(e=>l(e,t)).join(""),g(),L()}function g(){const e=document.querySelectorAll(".file-checkbox");window.fileManagerState||(window.fileManagerState={selectedFiles:[]}),window.fileManagerState.selectedFiles||(window.fileManagerState.selectedFiles=[]),e.forEach(e=>{e.removeEventListener("change",p),e.addEventListener("change",p);const t=e.dataset.fullPath||e.dataset.file;if(window.fileManagerState.selectedFiles.includes(t)){console.log(`Setting checkbox for ${t} to checked based on fileManagerState`),e.checked=!0;const n=e.closest("tr");n&&n.classList.add("bg-blue-50","dark:bg-blue-900/20")}else{e.checked=!1;const t=e.closest("tr");t&&t.classList.remove("bg-blue-50","dark:bg-blue-900/20")}}),m()}function m(){const e=document.getElementById("selectAll");if(!e)return;const t=document.querySelectorAll(".file-checkbox");if(0===t.length)return;const n=Array.from(t).every(e=>e.checked),o=Array.from(t).some(e=>e.checked);e.checked=n,e.indeterminate=!n&&o}function p(){const e=this.closest("tr"),t=this.dataset.file,n=this.dataset.fullPath||t;console.log("Checkbox changed:",t),console.log("Checkbox state:",this.checked?"checked":"unchecked"),console.log("Full path:",n),console.log("Selected files before update:",window.fileManagerState?.selectedFiles?[...window.fileManagerState.selectedFiles]:[]),this.checked?(e.classList.add("bg-blue-50","dark:bg-blue-900/20"),w(n,!0,!0)):(e.classList.remove("bg-blue-50","dark:bg-blue-900/20"),w(n,!1,!0)),console.log("Selected files after update:",window.fileManagerState?.selectedFiles?[...window.fileManagerState.selectedFiles]:[]);const o=document.querySelectorAll(".file-checkbox:checked");console.log("Total checked checkboxes:",o.length),m()}function b(){if(!window.fileManagerState)return void(window.fileManagerState={files:[],totalPages:1,currentPage:1,currentSort:{column:"name",direction:"asc"},selectedFiles:[]});const{column:e,direction:t}=window.fileManagerState.currentSort;window.fileManagerState.files.sort((n,o)=>{let r,a;switch(e){case"name":default:r=n.name.toLowerCase(),a=o.name.toLowerCase();break;case"size":r="dir"===n.size?-1:parseFloat(n.size),a="dir"===o.size?-1:parseFloat(o.size);break;case"mtime":case"modified":r=new Date(n.mtime).getTime(),a=new Date(o.mtime).getTime();break;case"owner":r=n.owner.toLowerCase(),a=o.owner.toLowerCase();break;case"perms":r=n.perms,a=o.perms}return"asc"===t?r>a?1:-1:r<a?1:-1})}function w(e,t,n=!1){console.log(`updateSelectedFiles called: ${e}, checked: ${t}, isFullPath: ${n}`),window.fileManagerState||(console.log("Initializing fileManagerState"),window.fileManagerState={selectedFiles:[]}),window.fileManagerState.selectedFiles||(console.log("Initializing selectedFiles array"),window.fileManagerState.selectedFiles=[]);let o=e;if(n)console.log(`Using provided fullPath: ${o}`);else{const t=document.querySelector(`.file-checkbox[data-file="${e}"]`);if(console.log("Checkbox found:",t?"yes":"no"),t&&t.dataset.fullPath)o=t.dataset.fullPath,console.log(`Using fullPath from checkbox: ${o}`);else if(!e.includes("/")){const t=window.fileManagerState.currentDir||"";t&&(o=`${t}/${e}`,console.log(`Constructed fullPath: ${o}`))}}t?window.fileManagerState.selectedFiles.includes(o)?console.log(`File already in selectedFiles: ${o}`):(console.log(`Adding to selectedFiles: ${o}`),window.fileManagerState.selectedFiles.push(o)):(console.log(`Removing from selectedFiles: ${o}`),window.fileManagerState.selectedFiles=window.fileManagerState.selectedFiles.filter(e=>e!==o)),console.log("Selected Files after update:",window.fileManagerState.selectedFiles),console.log("Selected Files count:",window.fileManagerState.selectedFiles.length)}window.sortFiles=b;let y=null,h=null;function x(e){e.preventDefault();const t=document.getElementById("context-menu");t&&(k(),function(e){let t=e.target;if(t.closest("tr")){const e=t.closest("tr"),n=e.querySelector(".file-checkbox");if(n&&n.dataset.file){y=n.dataset.file;const t=null!==e.querySelector(".directory-link");return h=t?"folder":"file",void(document.querySelectorAll(".file-checkbox:checked").length>1&&n.checked&&(h="multiple"))}}y=document.getElementById("fileList"),h="background"}(e),function(){const e=document.getElementById("context-menu");if(!e)return;k(),"file"===h?(e.querySelector(".file-operations").classList.remove("hidden"),e.querySelector(".clipboard-operations").classList.remove("hidden")):"folder"===h?(e.querySelector(".folder-operations").classList.remove("hidden"),e.querySelector(".clipboard-operations").classList.remove("hidden")):"multiple"===h?e.querySelector(".clipboard-operations").classList.remove("hidden"):"background"===h&&(e.querySelector(".bg-operations").classList.remove("hidden"),e.querySelector(".paste-option").classList.remove("hidden"))}(),function(){const e=document.querySelector(".paste-option");if(!e)return;null!==localStorage.getItem("copiedFiles")?e.classList.remove("hidden"):e.classList.add("hidden")}(),function(e,t){const n=document.getElementById("context-menu");if(!n)return;const o=window.innerWidth,r=window.innerHeight;n.style.visibility="hidden",n.classList.remove("hidden");const a=n.offsetWidth,i=n.offsetHeight;let l=e,s=t;e+a>o&&(l=o-a-5);t+i>r&&(s=r-i-5);n.style.left=`${l}px`,n.style.top=`${s}px`,n.style.visibility="visible"}(e.clientX,e.clientY),t.classList.remove("hidden"))}function k(){const e=document.getElementById("context-menu");if(!e)return;e.querySelectorAll(".context-menu-group").forEach(e=>e.classList.add("hidden"))}function v(){const e=document.getElementById("context-menu");e&&e.classList.add("hidden"),y=null}function S(e,t=null,n=!0){if(!e||"string"!=typeof e||9!==e.length)return'<span class="text-blue-600 dark:text-blue-400">invalid</span>';let o;o=null!==t?t?"text-green-600 dark:text-green-400":n?"text-yellow-600 dark:text-yellow-400":"text-blue-600 dark:text-blue-400":e.includes("w")?"text-green-600 dark:text-green-400":e.includes("r")?"text-yellow-600 dark:text-yellow-400":"text-blue-600 dark:text-blue-400";let r="";for(let t=0;t<e.length;t++)r+=e[t],2!==t&&5!==t||(r+=" ");return`<span class="${o} font-mono">${r}</span>`}function L(){const e=document.querySelector(".overflow-x-auto table");if(!e)return;const t=window.fileManagerState||{},n=t.totalItems||0,o=t.currentPage||1,r=t.itemsPerPage||50,a=t.files?t.files.length:0,i=0===n?0:"all"===r?1:(o-1)*r+1,l="all"===r?n:Math.min(i+a-1,n);let s=e.querySelector("tfoot");s&&s.remove(),s=document.createElement("tfoot"),s.className="bg-gray-50 dark:bg-gray-700 text-xs text-gray-500 dark:text-gray-400 border-t border-gray-200 dark:border-gray-700",s.innerHTML=`\n        <tr> \n            <td colspan="7" class="py-3 px-6">\n                <div class="flex justify-between items-center">\n                   \n                    <div>\n                        <span class="font-medium">Showing:</span> \n                        <span class="text-blue-600 dark:text-blue-400 font-medium">${l}</span> \n                        of \n                        <span class="text-blue-600 dark:text-blue-400 font-medium">${n}</span> items\n                    </div>\n                </div>\n            </td>\n        </tr>\n    `,e.appendChild(s);const c=document.getElementById("fileTableFooter");c&&c.remove()}window.initContextMenu=function(o={}){document.getElementById("context-menu")||function(){const e=document.createElement("div");e.id="context-menu",e.className="hidden absolute z-50 min-w-[200px] bg-white dark:bg-gray-800 shadow-lg rounded-md py-2 border border-gray-200 dark:border-gray-700",e.innerHTML='\n        <div class="context-menu-group file-operations hidden">\n            <button class="context-menu-item" data-action="rename">\n                <i class="fas fa-signature mr-2"></i>Rename\n            </button>\n            <button class="context-menu-item" data-action="download">\n                <i class="fas fa-download mr-2"></i>Download\n            </button>\n        </div>\n        <div class="context-menu-group folder-operations hidden">\n            <button class="context-menu-item" data-action="open-folder">\n                <i class="fas fa-folder-open mr-2"></i>Open\n            </button>\n            <button class="context-menu-item" data-action="open-folder-new-tab">\n                <i class="fas fa-external-link-alt mr-2"></i>Open in New Tab\n            </button>\n            <button class="context-menu-item" data-action="rename-folder">\n                <i class="fas fa-signature mr-2"></i>Rename\n            </button>\n        </div>\n        <div class="context-menu-group clipboard-operations">\n            <button class="context-menu-item" data-action="copy">\n                <i class="fas fa-copy mr-2"></i>Copy\n            </button>\n            <button class="context-menu-item" data-action="cut">\n                <i class="fas fa-cut mr-2"></i>Cut\n            </button>\n            <button class="context-menu-item paste-option hidden" data-action="paste">\n                <i class="fas fa-paste mr-2"></i>Paste\n            </button>\n        </div>\n        <div class="context-menu-divider border-t border-gray-200 dark:border-gray-700 my-1"></div>\n        <div class="context-menu-group danger-operations">\n            <button class="context-menu-item text-red-600 dark:text-red-400" data-action="delete">\n                <i class="fas fa-trash-alt mr-2"></i>Delete\n            </button>\n        </div>\n        <div class="context-menu-group bg-operations hidden">\n            <div class="context-menu-divider border-t border-gray-200 dark:border-gray-700 my-1"></div>\n            <button class="context-menu-item" data-action="new-file">\n                <i class="fas fa-file-circle-plus mr-2"></i>New File\n            </button>\n            <button class="context-menu-item" data-action="new-folder">\n                <i class="fas fa-folder-plus mr-2"></i>New Folder\n            </button>\n            <button class="context-menu-item" data-action="refresh">\n                <i class="fas fa-sync-alt mr-2"></i>Refresh\n            </button>\n        </div>\n    ';const t=document.createElement("style");t.textContent="\n        .context-menu-item {\n            display: flex;\n            align-items: center;\n            width: 100%;\n            text-align: left;\n            padding: 0.5rem 1rem;\n            font-size: 0.875rem;\n            white-space: nowrap;\n            color: #374151; /* gray-700 */\n            transition: background-color 0.15s ease;\n        }\n        .dark .context-menu-item {\n            color: #e5e7eb; /* gray-200 */\n        }\n        .context-menu-item:hover {\n            background-color: rgba(59, 130, 246, 0.1);\n        }\n        .dark .context-menu-item:hover {\n            background-color: rgba(96, 165, 250, 0.1);\n        }\n        .context-menu-item:focus {\n            outline: none;\n            background-color: rgba(59, 130, 246, 0.15);\n        }\n        .dark .context-menu-item:focus {\n            background-color: rgba(96, 165, 250, 0.15);\n        }\n        .context-menu-item i {\n            color: #4b5563; /* gray-600 */\n        }\n        .dark .context-menu-item i {\n            color: #d1d5db; /* gray-300 */\n        }\n        .context-menu-item.text-red-600 i {\n            color: #dc2626; /* red-600 */\n        }\n        .dark .context-menu-item.text-red-400 i {\n            color: #f87171; /* red-400 */\n        }\n        @keyframes contextMenuFadeIn {\n            from { opacity: 0; transform: scale(0.95); }\n            to { opacity: 1; transform: scale(1); }\n        }\n        #context-menu {\n            transform-origin: top left;\n            animation: contextMenuFadeIn 0.1s ease-out forwards;\n            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);\n        }\n        .dark #context-menu {\n            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.18);\n        }\n    ",document.head.appendChild(t),document.body.appendChild(e)}(),document.getElementById("context-menu"),document.getElementById("file").addEventListener("contextmenu",x),document.addEventListener("click",v),window.addEventListener("blur",v),window.addEventListener("resize",v),document.addEventListener("scroll",v,!0),function(){const o=document.getElementById("context-menu");if(!o)return;const r=o.querySelectorAll(".context-menu-item");r.forEach(o=>{o.addEventListener("click",r=>{r.stopPropagation();!function(o){const r=window.fileManagerState?.currentDir||phpVars?.currentDir,i=phpVars?.csrf,l=phpVars?.encryptionKey?CryptoJS.enc.Utf8.parse(phpVars.encryptionKey):null,d=phpVars?.isEnc,u=(e,t)=>e.endsWith("/")?e+t:e+"/"+t;switch(o){case"open-folder":if(y){const e=u(r,y);window.currentDir=e,window.updateCurrentPath(),a(e,1,i,l,d),window.updateActiveTabPath(e)}break;case"open-folder-new-tab":if(y){const e=u(r,y);if("function"==typeof window.addNewTab){window.addNewTab(y);a(e,1,i,l,d),window.updateActiveTabPath(e)}else console.warn("addNewTab function not found, using current tab"),window.currentDir=e,window.updateCurrentPath(),a(e,1,i,l,d),window.updateActiveTabPath(e)}break;case"rename":case"rename-folder":y&&n(y,i,r,l,d);break;case"download":y&&function(e,t,n,o){const r={csrf:t,action:"download",file:e},a=JSON.stringify(r),i="1"===o?c(a,n):a;fetch("",{method:"POST",headers:{"Content-Type":"application/json"},body:i}).then(e=>{if(e.ok)return e.blob();throw new Error("Failed to download file")}).then(t=>{const n=window.URL.createObjectURL(t),o=document.createElement("a");o.href=n,o.download=e.split("/").pop(),document.body.appendChild(o),o.click(),window.URL.revokeObjectURL(n),document.body.removeChild(o)}).catch(e=>{console.error("Error downloading file:",e),s("warning","Failed to download file. Please try again.")})}(u(r,y),i,l,d);break;case"copy":if("multiple"===h){const e=Array.from(document.querySelectorAll(".file-checkbox:checked")).map(e=>{const t=e.dataset.file;return u(r,t)});saveToLocalStorage(e)}else y&&saveToLocalStorage([u(r,y)]);s("success","Item(s) copied to clipboard");break;case"cut":if("multiple"===h){const e=Array.from(document.querySelectorAll(".file-checkbox:checked")).map(e=>{const t=e.dataset.file;return u(r,t)});saveToLocalStorage(e),localStorage.setItem("clipboard-action","cut")}else y&&(saveToLocalStorage([u(r,y)]),localStorage.setItem("clipboard-action","cut"));s("info","Item(s) ready to move");break;case"paste":const o=getFromLocalStorage();o&&o.length>0?(console.log("Attempting to paste files:",o),console.log("Current directory:",r),s("info",`Pasting ${o.length} item(s)...`),performBulkAction("paste",o,r,i,l,d),function(){try{localStorage.removeItem("copiedFiles"),console.log("Clipboard cleared")}catch(e){console.error("Failed to clear clipboard:",e)}}(),localStorage.removeItem("clipboard-action")):s("warning","No items in clipboard");break;case"delete":if("multiple"===h){const e=Array.from(document.querySelectorAll(".file-checkbox:checked")).map(e=>e.dataset.file);t("Delete Files",`Are you sure you want to delete ${e.length} file(s)?`,"Delete",()=>{performBulkAction("delete",e,r,i,l,d)})}else y&&function(n,o,r,i,l){console.log("currentDir : "+r),t("Delete File",`Are you sure you want to delete tjis "${n}"?`,"Delete",()=>{e({csrf:o,action:"delete",file:n,dir:r},i,l).then(()=>{s("success",`"${n}" has been deleted successfully!`),a(r,1,o,i,l)}).catch(e=>{s("warning",e),console.error("Error deleting file:",e)})})}(y,i,r,l,d);break;case"refresh":a(r,1,i,l,d)}}(o.dataset.action),v()})})}()},window.renderFiles=f;
