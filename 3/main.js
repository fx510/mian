function e(){const e=document.getElementById("theme-toggle");"dark"===localStorage.getItem("color-theme")||!localStorage.getItem("color-theme")&&window.matchMedia("(prefers-color-scheme: dark)").matches?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),e.addEventListener("click",function(){document.documentElement.classList.toggle("dark"),document.documentElement.classList.contains("dark")?localStorage.setItem("color-theme","dark"):localStorage.setItem("color-theme","light"),window.editor&&window.editor.updateOptions({theme:document.documentElement.classList.contains("dark")?"vs-dark":"vs"})})}function t(){const e=document.querySelectorAll('[role="tab"]'),t=document.querySelectorAll('[role="tabpanel"]');if(e.length>0&&t.length>0){const t=e[0],n=t.getAttribute("data-tabs-target"),r=document.querySelector(n);r&&(r.classList.remove("hidden"),t.classList.add("text-blue-600","border-blue-600"),t.classList.remove("text-gray-500","border-transparent"),t.setAttribute("aria-selected","true"))}e.forEach(n=>{n.addEventListener("click",()=>{const r=n.getAttribute("data-tabs-target"),o=document.querySelector(r);t.forEach(e=>{e.classList.add("hidden")}),e.forEach(e=>{e.classList.remove("text-blue-600","border-blue-600"),e.classList.add("text-gray-500","border-transparent"),e.setAttribute("aria-selected","false")}),n.classList.add("text-blue-600","border-blue-600"),n.classList.remove("text-gray-500","border-transparent"),n.setAttribute("aria-selected","true"),o&&o.classList.remove("hidden"),i(r)})})}function n(){!function(){const e=localStorage.getItem("font-size")||"14";document.documentElement.style.fontSize=e+"px";const t=document.getElementById("font-size");t&&(t.value=e);const n=localStorage.getItem("terminal-font-size")||"14",r=document.querySelector("terminal content");r&&(r.style.fontSize=n+"px");const o=document.getElementById("terminal-font-size");o&&(o.value=n);const a="false"!==localStorage.getItem("enable-animations");document.body.classList.toggle("disable-animations",!a);const i=document.getElementById("enable-animations");i&&(i.checked=a);const l="true"===localStorage.getItem("show-hidden-files"),s=document.getElementById("show-hidden");s&&(s.checked=l);const c="false"!==localStorage.getItem("show-file-size"),d=document.getElementById("show-file-size");d&&(d.checked=c);const u="false"!==localStorage.getItem("show-file-date"),g=document.getElementById("show-file-date");g&&(g.checked=u);const m=localStorage.getItem("default-sort")||"date-desc",f=document.getElementById("default-sort");f&&(f.value=m);const p="false"!==localStorage.getItem("terminal-wrap"),h=document.getElementById("terminal-wrap");h&&(h.checked=p);const y="true"===localStorage.getItem("terminal-bell"),b=document.getElementById("terminal-bell");b&&(b.checked=y);const w=localStorage.getItem("terminal-theme")||"default",v=document.getElementById("terminal-theme");v&&(v.value=w);const x=localStorage.getItem("editor-theme")||"system",k=document.getElementById("editor-theme");k&&(k.value=x);const S=localStorage.getItem("tab-size")||"4",E=document.getElementById("tab-size");E&&(E.value=S);const I="false"!==localStorage.getItem("word-wrap"),L=document.getElementById("word-wrap");L&&(L.checked=I);const M="false"!==localStorage.getItem("auto-close-brackets"),B=document.getElementById("auto-close-brackets");B&&(B.checked=M);const A="false"!==localStorage.getItem("highlight-active-line"),C=document.getElementById("highlight-active-line");C&&(C.checked=A);const T=localStorage.getItem("default-items-per-page")||"50",$=document.getElementById("default-items");$&&($.value=T);const F=document.getElementById("itemLimit");F&&T&&(F.value=T)}(),document.getElementById("light-theme-btn")?.addEventListener("click",()=>{document.documentElement.classList.remove("dark"),localStorage.setItem("color-theme","light"),r("vs")}),document.getElementById("dark-theme-btn")?.addEventListener("click",()=>{document.documentElement.classList.add("dark"),localStorage.setItem("color-theme","dark"),r("vs-dark")}),document.getElementById("system-theme-btn")?.addEventListener("click",()=>{localStorage.removeItem("color-theme"),window.matchMedia("(prefers-color-scheme: dark)").matches?(document.documentElement.classList.add("dark"),r("vs-dark")):(document.documentElement.classList.remove("dark"),r("vs"))});const e=document.getElementById("font-size");e&&e.addEventListener("input",e=>{const t=e.target.value;document.documentElement.style.fontSize=t+"px",localStorage.setItem("font-size",t)});const t=document.getElementById("terminal-font-size");t&&t.addEventListener("input",e=>{const t=e.target.value,n=document.querySelector("terminal content");n&&(n.style.fontSize=t+"px"),localStorage.setItem("terminal-font-size",t)});const n=document.getElementById("enable-animations");n&&n.addEventListener("change",e=>{document.body.classList.toggle("disable-animations",!e.target.checked),localStorage.setItem("enable-animations",e.target.checked)});const o=document.getElementById("show-hidden");o&&o.addEventListener("change",e=>{localStorage.setItem("show-hidden-files",e.target.checked),loadDirectory(currentDir,1,csrf,key,isEnc)});const a=document.getElementById("show-file-size");a&&a.addEventListener("change",e=>{localStorage.setItem("show-file-size",e.target.checked),loadDirectory(currentDir,1,csrf,key,isEnc)});const i=document.getElementById("show-file-date");i&&i.addEventListener("change",e=>{localStorage.setItem("show-file-date",e.target.checked),loadDirectory(currentDir,1,csrf,key,isEnc)});const l=document.getElementById("default-sort");l&&l.addEventListener("change",e=>{localStorage.setItem("default-sort",e.target.value),loadDirectory(currentDir,1,csrf,key,isEnc)});const s=document.getElementById("terminal-wrap");s&&s.addEventListener("change",e=>{localStorage.setItem("terminal-wrap",e.target.checked),window.terminal&&window.terminal.setOption("wrap",e.target.checked)});const c=document.getElementById("terminal-bell");c&&c.addEventListener("change",e=>{localStorage.setItem("terminal-bell",e.target.checked),window.terminal&&window.terminal.setOption("bellStyle",e.target.checked?"sound":"none")});const d=document.getElementById("terminal-theme");d&&d.addEventListener("change",e=>{localStorage.setItem("terminal-theme",e.target.value),window.terminal&&window.terminal.setOption("theme",e.target.value)});const u=document.getElementById("editor-theme");u&&u.addEventListener("change",e=>{const t=e.target.value;"system"===t?(r(window.matchMedia("(prefers-color-scheme: dark)").matches?"vs-dark":"vs"),localStorage.setItem("editor-theme","system")):(r(t),localStorage.setItem("editor-theme",t))});const g=document.getElementById("tab-size");g&&g.addEventListener("change",e=>{const t=e.target.value;window.editor&&window.editor.setOption("tabSize",parseInt(t)),localStorage.setItem("tab-size",t)});const m=document.getElementById("word-wrap");m&&m.addEventListener("change",e=>{window.editor&&window.editor.setOption("lineWrapping",e.target.checked),localStorage.setItem("word-wrap",e.target.checked)});const f=document.getElementById("auto-close-brackets");f&&f.addEventListener("change",e=>{window.editor&&window.editor.setOption("autoCloseBrackets",e.target.checked),localStorage.setItem("auto-close-brackets",e.target.checked)});const p=document.getElementById("highlight-active-line");p&&p.addEventListener("change",e=>{window.editor&&window.editor.setOption("styleActiveLine",e.target.checked),localStorage.setItem("highlight-active-line",e.target.checked)});const h=document.getElementById("default-items");h&&h.addEventListener("change",e=>{const t=e.target.value;localStorage.setItem("default-items-per-page",t);const n=document.getElementById("itemLimit");if(n){n.value=t;const e=new Event("change");n.dispatchEvent(e)}}),document.getElementById("save-settings")?.addEventListener("click",()=>{!function(){const e=document.getElementById("font-size");e&&localStorage.setItem("font-size",e.value);const t=document.getElementById("terminal-font-size");t&&localStorage.setItem("terminal-font-size",t.value);const n=document.getElementById("enable-animations");n&&localStorage.setItem("enable-animations",n.checked);const r=document.getElementById("show-hidden");r&&localStorage.setItem("show-hidden-files",r.checked);const o=document.getElementById("show-file-size");o&&localStorage.setItem("show-file-size",o.checked);const a=document.getElementById("show-file-date");a&&localStorage.setItem("show-file-date",a.checked);const i=document.getElementById("default-sort");i&&localStorage.setItem("default-sort",i.value);const l=document.getElementById("terminal-wrap");l&&localStorage.setItem("terminal-wrap",l.checked);const s=document.getElementById("terminal-bell");s&&localStorage.setItem("terminal-bell",s.checked);const c=document.getElementById("terminal-theme");c&&localStorage.setItem("terminal-theme",c.value);const d=document.getElementById("editor-theme");d&&localStorage.setItem("editor-theme",d.value);const u=document.getElementById("tab-size");u&&localStorage.setItem("tab-size",u.value);const g=document.getElementById("word-wrap");g&&localStorage.setItem("word-wrap",g.checked);const m=document.getElementById("auto-close-brackets");m&&localStorage.setItem("auto-close-brackets",m.checked);const f=document.getElementById("highlight-active-line");f&&localStorage.setItem("highlight-active-line",f.checked);const p=document.getElementById("default-items");p&&localStorage.setItem("default-items-per-page",p.value)}(),triggerAlert("success","Settings saved successfully!")})}function r(e){window.editorThemePreference=e;let t="eclipse";if(("vs-dark"===e||"system"===e&&window.matchMedia("(prefers-color-scheme: dark)").matches)&&(t="dracula"),window.editor&&"function"==typeof window.editor.setOption)try{window.editor.setOption("theme",t);const e=document.getElementById("editorContainer");e&&("dracula"===t?(e.classList.add("dark-editor"),e.classList.remove("light-editor")):(e.classList.add("light-editor"),e.classList.remove("dark-editor")));const n=document.getElementById("editorStatus");n&&("dracula"===t?(n.classList.add("dark-status"),n.classList.remove("light-status")):(n.classList.add("light-status"),n.classList.remove("dark-status"))),console.log("Editor theme updated to:",t)}catch(e){console.error("Error updating editor theme:",e)}else console.log("CodeMirror editor not available, theme will be applied when editor loads")}function o(){const e=[{key:"Delete",action:"Delete selected files"},{key:"Ctrl+A",action:"Select all files"},{key:"Ctrl+C",action:"Copy selected files"},{key:"Ctrl+X",action:"Cut selected files"},{key:"Ctrl+V",action:"Paste files"},{key:"Ctrl+F",action:"Search files (when implemented)"},{key:"F2",action:"Rename selected file"},{key:"F5",action:"Refresh directory"},{key:"Alt+Up",action:"Navigate to parent directory"},{key:"Escape",action:"Deselect all files / Close dialogs"},{key:"?",action:"Show this help dialog"}];function t(){let t='<div class="overflow-x-auto"><table class="w-full text-sm text-left">';t+='<thead class="text-xs uppercase bg-gray-100 dark:bg-gray-700"><tr><th class="px-6 py-3">Key</th><th class="px-6 py-3">Action</th></tr></thead><tbody>',e.forEach(e=>{t+=`<tr class="border-b dark:border-gray-700"><td class="px-6 py-4 font-medium">${e.key}</td><td class="px-6 py-4">${e.action}</td></tr>`}),t+="</tbody></table></div>",Swal.fire({title:"Keyboard Shortcuts",html:t,customClass:{popup:"dark:bg-gray-800 dark:text-white"}})}keyboardShortcutsBtn&&keyboardShortcutsBtn.addEventListener("click",t),document.addEventListener("keydown",function(e){if("INPUT"===e.target.tagName||"TEXTAREA"===e.target.tagName||e.target.classList.contains("CodeMirror")||document.querySelector("#terminal:not(.hidden)"))return;if(!window.fileManagerState)return void console.error("fileManagerState is not initialized");const n=window.fileManagerState?.currentDir||phpVars?.currentDir;window.fileManagerState.selectedFiles||(window.fileManagerState.selectedFiles=[]);const r=window.fileManagerState.selectedFiles||[];switch(console.log("Keyboard shortcut detected:",e.key,"Ctrl:",e.ctrlKey,"Alt:",e.altKey),console.log("Selected files:",r),!0){case"Delete"===e.key:if(console.log("Delete key pressed, selected files:",r.length),r.length>0){if(e.preventDefault(),"INPUT"===document.activeElement.tagName||"TEXTAREA"===document.activeElement.tagName||document.activeElement.isContentEditable)return;const t=[...r];window.showConfirmation("Delete Files",`Are you sure you want to delete ${t.length} file(s)?`,"Delete",()=>{console.log("Files to delete:",t),"function"==typeof window.sendBulkActionRequest?window.sendBulkActionRequest({action:"delete",files:t,onSuccess:()=>{"function"==typeof window.clearFileSelection&&window.clearFileSelection(),window.triggerAlert("success","Files deleted successfully"),window.loadDirectory(n,1,csrf,key,isEnc)}}):window.performBulkAction("delete",t,n,csrf,key,isEnc)})}break;case e.ctrlKey&&"a"===e.key:console.log("Ctrl+A pressed"),e.preventDefault();const o=document.querySelectorAll(".file-checkbox"),a=document.getElementById("selectAll");o.forEach(e=>{e.checked=!0,window.updateSelectedFiles(e.dataset.file,!0)}),a&&(a.checked=!0),window.triggerAlert("info",`Selected ${o.length} file(s)`);break;case e.ctrlKey&&"c"===e.key:if(console.log("Ctrl+C pressed, selected files:",r.length),r.length>0){if(e.preventDefault(),"INPUT"===document.activeElement.tagName||"TEXTAREA"===document.activeElement.tagName||document.activeElement.isContentEditable)return;const t=r.map(e=>e.includes("/")?e:`${n}/${e}`);"function"==typeof window.saveToLocalStorage?(window.saveToLocalStorage(t),localStorage.removeItem("clipboard-action"),window.triggerAlert("success",`Copied ${r.length} file(s) to clipboard`)):(console.error("saveToLocalStorage function not found"),window.triggerAlert("warning","Copy operation failed"))}break;case e.ctrlKey&&"x"===e.key:if(console.log("Ctrl+X pressed, selected files:",r.length),r.length>0){if(e.preventDefault(),"INPUT"===document.activeElement.tagName||"TEXTAREA"===document.activeElement.tagName||document.activeElement.isContentEditable)return;const t=r.map(e=>e.includes("/")?e:`${n}/${e}`);"function"==typeof window.saveToLocalStorage?(window.saveToLocalStorage(t),localStorage.setItem("clipboard-action","cut"),window.triggerAlert("info",`Cut ${r.length} file(s) to clipboard`)):(console.error("saveToLocalStorage function not found"),window.triggerAlert("warning","Cut operation failed"))}break;case e.ctrlKey&&"v"===e.key:if(console.log("Ctrl+V pressed"),"INPUT"===document.activeElement.tagName||"TEXTAREA"===document.activeElement.tagName||document.activeElement.isContentEditable)return;if(e.preventDefault(),"function"==typeof window.getFromLocalStorage){const e=window.getFromLocalStorage();e&&e.length>0?(console.log("Pasting files:",e),console.log("Current directory:",n),window.triggerAlert("info",`Pasting ${e.length} item(s)...`),"function"==typeof window.sendBulkActionRequest?window.sendBulkActionRequest({action:"paste",files:e,onSuccess:()=>{"function"==typeof window.clearFileSelection&&window.clearFileSelection(),window.triggerAlert("success","Files pasted successfully"),window.loadDirectory(n,1,csrf,key,isEnc),"cut"===localStorage.getItem("clipboard-action")&&("function"==typeof window.freeclipbroad&&window.freeclipbroad(),localStorage.removeItem("clipboard-action"))}}):(window.performBulkAction("paste",e,n,csrf,key,isEnc),"cut"===localStorage.getItem("clipboard-action")&&("function"==typeof window.freeclipbroad&&window.freeclipbroad(),localStorage.removeItem("clipboard-action")))):window.triggerAlert("warning","No items in clipboard")}else console.error("getFromLocalStorage function not found"),window.triggerAlert("warning","Paste operation failed");break;case"F2"===e.key:console.log("F2 pressed, selected files:",r.length),1===r.length?(e.preventDefault(),window.renameFile(r[0],csrf,n,key,isEnc)):r.length>1&&window.triggerAlert("warning","Please select only one file to rename");break;case"F5"===e.key:console.log("F5 pressed"),e.preventDefault(),window.loadDirectory(n,1,csrf,key,isEnc),window.triggerAlert("info","Refreshing directory...");break;case e.altKey&&"ArrowUp"===e.key:console.log("Alt+Up pressed"),e.preventDefault();const i=document.querySelector(".breadcrumb-item:nth-last-child(2) a");i&&i.click();break;case"Escape"===e.key:console.log("Escape pressed");const l=document.querySelector(".modal:not(.hidden)"),s=document.querySelector("#context-menu:not(.hidden)");if(l||s)return;e.preventDefault(),document.querySelectorAll(".file-checkbox").forEach(e=>{e.checked=!1});const c=document.getElementById("selectAll");c&&(c.checked=!1),window.fileManagerState.selectedFiles=[],window.triggerAlert("info","Deselected all files");break;case"?"===e.key:console.log("? key pressed"),e.preventDefault(),t()}})}function a(){window.updateSelectedFiles="function"==typeof updateSelectedFiles?updateSelectedFiles:function(){console.error("updateSelectedFiles not found")},window.showAdvancedSearch=function(){if(!window.phpVars)return console.error("phpVars not found"),void triggerAlert("danger","Required configuration is missing. Please refresh the page and try again.");const e=addNewTab("Advanced Search","search");switchToTab(e);const t=document.getElementById(`${e}-content`);if(!t)return void console.error("Search tab content not found");t.innerHTML="";const n=document.createElement("div");n.className="search-form bg-white dark:bg-gray-800 p-4 rounded-lg shadow mb-4",n.innerHTML=`\n            <h2 class="text-xl font-semibold mb-4 text-gray-800 dark:text-white">Advanced Search</h2>\n            <form id="advanced-search-form" class="space-y-4" onsubmit="event.preventDefault(); performAdvancedSearch(); return false;">\n                \x3c!-- Search Mode Selector --\x3e\n                <div class="mb-6">\n                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Search Mode</label>\n                    <div class="flex space-x-4">\n                        <label class="inline-flex items-center">\n                            <input type="radio" name="search-mode" value="text" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300" checked onchange="toggleSearchMode('text')">\n                            <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">Text Search</span>\n                        </label>\n                        <label class="inline-flex items-center">\n                            <input type="radio" name="search-mode" value="permission" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300" onchange="toggleSearchMode('permission')">\n                            <span class="ml-2 text-sm text-gray-700 dark:text-gray-300">Permission Search</span>\n                        </label>\n                    </div>\n                </div>\n\n                \x3c!-- Common Settings --\x3e\n                <div class="mb-4">\n                    <div>\n                        <label for="search-path" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Search Path</label>\n                        <input type="text" id="search-path" name="search-path" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="Directory path" value="${window.fileManagerState?.currentDir||"."}">\n                    </div>\n                </div>\n\n                \x3c!-- Text Search Section --\x3e\n                <div id="text-search-section" class="space-y-4">\n                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">\n                        <div>\n                            <label for="search-query" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Search Query</label>\n                            <input type="text" id="search-query" name="search-query" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="Enter search text or pattern">\n                        </div>\n                    <div>\n                        <label for="file-extensions" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">File Extensions</label>\n                        <input type="text" id="file-extensions" name="file-extensions" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="e.g. php,js,html,css">\n                    </div>\n                    </div>\n\n                    <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">\n                        <h3 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">Text Search Options</h3>\n                        <div class="space-y-2">\n                        <div class="flex items-center">\n                            <input type="checkbox" id="case-sensitive" name="case-sensitive" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">\n                            <label for="case-sensitive" class="ml-2 block text-sm text-gray-700 dark:text-gray-300">Case Sensitive</label>\n                        </div>\n                        <div class="flex items-center">\n                            <input type="checkbox" id="use-regex" name="use-regex" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">\n                            <label for="use-regex" class="ml-2 block text-sm text-gray-700 dark:text-gray-300">Use Regex</label>\n                        </div>\n                        </div>\n                    </div>\n                </div>\n\n                \x3c!-- Permission Search Section --\x3e\n                <div id="permission-search-section" class="space-y-4 hidden">\n                    <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">\n                        <h3 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">Permission Filters</h3>\n                        <div class="space-y-2">\n                        <div class="flex items-center">\n                            <input type="checkbox" id="writable-only" name="writable-only" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">\n                            <label for="writable-only" class="ml-2 block text-sm text-gray-700 dark:text-gray-300">Writable Files Only</label>\n                        </div>\n                            <div class="flex items-center">\n                                <input type="checkbox" id="writable-folders" name="writable-folders" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">\n                                <label for="writable-folders" class="ml-2 block text-sm text-gray-700 dark:text-gray-300">Writable Folders Only</label>\n                            </div>\n                            <div class="flex items-center">\n                                <input type="checkbox" id="executable-only" name="executable-only" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">\n                                <label for="executable-only" class="ml-2 block text-sm text-gray-700 dark:text-gray-300">Executable Files</label>\n                            </div>\n                            <div class="flex items-center">\n                                <input type="checkbox" id="suid-binaries" name="suid-binaries" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">\n                                <label for="suid-binaries" class="ml-2 block text-sm text-gray-700 dark:text-gray-300">SUID Binaries</label>\n                            </div>\n                            <div class="flex items-center">\n                                <input type="checkbox" id="include-hidden" name="include-hidden" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">\n                                <label for="include-hidden" class="ml-2 block text-sm text-gray-700 dark:text-gray-300">Include Hidden Files/Folders</label>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                \x3c!-- Common Options --\x3e\n                <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">\n                    <h3 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">Search Settings</h3>\n                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">\n                        <div>\n                            <label for="max-results" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Max Results</label>\n                            <input type="number" id="max-results" name="max-results" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" value="1000" min="10" max="10000">\n                        </div>\n                        <div>\n                            <label for="batch-size" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Batch Size</label>\n                            <input type="number" id="batch-size" name="batch-size" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white" value="200" min="50" max="1000" title="Number of files to process per batch">\n                        </div>\n                        <div class="flex items-center pt-6">\n                            <input type="checkbox" id="recursive-search" name="recursive-search" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded" checked>\n                            <label for="recursive-search" class="ml-2 block text-sm text-gray-700 dark:text-gray-300">Recursive Search</label>\n                        </div>\n                    </div>\n                </div>\n                <div class="flex justify-end">\n                    <button type="submit" class="inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">\n                        <svg class="mr-2 -ml-1 h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">\n                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />\n                        </svg>\n                        Search\n                    </button>\n                </div>\n            </form>\n        `;const r=document.createElement("div");r.id="search-results-container",r.className="search-results bg-white dark:bg-gray-800 p-4 rounded-lg shadow",r.innerHTML='\n            <div class="flex justify-between items-center mb-4">\n                <h2 class="text-xl font-semibold text-gray-800 dark:text-white">Search Results</h2>\n                <div id="search-stats" class="text-sm text-gray-500 dark:text-gray-400"></div>\n            </div>\n            <div id="search-results" class="space-y-4">\n                <div class="text-gray-500 dark:text-gray-400 text-center py-8">Enter a search query and click Search</div>\n            </div>\n        ',t.appendChild(n),t.appendChild(r);const o=document.getElementById("advanced-search-form");o&&o.addEventListener("submit",function(e){return e.preventDefault(),performAdvancedSearch(),!1})},window.toggleSearchMode=function(e){const t=document.getElementById("text-search-section"),n=document.getElementById("permission-search-section"),r=document.getElementById("search-query");"text"===e?(t.classList.remove("hidden"),n.classList.add("hidden"),r.setAttribute("required","")):(t.classList.add("hidden"),n.classList.remove("hidden"),r.removeAttribute("required"))},window.performAdvancedSearch=function(e=null){const t=document.querySelector('input[name="search-mode"]:checked').value,n=document.getElementById("search-path")?.value||".",r=document.getElementById("file-extensions")?.value||"",o=document.getElementById("max-results")?.value||1e3,a=document.getElementById("recursive-search")?.checked||!0,i=parseInt(document.getElementById("batch-size")?.value||"200",10),l=document.getElementById("search-query")?.value||"",s=document.getElementById("case-sensitive")?.checked||!1,c=document.getElementById("use-regex")?.checked||!1,d=document.getElementById("writable-only")?.checked||!1,u=document.getElementById("writable-folders")?.checked||!1,g=document.getElementById("executable-only")?.checked||!1,m=document.getElementById("suid-binaries")?.checked||!1,f=document.getElementById("include-hidden")?.checked||!1;if("text"===t&&!l&&!e)return void triggerAlert("warning","Please enter a search query for text search");if(!("permission"!==t||d||u||g||m))return void triggerAlert("warning","Please select at least one permission filter");if(!e){const e=(p=n)&&""!==p.trim()?(p.startsWith("/")&&console.warn("Using absolute path for search: "+p),{valid:!0}):{valid:!1,message:"Search path cannot be empty"};if(!e.valid)return void triggerAlert("warning",e.message)}var p;if(!csrf)return console.error("CSRF token not found in phpVars"),void triggerAlert("danger","Security token missing. Please refresh the page and try again.");const h=document.getElementById("search-results");if(h&&!e?(h.innerHTML='\n                <div class="flex justify-center items-center py-8">\n                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"></div>\n                    <span class="ml-2 text-gray-600 dark:text-gray-300">Searching...</span>\n                </div>\n            ',window.currentSearch={query:l,path:n,extensions:r,maxResults:o,caseSensitive:s,useRegex:c,recursive:a,writableOnly:d,writableFolders:u,executableOnly:g,suidBinaries:m,includeHidden:f,results:{},totalMatches:0}):e||(window.currentSearch={query:l,path:n,extensions:r,maxResults:o,caseSensitive:s,useRegex:c,recursive:a,writableOnly:d,writableFolders:u,executableOnly:g,suidBinaries:m,includeHidden:f,results:{},totalMatches:0}),e){const e=document.getElementById("search-progress");e&&(e.innerHTML='\n                    <div class="flex items-center">\n                        <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-blue-500 mr-2"></div>\n                        <span>Continuing search...</span>\n                    </div>\n                ')}console.log("Sending advanced search request:",{searchQuery:l,searchPath:n,fileExtensions:r,maxResults:o,caseSensitive:s,useRegex:c,recursive:a,writableOnly:d,writableFolders:u,executableOnly:g,suidBinaries:m,includeHidden:f,searchToken:e,batchSize:i});let y=key;"1"===isEnc&&"string"==typeof key&&(y=CryptoJS.enc.Utf8.parse(key),console.log("Using formatted encryption key for advanced search")),sendRequest({csrf:csrf,action:"advanced_search",search_mode:t,search_query:"text"===t?l:"",search_path:n,file_extensions:r,max_results:o,case_sensitive:s,use_regex:c,recursive:a,writable_only:d,writable_folders:u,executable_only:g,suid_binaries:m,include_hidden:f,search_token:e,batch_size:i},y,isEnc).then(t=>{console.log("Search response received:",t),displaySearchResults(t,null!==e)}).catch(e=>{console.error("Search error:",e),h&&(h.innerHTML=`\n                    <div class="text-red-500 dark:text-red-400 text-center py-4">\n                        Error: ${e.message||"Failed to perform search"}\n                    </div>\n                    <div class="mt-4 p-4 bg-red-50 dark:bg-red-900 border border-red-200 dark:border-red-800 rounded-md">\n                        <h3 class="font-medium text-red-800 dark:text-red-300 mb-2">Troubleshooting tips:</h3>\n                        <ul class="list-disc pl-5 text-sm text-red-700 dark:text-red-400 space-y-1">\n                            <li>Check if the search path exists and is accessible</li>\n                            <li>Try using a relative path like "./subdirectory" instead of an absolute path</li>\n                            <li>If using regex, verify your pattern is valid</li>\n                            <li>Try reducing the batch size if searching many files</li>\n                            <li>Check browser console for more detailed error information</li>\n                        </ul>\n                    </div>\n                `),triggerAlert("danger","Search failed: "+(e.message||"Unknown error"))})},window.displaySearchResults=function(e,t=!1){const n=document.getElementById("search-results"),r=document.getElementById("search-stats");if(!n)return void console.error("Results container not found");if(e.error)return void(n.innerHTML=`\n                <div class="text-red-500 dark:text-red-400 text-center py-4">\n                    Error: ${e.error}\n                </div>\n            `);if(t&&window.currentSearch?(Object.assign(window.currentSearch.results,e.results),window.currentSearch.totalMatches=e.total_matches):(window.currentSearch||(window.currentSearch={}),window.currentSearch.results=e.results,window.currentSearch.totalMatches=e.total_matches),r&&(r.textContent=`Found ${window.currentSearch.totalMatches} matches in ${Object.keys(window.currentSearch.results).length} files`,e.memory_limit_reached&&(r.innerHTML+='\n                    <div class="mt-2 text-amber-600 dark:text-amber-400">\n                        <svg class="inline-block w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>\n                        </svg>\n                        Search was truncated due to memory limits. Try narrowing your search or searching in smaller directories.\n                    </div>\n                '),!e.search_complete)){const t=e.files_remaining||0,n=e.files_processed||0,o=n+t,a=o>0?Math.round(n/o*100):0;r.innerHTML+=`\n                    <div id="search-progress" class="mt-2">\n                        <div class="flex items-center justify-between mb-1">\n                            <span class="text-sm text-gray-700 dark:text-gray-300">\n                                Processed ${n} of ${o} files (${a}%)\n                            </span>\n                        </div>\n                        <div class="w-full bg-gray-200 rounded-full h-2.5 dark:bg-gray-700">\n                            <div class="bg-blue-600 h-2.5 rounded-full" style="width: ${a}%"></div>\n                        </div>\n                        <div class="flex justify-between mt-2">\n                            <div class="flex items-center">\n                                <input type="checkbox" id="auto-continue-search" class="mr-2">\n                                <label for="auto-continue-search" class="text-sm text-gray-700 dark:text-gray-300">Auto-continue</label>\n                            </div>\n                            <button id="continue-search" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 dark:bg-blue-600 dark:hover:bg-blue-700">\n                                Continue Search\n                            </button>\n                        </div>\n                    </div>\n                `}if(0===window.currentSearch.totalMatches&&e.search_complete)return void(n.innerHTML=`\n                <div class="text-gray-500 dark:text-gray-400 text-center py-8">\n                    No results found for "${e.search_query}"\n                </div>\n            `);let o="";if(Object.keys(window.currentSearch.results).sort((e,t)=>window.currentSearch.results[t].length-window.currentSearch.results[e].length).forEach(t=>{const n=window.currentSearch.results[t],r=t.split("/").pop(),a=e.writable_files&&e.writable_files.includes(t)?'<span class="ml-2 px-2 py-0.5 text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300 rounded">Writable</span>':'<span class="ml-2 px-2 py-0.5 text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300 rounded">No Writable</span>';o+=`\n                <div class="file-result border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden mb-4">\n                    <div class="file-header bg-gray-100 dark:bg-gray-700 px-4 py-2 flex justify-between items-center">\n                        <div class="flex items-center">\n                            <span class="font-medium text-gray-800 dark:text-white">${r}</span>\n                            <span class="ml-2 text-sm text-gray-500 dark:text-gray-400">${n.length} matches</span>\n                            ${a}\n                        </div>\n                        <div class="flex space-x-2">\n                            <button class="text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 text-sm" \n                                    onclick="viewEditFile('${t}', '${window.phpVars?.csrf||""}', '${window.phpVars?.encryptionKey||""}', ${window.phpVars?.isEnc||!1})">\n                                Edit\n                            </button>\n                            <button class="text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-300 text-sm toggle-matches" \n                                    data-file="${t}">\n                                Hide Matches\n                            </button>\n                        </div>\n                    </div>\n                    <div class="file-matches bg-white dark:bg-gray-800 p-2">\n                        <div class="text-xs text-gray-500 dark:text-gray-400 mb-2">${t}</div>\n                        <div class="matches-list space-y-1">\n            `,n.forEach(e=>{const n=e.line_content.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");let r=n;if(!document.getElementById("use-regex")?.checked){const e=document.getElementById("search-query")?.value||"";if(e){const t=document.getElementById("case-sensitive")?.checked?"g":"gi",o=new RegExp(e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),t);r=n.replace(o,'<mark class="bg-yellow-200 dark:bg-yellow-700">$&</mark>')}}o+=`\n                    <div class="match-line hover:bg-gray-50 dark:hover:bg-gray-700 p-1 rounded">\n                        <a href="#" class="flex" onclick="viewEditFileAtLine('${t}', ${e.line_number}, '${window.phpVars?.csrf||""}', '${window.phpVars?.encryptionKey||""}', ${window.phpVars?.isEnc||!1}); return false;">\n                            <span class="line-number w-12 inline-block text-right pr-2 text-gray-500 dark:text-gray-400 select-none">${e.line_number}</span>\n                            <span class="line-content font-mono text-gray-800 dark:text-gray-200 overflow-x-auto">${r}</span>\n                        </a>\n                    </div>\n                `}),o+="\n                        </div>\n                    </div>\n                </div>\n            "}),n.innerHTML=o,document.querySelectorAll(".toggle-matches").forEach(e=>{e.addEventListener("click",function(){this.getAttribute("data-file");const e=this.closest(".file-result").querySelector(".matches-list");"none"===e.style.display?(e.style.display="block",this.textContent="Hide Matches"):(e.style.display="none",this.textContent="Show Matches")})}),!e.search_complete){const t=document.getElementById("continue-search"),n=document.getElementById("auto-continue-search");if(t&&t.addEventListener("click",function(){performAdvancedSearch(e.search_token)}),n){"true"===localStorage.getItem("search-auto-continue")&&(n.checked=!0),n.addEventListener("change",function(){localStorage.setItem("search-auto-continue",this.checked)}),n.checked&&setTimeout(()=>{performAdvancedSearch(e.search_token)},1e3)}}},window.viewEditFileAtLine=function(e,t,n,r,o){console.log(`Attempting to open ${e} at line ${t}`),viewEditFile(e,n,r,o);let a=0;const i=function(){if(console.log(`Checking for editor (attempt ${a+1}/20)`),window.editor){console.log(`Editor found, navigating to line ${t}`);try{window.editor.setCursor(t-1,0),window.editor.addLineClass(t-1,"background","bg-yellow-100"),window.editor.scrollIntoView({line:t-1,ch:0},100),console.log("Successfully positioned editor at line",t)}catch(e){console.error("Error positioning editor:",e),triggerAlert("warning","Could not position to the selected line. Please try manually navigating to line "+t)}}else a++,a<20?(console.log(`Editor not ready yet, attempt ${a}/20`),setTimeout(i,300)):(console.error("Editor failed to initialize after multiple attempts"),triggerAlert("warning","Could not position to the selected line. Please try manually navigating to line "+t))};setTimeout(i,800)},window.saveToLocalStorage=l,window.getFromLocalStorage=s,window.freeclipbroad="function"==typeof freeclipbroad?freeclipbroad:function(){console.error("freeclipbroad not found")},window.performBulkAction="function"==typeof performBulkAction?performBulkAction:function(){console.error("performBulkAction not found")},window.sendBulkActionRequest=function({action:e,files:t,options:n=null,onSuccess:r=null,onError:o=null}){const a=window.fileManagerState?.currentDir||phpVars?.currentDir;"function"==typeof progr&&progr(),console.log(`Sending ${e} request for ${t.length} file(s)`);const i={csrf:csrf,action:e,file:t,dir:a};"zip"===e&&n&&(i.zipExt=n.zipFileName,i.compressionLevel=n.compressionLevel||"5",i.archiveFormat=n.archiveFormat||"zip");const l=JSON.stringify(i),s="1"===isEnc?encrypt(l,key):l;$.post("",s,function(e){try{const t="1"===isEnc?decrypt(e,key):e,n=JSON.parse(t);console.log("Response:",n),n.error?(triggerAlert("warning",n.error),o&&o(n.error)):n.success?r?r(n):triggerAlert("success",n.success):r?r(n):triggerAlert("success","Operation completed successfully")}catch(e){console.error("Error processing response:",e),triggerAlert("error","Failed to process server response"),o&&o(e)}"function"==typeof dprogr&&dprogr()}).fail(function(e,t,n){console.error("Request failed:",t,n),triggerAlert("error","Request failed: "+(n||"Unknown error")),o&&o(n),"function"==typeof dprogr&&dprogr()})},window.renameFile="function"==typeof renameFile?renameFile:function(){console.error("renameFile not found")},window.loadDirectory="function"==typeof loadDirectory?loadDirectory:function(){console.error("loadDirectory not found")},window.triggerAlert="function"==typeof triggerAlert?triggerAlert:function(){console.error("triggerAlert not found")},window.showConfirmation="function"==typeof showConfirmation?showConfirmation:function(){console.error("showConfirmation not found")},window.encrypt="function"==typeof encrypt?encrypt:function(){console.error("encrypt not found")},window.decrypt="function"==typeof decrypt?decrypt:function(){console.error("decrypt not found")},window.progr="function"==typeof progr?progr:function(){console.error("progr not found")},window.dprogr="function"==typeof dprogr?dprogr:function(){console.error("dprogr not found")}}function i(e){const t=document.querySelector(`[data-tabs-target="${e}"]`),n=document.querySelector(e);if(!t||!n)return void console.error("Tab elements not found:",e);document.querySelectorAll('[role="tab"]').forEach(e=>{e.setAttribute("aria-selected","false"),e.classList.remove("text-blue-600","border-blue-600"),e.classList.add("border-transparent")}),document.querySelectorAll('[role="tabpanel"]').forEach(e=>{e.classList.add("hidden")}),t.setAttribute("aria-selected","true"),t.classList.add("text-blue-600","border-blue-600"),t.classList.remove("border-transparent"),n.classList.remove("hidden"),n.classList.add("animate-fadeIn");const r=document.querySelector(".mb-4.border-b.border-gray-200.dark\\:border-gray-700"),o=document.getElementById("breadcrumbs");if(r&&o)if("#terminal"===e||"#config"===e||"#setting"===e||"#sql"===e||"#network"===e){console.log("Hiding navigation elements for tab:",e),r.classList.add("hidden"),o.classList.add("hidden");const t=document.getElementById("fileManagerUI");t&&(t.style.display="none"),document.querySelectorAll(".tabs-panel").forEach(e=>{e.classList.add("hidden")})}else if(r.classList.remove("hidden"),o.classList.remove("hidden"),"#file"===e){const e=document.getElementById("fileManagerUI");e&&(e.style.display="block")}"function"==typeof window.updateKeydownListener&&setTimeout(window.updateKeydownListener,100)}function l(e){try{const t=e.map(e=>{if(e.startsWith("/")||e.includes(":/"))return e;const t=window.fileManagerState?.currentDir||phpVars?.currentDir;return t.endsWith("/")?t+e:t+"/"+e});return localStorage.setItem("copiedFiles",JSON.stringify(t)),console.log("Saved to clipboard:",t),t}catch(e){return console.error("Error saving to localStorage:",e),[]}}function s(){try{const e=localStorage.getItem("copiedFiles");if(!e)return console.log("No files found in clipboard"),[];const t=JSON.parse(e);return console.log("Retrieved from clipboard:",t),t}catch(e){return console.error("Error retrieving from localStorage:",e),[]}}function c(e,t){return new Promise((n,r)=>{progr();const o={action:"network_tool",tool:e,params:t,csrf:phpVars.csrf},a=JSON.stringify(o),i=isEnc?encrypt(a,key):a;fetch("",{method:"POST",body:i}).then(e=>e.text()).then(e=>{try{let t;if(dprogr(),isEnc)try{console.log("Attempting to decrypt response");const n=decrypt(e,key);console.log("Decrypted data:",n.substring(0,100)+"..."),t=JSON.parse(n)}catch(n){console.error("Decryption error:",n),console.log("Attempting direct JSON parse as fallback"),t=JSON.parse(e)}else t=JSON.parse(e);n(t)}catch(t){console.error("Error processing response:",t),console.error("Raw response:",e),dprogr(),r(t)}}).catch(e=>{console.error("Network error:",e),dprogr(),r(e)})})}function d(){try{const e=localStorage.getItem("fileManagerTabs");if(e)return JSON.parse(e)}catch(e){console.error("Error loading tabs from localStorage:",e)}return{tabs:null,activeTabId:null}}function u(){try{const e={tabs:window.fileManagerState.tabs,activeTabId:window.fileManagerState.activeTabId};localStorage.setItem("fileManagerTabs",JSON.stringify(e))}catch(e){console.error("Error saving tabs to localStorage:",e)}}document.addEventListener("DOMContentLoaded",function(){const t=phpVars.csrf;let r=phpVars.currentDir;const i=phpVars.isEnc,l=CryptoJS.enc.Utf8.parse(phpVars.encryptionKey),s=phpVars.currentDir;let c;document.getElementById("sql-tab")?.addEventListener("click",function(){"function"==typeof window.initSQLExplorer&&window.initSQLExplorer()}),"function"==typeof window.initContextMenu&&window.initContextMenu();const g=d();if(window.fileManagerState=window.fileManagerState||{tabs:g.tabs||[{id:"tab-1",path:phpVars.currentDir,active:!0,name:"Root",type:"filemanager"}],activeTabId:g.activeTabId||"tab-1",selectedFiles:[],currentDir:phpVars.currentDir,currentSort:{column:"name",direction:"asc"}},window.loadTabsFromLocalStorage&&window.loadTabsFromLocalStorage()){console.log("Tabs loaded from localStorage");const Y=fileManagerState.tabs.find(e=>e.active);Y&&Y.path&&(r=Y.path,window.fileManagerState.currentDir=r)}a(),o(),window.clearFileSelection=function(){window.fileManagerState&&(window.fileManagerState.selectedFiles=[]),document.querySelectorAll(".file-checkbox:checked").forEach(e=>{e.checked=!1});let e=document.getElementById("selectAll");e&&(e.checked=!1,e.indeterminate=!1),document.querySelectorAll("#fileList tr.bg-blue-50, #fileList tr.dark\\:bg-blue-900\\/20").forEach(e=>{e.classList.remove("bg-blue-50","dark:bg-blue-900/20")})};var m=phpVars.terPWD,f="",p=[],h=0,y=!1,b=0,w=0,v="",x=[],k="";let S=phpVars.cmList;window.editorThemePreference=localStorage.getItem("editor-theme"),"system"===window.editorThemePreference&&(window.editorThemePreference=window.matchMedia("(prefers-color-scheme: dark)").matches?"vs-dark":"vs");function E(e,t,n,r="",o){const a=document.documentElement.classList.contains("dark");Swal.fire({title:e,html:`\n                <div class="flex flex-col w-full">\n                    <label for="dialog-input" class="text-left mb-2 text-gray-700 dark:text-gray-300 text-sm font-medium">${t}</label>\n                    <input id="dialog-input" type="text" value="${r}" class="w-full p-3 text-gray-800 dark:text-gray-200 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50">\n                </div>\n            `,showCancelButton:!0,confirmButtonText:n,cancelButtonText:"Cancel",customClass:{popup:"dark:bg-gray-800 dark:text-gray-200",title:"text-gray-800 dark:text-gray-200",confirmButton:"bg-blue-600 hover:bg-blue-700 text-white",cancelButton:"bg-gray-500 hover:bg-gray-600 text-white"},background:a?"#1F2937":"#FFFFFF",focusConfirm:!1,preConfirm:()=>{const e=document.getElementById("dialog-input").value;return e&&""!==e.trim()?e:(Swal.showValidationMessage("You need to enter a value!"),!1)}}).then(e=>{e.isConfirmed&&e.value&&o(e.value)})}function I(e,t,n,r){const o=document.documentElement.classList.contains("dark");Swal.fire({title:e,text:t,icon:"warning",iconColor:o?"#FBBF24":"#F59E0B",showCancelButton:!0,confirmButtonText:n,cancelButtonText:"Cancel",customClass:{popup:"dark:bg-gray-800 dark:text-gray-200",title:"text-gray-800 dark:text-gray-200",confirmButton:"bg-blue-600 hover:bg-blue-700 text-white",cancelButton:"bg-gray-500 hover:bg-gray-600 text-white"},background:o?"#1F2937":"#FFFFFF"}).then(e=>{e.isConfirmed&&r()})}const L=localStorage.getItem("default-items-per-page");if(L){const G=document.getElementById("itemLimit");G&&(G.value=L)}if(d()){const ee=fileManagerState.tabs.find(e=>e.active);ee&&(r=ee.path)}initializeFileManager(t,r,i,l),T(),$(document).on("click","#location-tabs button",function(e){if(e.target.classList.contains("fa-times"))return;const n=$(this).data("tab-id");if(!fileManagerState.tabs.find(e=>e.id===n))return;document.querySelectorAll('[role="tabpanel"]').forEach(e=>{e.classList.add("hidden")}),document.querySelectorAll("[data-tabs-target]").forEach(e=>{const t=e.getAttribute("data-tabs-target");t&&document.querySelector(t)&&document.querySelector(t).classList.add("hidden")}),function(e){const n=fileManagerState.tabs.find(t=>t.id===e);if(!n)return;fileManagerState.tabs.forEach(e=>e.active=!1),n.active=!0,fileManagerState.activeTabId=e,T(),u(),document.querySelectorAll('[role="tabpanel"]').forEach(e=>{e.classList.add("hidden")});let o=document.getElementById(`${e}-content`);if(!o){console.log("Creating tab content element for tab:",e);const t=document.getElementById("tabs-content");if(!t)return void console.error("Tabs content container not found!");o=document.createElement("div"),o.id=`${e}-content`,o.className="tabs-panel w-full",t.appendChild(o)}if(document.querySelectorAll(".tabs-panel").forEach(e=>{e.classList.add("hidden")}),o.classList.remove("hidden"),"editor"===n.type||"search"===n.type){console.log("Handling editor/search tab");const e=document.getElementById("fileManagerUI");e?(console.log("Hiding fileManagerUI"),e.style.display="none"):console.warn("fileManagerUI element not found");const t=o.querySelector(".editor-container");t&&(t.style.height="90vh",t.style.width="100%",window.editor&&setTimeout(()=>window.editor.refresh(),10))}else{const e=document.getElementById("fileManagerUI"),o=document.getElementById("file");e?(console.log("Showing fileManagerUI"),e.style.display="block",o&&o.classList.remove("hidden"),r=n.path,updateCurrentPath(),loadDirectory(r,1,t,l,i)):console.warn("fileManagerUI element not found")}}(n);const o=document.createElement("span");o.className="absolute inset-0 bg-blue-500 opacity-30 rounded-t-lg animate-ripple",this.appendChild(o),setTimeout(()=>o.remove(),600)}),$(document).on("click","[data-close-tab]",function(e){e.stopPropagation();const n=$(this).data("close-tab");$(this).closest("li").addClass("animate-tab-closing"),setTimeout(()=>{!function(e){if(fileManagerState.tabs.length<=1)return;const n=fileManagerState.tabs.findIndex(t=>t.id===e);if(-1===n)return;const o=fileManagerState.tabs[n].active;if(fileManagerState.tabs.splice(n,1),o){const e=Math.max(0,n-1);fileManagerState.tabs[e].active=!0,fileManagerState.activeTabId=fileManagerState.tabs[e].id,r=fileManagerState.tabs[e].path,updateCurrentPath(),loadDirectory(r,1,t,l,i)}T(),u()}(n)},150)}),$("#add-tab-btn").click(function(){P(),$(this).addClass("animate-pulse"),setTimeout(()=>{$(this).removeClass("animate-pulse")},500)}),window.addEventListener("resize",function(e,t){let n;return function(...r){const o=()=>{clearTimeout(n),e(...r)};clearTimeout(n),n=setTimeout(o,t)}}(F,100)),e(),n();const M=document.getElementById("selectAll");function B(e){console.log("Select All checkbox changed:",e.target.checked);const t=e.target.checked,n=document.querySelectorAll(".file-checkbox");console.log("Found file checkboxes:",n.length),window.fileManagerState||(window.fileManagerState={selectedFiles:[],currentSort:{column:"name",direction:"asc"}}),window.fileManagerState.selectedFiles=[],n.forEach(e=>{if(e.checked=t,t){const t=e.dataset.fullPath||e.dataset.file;updateSelectedFiles(t,!0,!0);e.closest("tr").classList.add("bg-blue-50","dark:bg-blue-900/20")}else{e.closest("tr").classList.remove("bg-blue-50","dark:bg-blue-900/20")}}),console.log("Updated selected files:",window.fileManagerState.selectedFiles),console.log("Selected file count:",window.fileManagerState.selectedFiles.length)}M&&(M.removeEventListener("change",B),M.addEventListener("change",B));const A=document.getElementById("fileList");function C(e){const t=$("#breadcrumbs ol"),n=e.split("/").filter(e=>""!==e);let r="";r+='\n            <li class="inline-flex items-center">\n                <a href="#" class="breadcrumb-link" data-path="/">\n                    /\n                </a>\n            </li>\n        ',n.forEach((e,t)=>{const o="/"+n.slice(0,t+1).join("/");r+=`\n                <li class="inline-flex items-center">\n                    <i class="fas fa-chevron-right mx-2 text-gray-500"></i>\n                    <a href="#" class="breadcrumb-link" data-path="${o}">${e}</a>\n                </li>\n            `}),t.html(r)}function T(){const e=document.getElementById("location-tabs");if(!e)return;e.innerHTML="",fileManagerState.tabs.forEach(t=>{const n=document.createElement("li");n.className="mr-1 flex-shrink-0",n.setAttribute("role","presentation");const r=t.name||D(t.path);let o="fa-folder";"Root"!==r&&"Home"!==r||(o="fa-home");n.innerHTML=`\n                <button class="${t.active?"inline-flex items-center p-3 border-b-2 rounded-t-lg text-blue-600 border-blue-600 active dark:text-blue-500 dark:border-blue-500 bg-white dark:bg-gray-800 shadow-sm":"inline-flex items-center p-3 border-b-2 border-transparent rounded-t-lg hover:text-gray-600 hover:border-gray-300 dark:hover:text-gray-300 dark:hover:border-gray-300 bg-gray-50 dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600"} transition-all duration-200 group" \n                        data-tab-id="${t.id}" \n                        type="button" \n                        role="tab">\n                    <i class="fas ${o} mr-2 ${t.active?"text-blue-500":"group-hover:text-blue-400"} transition-colors"></i>\n                    <span class="truncate max-w-[100px] md:max-w-[150px]">${r}</span>\n                    ${"tab-1"!==t.id?`\n                        <i class="fas fa-times ml-2 p-1 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-full text-xs opacity-0 group-hover:opacity-100 hover:text-red-500 transition-all" data-close-tab="${t.id}"></i>\n                    `:""}\n                </button>\n            `,e.appendChild(n)});const t=e.querySelector('button[data-tab-id="'+fileManagerState.activeTabId+'"]');t&&(t.classList.add("animate-pulse"),setTimeout(()=>{t.classList.remove("animate-pulse")},500),requestAnimationFrame(()=>{const n=t.getBoundingClientRect(),r=e.getBoundingClientRect();n.left<r.left?e.scrollLeft+=n.left-r.left-16:n.right>r.right&&(e.scrollLeft+=n.right-r.right+16)})),F()}function F(){const e=document.getElementById("location-tabs");if(!e)return;if(e.scrollWidth>e.clientWidth){if(e.classList.add("tabs-overflow"),!document.getElementById("tab-scroll-left")){const t=document.createElement("button");t.id="tab-scroll-left",t.className="absolute left-0 top-0 bottom-0 px-1 bg-gradient-to-r from-white to-transparent dark:from-gray-800 dark:to-transparent z-10 opacity-80 hover:opacity-100 transition-opacity",t.innerHTML='<i class="fas fa-chevron-left"></i>',t.addEventListener("click",()=>{e.scrollBy({left:-150,behavior:"smooth"})});const n=document.createElement("button");n.id="tab-scroll-right",n.className="absolute right-0 top-0 bottom-0 px-1 bg-gradient-to-l from-white to-transparent dark:from-gray-800 dark:to-transparent z-10 opacity-80 hover:opacity-100 transition-opacity",n.innerHTML='<i class="fas fa-chevron-right"></i>',n.addEventListener("click",()=>{e.scrollBy({left:150,behavior:"smooth"})}),e.parentElement.appendChild(t),e.parentElement.appendChild(n)}}else e.classList.remove("tabs-overflow"),document.getElementById("tab-scroll-left")?.remove(),document.getElementById("tab-scroll-right")?.remove()}function P(e,t="filemanager"){return window.addNewTab(e,t)}function D(e){const t=e.endsWith("/")?e.slice(0,-1):e;if(""===t||"/"===t)return"Root";const n=t.split("/");return n[n.length-1]||"Root"}function z({action:e,files:n,options:o=null,onSuccess:a=null,onError:s=null}){progr(),console.log(`Sending ${e} request for ${n.length} file(s)`);const c={csrf:t,action:e,file:n,dir:r};"zip"===e&&o&&(c.zipExt=o.zipFileName,c.compressionLevel=o.compressionLevel||"5",c.archiveFormat=o.archiveFormat||"zip");const d=JSON.stringify(c),u="1"===i?encrypt(d,l):d;$.post("",u,function(e){try{const t="1"===i?decrypt(e,l):e,n=JSON.parse(t);console.log("Response:",n),n.error?(triggerAlert("warning",n.error),s&&s(n.error)):n.success?a?a(n):triggerAlert("success",n.success):a?a(n):triggerAlert("success","Operation completed successfully")}catch(e){console.error("Error processing response:",e),triggerAlert("error","Failed to process server response"),s&&s(e)}dprogr()}).fail(function(e,t,n){console.error("Request failed:",t,n),triggerAlert("error","Request failed: "+(n||"Unknown error")),s&&s(n),dprogr()})}A&&A.addEventListener("change",function(e){if(e.target.classList.contains("file-checkbox")){const t=e.target.checked;updateSelectedFiles(e.target.dataset.file,t);const n=document.querySelectorAll(".file-checkbox"),r=Array.from(n).every(e=>e.checked),o=Array.from(n).some(e=>e.checked);M&&(M.checked=r,M.indeterminate=!r&&o)}}),document.addEventListener("click",function(e){if(e.target.classList.contains("fa-trash-alt")){const n=e.target.dataset.file;deleteFile(n,t,r,l,i)}}),$(".fa-folder-plus").click(function(){E("Create Folder","Enter the name of new folder: ","mkdir","NewFolder",e=>{e&&(data={csrf:t,action:"mkdir",dir:r,dirName:e},handleCreate(data,"folder",l,i,r,t))})}),$(".fa-file-circle-plus").click(function(){E("Create File","Enter the name of new File: ","touch","File",e=>{e&&(data={csrf:t,action:"touch",dir:r,dirName:e},handleCreate(data,"file",l,i,r,t))})}),$(".codeme").click(function(){E("Execute PHP Code","Enter the PHP code to execute:","Execute","",e=>{e&&""!==e.trim()&&sendRequest({csrf:t,action:"execute",code:e.trim(),dir:r},l,i).then(e=>{e.output&&(triggerAlert("success","Code executed successfully"),Swal.fire({title:"Execution Result",html:`<pre class="text-left">${e.output}</pre>`,width:"80%",customClass:{popup:"dark:bg-gray-800 dark:text-white",htmlContainer:"overflow-auto max-h-[70vh]"}}))}).catch(e=>{triggerAlert("warning","Error executing code: "+e)})})}),$("#searchBar").on("keyup",function(){const e=$(this).val().toLowerCase();console.log("Search query:",e),e.length>0?$("#clearSearch").show():$("#clearSearch").hide(),window.fileManagerState?window.fileManagerState.currentSort||(window.fileManagerState.currentSort={column:"name",direction:"asc"}):window.fileManagerState={selectedFiles:[],currentSort:{column:"name",direction:"asc"},files:[]},"function"==typeof window.renderFiles?window.renderFiles(window.fileManagerState.files,r,t,l,i):console.error("renderFiles function not found")}),$("#clearSearch").on("click",function(){$("#searchBar").val("").focus(),$(this).hide(),"function"==typeof window.renderFiles&&window.fileManagerState&&window.renderFiles(window.fileManagerState.files,r,t,l,i)}),document.addEventListener("click",function(e){if(e.target.classList.contains("fa-download")){const n=e.target.dataset.file;downloadFile(n,t,l,i)}}),$(window).on("scroll",function(){if($(window).scrollTop()+$(window).height()>=$(document).height()-100){let e=document.getElementById("itemLimit").value;fileManagerState.currentPage<fileManagerState.totalPages&&!fileManagerState.isLoading&&(fileManagerState.currentPage++,loadDirectory(r,fileManagerState.currentPage,t,l,i,e))}}),$("th[data-sort]").click(function(){const e=$(this).data("sort");console.log("Sorting by column:",e),window.fileManagerState?window.fileManagerState.currentSort||(window.fileManagerState.currentSort={column:"name",direction:"asc"}):window.fileManagerState={selectedFiles:[],currentSort:{column:"name",direction:"asc"}},window.fileManagerState.currentSort.column===e?window.fileManagerState.currentSort.direction="asc"===window.fileManagerState.currentSort.direction?"desc":"asc":(window.fileManagerState.currentSort.column=e,window.fileManagerState.currentSort.direction="asc"),console.log("Sort state:",window.fileManagerState.currentSort),"function"==typeof window.sortFiles?window.sortFiles():console.error("sortFiles function not found"),"function"==typeof window.renderFiles?window.renderFiles(window.fileManagerState.files,r,t,l,i):console.error("renderFiles function not found"),$("th[data-sort]").find("i.fas").removeClass("fa-sort-up fa-sort-down").addClass("fa-sort");const n=$(this).find("i.fas");n.removeClass("fa-sort"),"asc"===window.fileManagerState.currentSort.direction?n.addClass("fa-sort-up"):n.addClass("fa-sort-down")}),$(document).on("click",".directory-link",function(e){e.preventDefault();let n=document.getElementById("itemLimit").value;const o=$(this).data("path");o&&o!==r&&(r=o,c=r,console.log(c),updateCurrentPath(),loadDirectory(r,1,t,l,i,n),updateActiveTabPath(r))}),window.updateCurrentPath=function(){C(r)},$("#breadcrumbs").on("dblclick",function(e){console.log("Double-click detected"),e.preventDefault();const n=$("#breadcrumbs ol"),o=r,a=$("<input>",{type:"text",value:o,class:"w-96 px-2 py-1 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"});console.log("originalPath"+o),n.html(`<li class="inline-flex items-center">${a.prop("outerHTML")}</li>`),n.find("input").focus(),n.find("input").on("blur",function(){$(this).val().trim();C(o)}),n.find("input").on("keydown",function(e){if(13===e.keyCode){e.preventDefault();const n=$(this).val().trim();n&&(r=n,updateCurrentPath(),loadDirectory(r,1,t,l,i),updateActiveTabPath(r))}})}),$(document).on("click",".breadcrumb-link",function(e){e.preventDefault();const n=$(this).data("path");n&&(r=n,updateCurrentPath(),c=r,console.log(c),loadDirectory(r,1,t,l,i),updateActiveTabPath(r))}),$(document).on("click","#goHome",function(e){e.preventDefault(),r=s,updateCurrentPath(),c=r,loadDirectory(r,1,t,l,i),updateActiveTabPath(r),$(this).addClass("animate-pulse"),setTimeout(()=>{$(this).removeClass("animate-pulse")},300)}),window.switchToTab=function(e){const n=fileManagerState.tabs.find(t=>t.id===e);if(!n)return;fileManagerState.tabs.forEach(e=>e.active=!1),n.active=!0,fileManagerState.activeTabId=e,T(),document.querySelectorAll('[role="tabpanel"]').forEach(e=>{e.classList.add("hidden")});let o=document.getElementById(`${e}-content`);if(!o){console.log("Creating tab content element for tab:",e);const t=document.getElementById("tabs-content");if(!t)return void console.error("Tabs content container not found!");o=document.createElement("div"),o.id=`${e}-content`,o.className="tabs-panel w-full",t.appendChild(o)}if(document.querySelectorAll(".tabs-panel").forEach(e=>{e.classList.add("hidden")}),o.classList.remove("hidden"),"editor"===n.type||"search"===n.type){console.log("Handling editor/search tab");const e=document.getElementById("fileManagerUI");e?(console.log("Hiding fileManagerUI"),e.style.display="none"):console.warn("fileManagerUI element not found");const t=o.querySelector(".editor-container");t&&(t.style.height="90vh",t.style.width="100%",window.editor&&setTimeout(()=>window.editor.refresh(),10))}else{const e=document.getElementById("fileManagerUI"),o=document.getElementById("file");e?(console.log("Showing fileManagerUI"),e.style.display="block",o&&o.classList.remove("hidden"),r=n.path,updateCurrentPath(),loadDirectory(r,1,t,l,i)):console.warn("fileManagerUI element not found")}},window.addNewTab=function(e=null,t="filemanager"){const n=`tab-${Date.now()}`;return fileManagerState.tabs.forEach(e=>e.active=!1),fileManagerState.tabs.push({id:n,path:r,active:!0,name:e||D(r),type:t}),fileManagerState.activeTabId=n,T(),u(),n},window.updateActiveTabPath=function(e){const t=fileManagerState.tabs.find(e=>e.id===fileManagerState.activeTabId);t&&(t.path=e,t.name=D(e),T(),u())},$("#bulkActions").change(function(){const e=$(this).val();setTimeout(()=>{$(this).val("")},100);const n=()=>{const e=document.querySelectorAll(".file-checkbox:checked"),t=[];return e.forEach(e=>{const n=e.dataset.fullPath||e.dataset.file;n&&t.push(n)}),t},o=n();if(console.log("Bulk action triggered:",e),console.log("Selected files:",o),console.log("Selected files count:",o.length),0!==o.length||"paste"===e)switch(e){case"delete":I("Delete Files",`Are you sure you want to delete ${o.length} file(s)?`,"Delete",()=>{const e=n();e.length>0?(console.log("Sending files for deletion:",e),z({action:"delete",files:e,onSuccess:()=>{clearFileSelection(),triggerAlert("success","Files deleted successfully"),loadDirectory(r,1,t,l,i)}})):triggerAlert("warning","No files selected for deletion.")});break;case"zip":!function(e,t,n,r="",o){const a=document.documentElement.classList.contains("dark"),i=a?"bg-gray-800 text-white border-gray-700":"bg-white text-gray-900 border-gray-300";Swal.fire({title:e,html:`\n                <div class="flex flex-col space-y-4">\n                    <div class="w-full">\n                        <label for="zipFileName" class="text-sm font-medium block mb-1">\n                            ${t}\n                        </label>\n                        <input id="zipFileName" type="text" value="${r}" \n                               class="w-full p-2 border rounded ${i}">\n                    </div>\n                    <div class="w-full">\n                        <label for="compressionLevel" class="text-sm font-medium block mb-1">\n                            Compression Level:\n                        </label>\n                        <select id="compressionLevel" class="w-full p-2 border rounded ${i}">\n                            <option value="0">Store only (no compression)</option>\n                            <option value="1">Fastest (lowest compression)</option>\n                            <option value="5" selected>Normal (balanced)</option>\n                            <option value="9">Maximum (slowest)</option>\n                        </select>\n                    </div>\n                    <div class="w-full">\n                        <label for="archiveFormat" class="text-sm font-medium block mb-1">\n                            Archive Format:\n                        </label>\n                        <select id="archiveFormat" class="w-full p-2 border rounded ${i}">\n                            <option value="zip" selected>ZIP (.zip)</option>\n                            <option value="tar">TAR (.tar)</option>\n                            <option value="tar.gz">TAR GZ (.tar.gz)</option>\n                            <option value="tar.bz2">TAR BZ2 (.tar.bz2)</option>\n                            <option value="tar.xz">TAR XZ (.tar.xz)</option>\n                            <option value="gz">GZIP (.gz)</option>\n                        </select>\n                    </div>\n                </div>\n            `,focusConfirm:!1,showCancelButton:!0,confirmButtonText:n,cancelButtonText:"Cancel",customClass:{popup:a?"bg-gray-800 text-white":"bg-white text-gray-900",confirmButton:"bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded",cancelButton:"bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded mr-2"},preConfirm:()=>{const e=document.getElementById("zipFileName").value,t=document.getElementById("compressionLevel").value,n=document.getElementById("archiveFormat").value;return e?{zipFileName:e,compressionLevel:t,archiveFormat:n}:(Swal.showValidationMessage("Please enter a filename"),!1)}}).then(e=>{e.isConfirmed&&e.value&&o(e.value)})}("Create Zip Archive","Enter the name for the zip file:","Create","archive.zip",e=>{if(e){const o=n();if(0===o.length)return void triggerAlert("warning","No files selected for archiving.");const a=e.archiveFormat;let s=e.zipFileName;s.toLowerCase().endsWith("."+a)||(s.includes(".")&&(s=s.substring(0,s.lastIndexOf("."))),s+="."+a),e.zipFileName=s,z({action:"zip",files:o,options:e,onSuccess:()=>{clearFileSelection(),triggerAlert("success","Archive created successfully"),loadDirectory(r,1,t,l,i)}})}});break;case"unzip":if(o.length>1){const e=o.map(e=>{const t=e.split(".").pop().toLowerCase();if(["gz","bz2","xz"].includes(t)){if(e.substring(0,e.lastIndexOf(".")).toLowerCase().endsWith(".tar"))return`tar.${t}`}return t});if(!e.every(t=>t===e[0]))return void I("Warning: Different Archive Types","You've selected different types of archives. This may cause extraction issues. Continue anyway?","Continue",()=>{const e=n();e.length>0&&z({action:"unzip",files:e,onSuccess:()=>{clearFileSelection(),triggerAlert("success","Archives extracted successfully"),loadDirectory(r,1,t,l,i)}})})}I("Extract Archive",o.length>1?`Extract ${o.length} archives to the current directory?`:`Extract "${o[0]}" to the current directory?`,"Extract",()=>{const e=n();e.length>0&&z({action:"unzip",files:e,onSuccess:()=>{clearFileSelection(),triggerAlert("success","Archives extracted successfully"),loadDirectory(r,1,t,l,i)}})});break;case"copy":if(o.length>0){const e=o.map(e=>e.includes("/")?e:`${r}/${e}`);localStorage.setItem("copiedFiles",JSON.stringify(e)),triggerAlert("success",`${o.length} file(s) copied to clipboard`)}break;case"paste":try{const e=JSON.parse(localStorage.getItem("copiedFiles")||"[]");e.length>0?z({action:"paste",files:e,onSuccess:()=>{clearFileSelection(),triggerAlert("success","Files pasted successfully"),loadDirectory(r,1,t,l,i),localStorage.removeItem("copiedFiles")}}):triggerAlert("warning","No files in clipboard to paste")}catch(e){console.error("Error reading clipboard:",e),triggerAlert("error","Failed to read clipboard data")}break;default:console.log("Unknown action:",e)}else triggerAlert("info","No files selected! Please select files to perform bulk actions.")});const q=document.getElementById("dropZone"),N=document.getElementById("fileInput"),H=document.getElementById("uploadForm"),O=document.getElementById("uploadProgress"),R=document.getElementById("progressBar"),_=document.getElementById("progressText");if(q&&N&&H&&O&&R&&_){function te(e){e.preventDefault(),e.stopPropagation()}function ne(e){const t=e.dataTransfer.files;t.length>0&&(N.files=t,c=r,re(c))}function re(e){O.classList.remove("hidden"),R.style.width="0%",_.textContent="Uploading...";const n=new FormData(H);n.append("updir",r),n.append("csrf",t),fetch("",{method:"POST",body:n}).then(e=>e.json()).then(e=>{e.success?(_.textContent="Upload complete!",setTimeout(()=>O.classList.add("hidden"),3e3),loadDirectory(r,1,t,l,i)):_.textContent=e.error||"Upload failed. Please try again."}).catch(e=>{_.textContent="Upload failed. Please try again.",console.error("Error:",e)})}["dragenter","dragover","dragleave","drop"].forEach(e=>{q.addEventListener(e,te,!1)}),["dragenter","dragover"].forEach(e=>{q.addEventListener(e,()=>q.classList.add("bg-blue-50","dark:bg-gray-600"),!1)}),["dragleave","drop"].forEach(e=>{q.addEventListener(e,()=>q.classList.remove("bg-blue-50","dark:bg-gray-600"),!1)}),q.addEventListener("drop",ne,!1),N.addEventListener("change",re),q.addEventListener("click",()=>N.click())}function V(e,t,n,r,o){if(progr(),console.log("Saving file content for:",e),!t)return triggerAlert("warning","File content is empty."),void dprogr();if(!e)return triggerAlert("warning","No file path specified."),void dprogr();const a=document.querySelector(`[data-file-path="${e}"]`);let i="";if(a){const e=a.id.replace("-content",""),t=document.getElementById(`file-type-select-${e}`);t&&(i=t.value)}sendRequest({csrf:n,action:"save_content",file:e,content:t,file_type:i},r,o).then(e=>{console.log("File saved successfully:",e),triggerAlert("success","File saved successfully"),dprogr()}).catch(e=>{console.error("Error saving file:",e),triggerAlert("danger","Failed to save file: "+e),dprogr()})}function U(e){switch(e.split(".").pop().toLowerCase()){case"js":return"javascript";case"php":return"php";case"html":case"htm":return"htmlmixed";case"css":return"css";case"json":return"application/json";case"xml":return"xml";case"md":return"markdown";case"py":return"python";case"rb":return"ruby";case"java":return"text/x-java";case"c":return"text/x-csrc";case"cpp":case"cc":case"h":case"hpp":return"text/x-c++src";case"cs":return"text/x-csharp";case"go":return"text/x-go";case"rs":return"text/x-rustsrc";case"ts":return"text/typescript";case"sql":return"sql";case"sh":case"bash":return"shell";case"yml":case"yaml":return"yaml";case"txt":return"text";default:return"plaintext"}}document.addEventListener("click",function(e){if(e.target.classList.contains("file-link")){e.preventDefault();!function(e,t,n,r){progr(),console.log("ViewEditFile called for:",e);try{const o=P(e.split("/").pop(),"editor");function a(a){a.dataset.filePath=e;const i=document.getElementById("fileManagerUI");i&&i.classList.add("hidden"),a.classList.remove("hidden");const l=document.createElement("div");l.className="editor-container",l.style.width="100%",l.style.height="90vh",l.style.border="1px solid #ddd",l.style.position="relative",a.appendChild(l);const s=document.createElement("div");s.className="file-type-selector fixed top-4 right-4 z-50",s.innerHTML=`\n                    <select id="file-type-select-${o}" class="bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded px-3 py-2 text-sm">\n                        <option value="">Auto-detect</option>\n                        <option value="javascript">JavaScript</option>\n                        <option value="php">PHP</option>\n                        <option value="htmlmixed">HTML</option>\n                        <option value="css">CSS</option>\n                        <option value="application/json">JSON</option>\n                        <option value="xml">XML</option>\n                        <option value="markdown">Markdown</option>\n                        <option value="python">Python</option>\n                        <option value="text/x-java">Java</option>\n                        <option value="text/x-csrc">C</option>\n                        <option value="text/x-c++src">C++</option>\n                        <option value="sql">SQL</option>\n                        <option value="shell">Shell/Bash</option>\n                        <option value="yaml">YAML</option>\n                        <option value="text">Plain Text</option>\n                    </select>\n                `,a.appendChild(s),sendRequest({csrf:t,action:"view_content",file:e},n,r).then(i=>{if(console.log("File content fetched successfully, length:",i.content?.length),"undefined"==typeof CodeMirror)return console.error("CodeMirror is not defined!"),l.innerHTML=`<pre style="white-space: pre-wrap; padding: 1rem;">${i.content}</pre>`,triggerAlert("warning","CodeMirror not found. Displaying content in plain text mode."),void dprogr();const s=i.file_type||U(e),c=CodeMirror(l,{value:i.content||"",mode:s,theme:document.documentElement.classList.contains("dark")?"dracula":"eclipse",lineNumbers:!0,lineWrapping:!0,matchBrackets:!0,autoCloseBrackets:!0,styleActiveLine:!0});window.editor=c,c.setSize("100%","100%");const d=document.getElementById(`file-type-select-${o}`);if(d){Array.from(d.options).find(e=>e.value===s)&&(d.value=s),d.addEventListener("change",()=>{const o=d.value||U(e);c.setOption("mode",o),sendRequest({csrf:t,action:"view_content",file:e,file_type:o},n,r),setTimeout(()=>c.refresh(),50)})}let u=a.querySelector(".save-file-btn");u||(u=document.createElement("button"),u.className="save-file-btn fixed bottom-4 right-4 bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded shadow-lg z-50",u.innerHTML='<i class="fas fa-save mr-2"></i> Save',u.addEventListener("click",()=>{const o=c.getValue();V(e,o,t,n,r)}),a.appendChild(u)),setTimeout(()=>{c&&(c.refresh(),c.focus())},100),dprogr()}).catch(e=>{console.error("Error fetching file content:",e),l.innerHTML='<div class="p-4 text-red-500">Failed to load file content: '+e+"</div>",dprogr()})}console.log("Created new tab with ID:",o),setTimeout(()=>{const e=document.querySelector(`#${o}-content`);if(!e){console.error("Tab content not found for ID:",`${o}-content`);const e=document.getElementById("tabs-content");if(console.log("Tabs content element found:",!!e),e){console.log("Creating tab content manually");const t=document.createElement("div");t.id=`${o}-content`,t.className="tabs-panel w-full",e.appendChild(t),a(t)}else dprogr(),triggerAlert("warning","Failed to create editor tab. Try refreshing the page.");return}a(e)},100)}catch(i){console.error("Error in viewEditFile:",i),dprogr()}}(e.target.dataset.file,t,l,i)}}),function(){const e=document.getElementById("cancelEdit"),n=document.getElementById("cancelEditBtn"),r=document.getElementById("editorLanguage"),o=document.getElementById("saveFile");e&&e.addEventListener("click",function(){const e=document.getElementById("editorModal");e&&e.classList.add("hidden")}),n&&n.addEventListener("click",function(){const e=document.getElementById("editorModal");e&&e.classList.add("hidden")}),r&&r.addEventListener("change",function(){if(window.editor){const e=this.value,t={javascript:"javascript",php:"php",html:"htmlmixed",css:"css",json:"javascript",plaintext:"null"}[e]||"null";window.editor.setOption("mode",t);const n=document.getElementById("editorStatus");n&&(n.textContent=`Language changed to ${e}`)}}),o&&o.addEventListener("click",function(){const e=window.editor?window.editor.getValue():"",n=document.getElementById("editorModal"),r=n&&n.dataset.filePath?n.dataset.filePath:"",o=document.getElementById("editorStatus");o&&(o.textContent="Saving..."),V(r,e,t,l,i)})}();function j(){const e=document.querySelector('[role="tab"][aria-selected="true"]')?.getAttribute("data-tabs-target"),t=document.querySelector(".mb-4.border-b.border-gray-200.dark\\:border-gray-700"),n=document.getElementById("breadcrumbs");e&&t&&n?"#terminal"===e||"#config"===e||"#setting"===e?(t.classList.add("hidden"),n.classList.add("hidden")):(t.classList.remove("hidden"),n.classList.remove("hidden")):console.warn("Could not find all required elements for navigation toggle")}function J(){f="",h=0,b=0,w=0,k="",y=!1}function K(){$("line.current bl").remove(),$("line.current").removeClass("current")}function W(){$("terminal content").append('<line class="current"><path>'+m+"</path> <sp></sp> <t><bl></bl></t></line>")}function X(){let e=$("line.current t").html(),t=1==e.split(" ").length?"<cm>"+e+"</cm>":"<cm>"+e.split(" ")[0]+"</cm> <code>"+e.split(" ").slice(1).join(" ").replace(/</g,"&lt;").replace(/>/g,"&gt;")+"</code>";$("line.current t").html(t.replace("&lt;bl&gt;&lt;/bl&gt;","<bl></bl>"))}function Z(e=""){""===e?e=f:b=0;let t=e.substr(0,e.length+b),n=e.substr(e.length+b);$("line.current t").html(t+"<bl></bl>"+n)}window.initializeEditor=function(e,t="plaintext",n="editorContainer"){progr();const r=document.getElementById(n);if(!r)return console.error("Editor container not found:",n),void dprogr();const o=document.documentElement.classList.contains("dark")?"dracula":"eclipse";try{const a={"Ctrl-S":function(e){const t=r.closest('[id$="-content"]');if(t){const e=t.querySelector(".save-file-btn");e&&e.click()}else{const e=document.getElementById("saveFile");e&&e.click()}return!1},"Ctrl-F":"findPersistent","Ctrl-H":"replace","Ctrl-/":"toggleComment",Tab:function(e){return e.somethingSelected()?e.indentSelection("add"):e.replaceSelection("    ","end"),!0},"Shift-Tab":function(e){return e.indentSelection("subtract"),!0},"Ctrl-Q":function(e){return e.foldCode(e.getCursor()),!1},Esc:function(e){return e.getOption("fullScreen")&&e.setOption("fullScreen",!1),!1}};r.innerHTML="";const i=CodeMirror(r,{value:e||"",mode:t,theme:o,lineNumbers:!0,indentUnit:4,smartIndent:!0,indentWithTabs:!1,lineWrapping:!0,matchBrackets:!0,autoCloseBrackets:!0,autoCloseTags:!0,styleActiveLine:!0,selectionPointer:!0,tabSize:parseInt(localStorage.getItem("tab-size")||"4"),extraKeys:a,scrollbarStyle:"native",undoDepth:200,historyEventDelay:200});window.editor=i,i.setSize("100%","100%"),setTimeout(()=>{i&&i.focus()},100),setTimeout(()=>{i&&i.refresh()},50),console.log(`CodeMirror editor initialized with mode: ${t} in container: ${n}`)}catch(e){console.error("Error initializing CodeMirror editor:",e),triggerAlert("warning","Failed to initialize the editor. Please try again.")}finally{dprogr()}},window.createEditor=function(e,t){if(console.log("createEditor called - redirecting to initializeEditor"),"function"!=typeof window.initializeEditor)return console.error("initializeEditor function not found"),void triggerAlert("warning","Editor initialization failed. Please refresh the page.");if(!document.getElementById("editorContainer"))return console.error("Editor container not found"),void triggerAlert("warning","Editor container not found in DOM. Please refresh the page.");try{window.initializeEditor(e,t)}catch(e){console.error("Error in createEditor:",e),triggerAlert("warning","Failed to initialize editor. Please try again.")}},$(document).ready(function(){function e(e){var t="number"==typeof e.which?e.which:e.keyCode;8===t||9===t||46===t?(e.preventDefault(),""!==f&&(8===t?function(){0!==w&&(w=0,f=k);let e=f.substr(0,f.length+b),t=f.substr(f.length+b);f=e.substr(0,e.length-1)+t,Z(),X()}():46===t?function(){let e=f.substr(0,f.length+b),t=f.substr(f.length+b);f=e+t.substr(1),0!==b&&b++;Z(),X()}():9===t&&function(){if(v!==f)if(v=f,x=[],1===f.split(" ").length){let e=S.concat(Object.keys(Q));x=e.filter(function(e){return e.length>f.length&&e.substr(0,f.length).toLowerCase()==f.toLowerCase()}).reverse().sort(function(e,t){return t.length-e.length})}else if(2===f.split(" ").length){let t=f.split(" ")[0],n=f.split(" ")[1];var e="";if("cd"===t||"cp"===t||"mv"===t||"cat"===t){switch(t){case"cd":case"cp":case"mv":e="ls -d "+n+"*/";break;case"cat":e="ls -p | grep -v /";break;default:e=""}$.ajax({type:"POST",async:!1,data:{command:e,path:m},cache:!1,success:function(e){e=$.parseJSON(e),x=e.result.split("<br>").filter(function(e){return 0!==e.length})}})}}x.length&&x.length>Math.abs(w)?(w--,Z(k=(2===f.split(" ").length?f.split(" ")[0]+" ":"")+x[x.length+w]),X()):(w=0,k="",Z(),X())}())):e.ctrlKey&&67===t?(w=0,K(),W(),J()):13===t?(0!==w&&(w=0,f=k),f.toLowerCase().split(" ")[0]in Q?Q[f.toLowerCase().split(" ")[0]](f.split(" ").slice(1)):0!==f.length&&$.ajax({type:"POST",async:!1,data:{command:f,path:m},cache:!1,success:function(e){e=$.parseJSON(e),m=e.path,$("terminal content").append("<line><br>"+e.result+"</line>")}}),K(),function(e){e.length>=2&&(0===p.length||p[p.length-1]!==e)&&(p[p.length]=e)}(f),W(),J(),$("terminal content").scrollTop($("terminal content").prop("scrollHeight"))):35!==t&&36!==t&&37!==t&&39!==t||""===f?38!==t&&40!==t||""!==f&&!y?(32===t||222===t||220===t||t>=45&&t<=195&&!(t>=112&&t<=123)&&46!=t&&91!=t&&93!=t&&144!=t&&145!=t&&45!=t)&&(!function(e){h=0,y=!1,0!==w&&(w=0,f=k);if("/"===f[f.length-1]&&"/"===e)return;let t=f.substr(0,f.length+b),n=f.substr(f.length+b);f=t+e+n,Z(),X()}(e.key),$("terminal content").scrollTop($("terminal content").prop("scrollHeight"))):(e.preventDefault(),38===t&&p.length&&p.length>=-1*h+1?(h--,f=p[p.length+h],Z(),X(),y=!0):40===t&&p.length&&p.length>=-1*h&&0!==h&&(h++,f=0===h?"":p[p.length+h],Z(),X(),y=0!==h)):(e.preventDefault(),$("line.current bl").remove(),0!==w&&(w=0,f=k),35===t&&(b=0),36===t&&(b=-1*f.length),37===t&&f.length!==Math.abs(b)&&b--,39===t&&0!==b&&b++,Z(),X())}function n(){$("#terminal").is(":visible")?$(document).on("keydown",e):$(document).off("keydown",e)}window.fileManagerState?window.fileManagerState.currentSort||(window.fileManagerState.currentSort={column:"name",direction:"asc"}):window.fileManagerState={files:[],totalPages:1,currentPage:1,currentSort:{column:"name",direction:"asc"},selectedFiles:[],tabs:[{id:"tab-1",path:r,active:!0,name:"Home"}],activeTabId:"tab-1"},loadDirectory(r,1,t,l,i),setTimeout(function(){const{column:e,direction:t}=window.fileManagerState.currentSort;$("th[data-sort]").find("i.fas").removeClass("fa-sort-up fa-sort-down").addClass("fa-sort");const n=$(`th[data-sort="${e}"]`);if(n.length){const e=n.find("i.fas");e.removeClass("fa-sort"),e.addClass("asc"===t?"fa-sort-up":"fa-sort-down")}},500),n(),window.updateKeydownListener=n,$("[data-tabs-target]").on("click",function(){setTimeout(()=>{window.updateKeydownListener&&window.updateKeydownListener()},100)})}),document.addEventListener("DOMContentLoaded",function(){j(),document.querySelectorAll("[data-tabs-target]").forEach(e=>{e.addEventListener("click",function(){setTimeout(j,50)})});const e=new MutationObserver(e=>{e.forEach(e=>{"aria-selected"===e.attributeName&&j()})});document.querySelectorAll('[role="tab"]').forEach(t=>{e.observe(t,{attributes:!0,attributeFilter:["aria-selected"]})})}),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",j):j();var Q={clear:function(){$("terminal content").html("")},history:function(e){var t=[];let n=e.length&&Number.isInteger(Number(e[0]))?Number(e[0]):0;if(0!=n&&n<=p.length)for(var r=p.length-n;r<p.length;r++)t[t.length]=r+1+" &nbsp;"+p[r];else p.forEach(function(e,n){t[t.length]=n+1+" &nbsp;"+e});$("terminal content").append("<line>"+t.join("<br>")+"</line>")}};updateCurrentPath(),document.getElementById("itemLimit").addEventListener("change",e=>{const n=e.target.value;console.log("Items per page changed to:",n),localStorage.setItem("default-items-per-page",n),window.fileManagerState.currentPage=1,loadDirectory(r,1,t,l,i,n)}),document.addEventListener("click",function(e){e.target.classList.contains("codeme")&&function(e,t,n,r,o){const a=document.documentElement.classList.contains("dark");Swal.fire({title:"Execute PHP Code",html:'\n                <div class="flex flex-col w-full">\n                    <label for="php-code-input" class="text-left mb-2 text-gray-700 dark:text-gray-300 text-sm font-medium">Enter the PHP code to execute:</label>\n                    <textarea id="php-code-input" rows="8" class="w-full p-3 text-gray-800 dark:text-gray-200 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50 font-mono text-sm"></textarea>\n                </div>\n            ',showCancelButton:!0,confirmButtonText:"Execute",cancelButtonText:"Cancel",customClass:{popup:"dark:bg-gray-800 dark:text-gray-200",title:"text-gray-800 dark:text-gray-200",confirmButton:"bg-blue-600 hover:bg-blue-700 text-white",cancelButton:"bg-gray-500 hover:bg-gray-600 text-white"},background:a?"#1F2937":"#FFFFFF",focusConfirm:!1,preConfirm:()=>{const e=document.getElementById("php-code-input").value;return e&&""!==e.trim()?e:(Swal.showValidationMessage("Please enter PHP code to execute"),!1)}}).then(e=>{if(e.isConfirmed&&e.value){const i=e.value;sendRequest({csrf:t,action:"execute",code:i.trim(),dir:n},r,o).then(e=>{Swal.fire({title:"PHP Execution Result",html:`<div class="bg-white dark:bg-gray-800 rounded-lg p-4 shadow-md">\n                                    <pre class="text-left overflow-auto max-h-96 text-gray-800 dark:text-gray-200 font-mono text-sm bg-gray-100 dark:bg-gray-700 p-4 rounded">${e.output}</pre>\n                                  </div>`,icon:"info",confirmButtonText:"Close",customClass:{popup:"dark:bg-gray-800 dark:text-gray-200",title:"text-gray-800 dark:text-gray-200",confirmButton:"bg-blue-600 hover:bg-blue-700 text-white",htmlContainer:"p-0"},background:a?"#1F2937":"#FFFFFF",iconColor:"#3B82F6"})}).catch(e=>{triggerAlert("warning",e),console.error("Error executing PHP code:",e)})}})}(0,t,r,l,i)})}),window.initEditorLanguageSelector=function(){const e=document.getElementById("editorLanguage");e&&!e.dataset.initialized&&(e.addEventListener("change",function(){const e=this.value;if(window.editor&&e)try{window.editor.setOption("mode",e),console.log("Editor mode changed to:",e);const t=document.getElementById("editorStatus");if(t){const n=(t.textContent||"").replace(/\|.*\|/,`| ${e} |`);t.textContent=n}}catch(e){console.error("Error changing editor mode:",e)}}),e.dataset.initialized="true",console.log("Editor language selector initialized"))},document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll("[data-tabs-target]").forEach(e=>{e.addEventListener("click",function(){i(this.getAttribute("data-tabs-target"))})});const e=document.querySelector('[role="tab"][aria-selected="true"]');i(e?e.getAttribute("data-tabs-target"):"#file")}),window.showConfirmation="function"==typeof showConfirmation?showConfirmation:function(){console.error("showConfirmation not found")},window.diagnoseFunctions=function(){console.log("--- Function Diagnostic Report ---"),console.log("updateSelectedFiles:","function"==typeof window.updateSelectedFiles?"Available ":"Missing "),console.log("saveToLocalStorage:","function"==typeof window.saveToLocalStorage?"Available ":"Missing "),console.log("getFromLocalStorage:","function"==typeof window.getFromLocalStorage?"Available ":"Missing "),console.log("freeclipbroad:","function"==typeof window.freeclipbroad?"Available ":"Missing "),console.log("performBulkAction:","function"==typeof window.performBulkAction?"Available ":"Missing "),console.log("renameFile:","function"==typeof window.renameFile?"Available ":"Missing "),console.log("loadDirectory:","function"==typeof window.loadDirectory?"Available ":"Missing "),console.log("triggerAlert:","function"==typeof window.triggerAlert?"Available ":"Missing "),console.log("showConfirmation:","function"==typeof window.showConfirmation?"Available ":"Missing "),console.log("showAdvancedSearch:","function"==typeof window.showAdvancedSearch?"Available ":"Missing "),console.log("--- fileManagerState Report ---"),console.log("fileManagerState:",window.fileManagerState?"Available ":"Missing "),window.fileManagerState&&(console.log("selectedFiles:",Array.isArray(window.fileManagerState.selectedFiles)?`Available  (${window.fileManagerState.selectedFiles.length} items)`:"Missing "),console.log("currentDir:",window.fileManagerState.currentDir||"Not set")),console.log("--- phpVars Report ---"),console.log("phpVars:",window.phpVars?"Available ":"Missing "),window.phpVars&&(console.log("csrf:",window.phpVars.csrf?"Available ":"Missing "),console.log("isEnc:",void 0!==window.phpVars.isEnc?"Available ":"Missing "),console.log("encryptionKey:",window.phpVars.encryptionKey?"Available ":"Missing "))},document.addEventListener("DOMContentLoaded",function(){e(),t(),n(),o(),a(),"undefined"==typeof phpVars||window.phpVars?window.phpVars||console.warn("phpVars not found in global scope"):(window.phpVars=phpVars,console.log("phpVars initialized globally")),document.querySelector(".advanced-search")?.addEventListener("click",function(){"function"==typeof window.showAdvancedSearch?window.showAdvancedSearch():(console.error("Advanced search function not found"),triggerAlert("warning","Advanced search feature is not available"))})}),window.saveTabsToLocalStorage=function(){try{const e=fileManagerState.tabs.map(e=>({id:e.id,path:e.path,active:e.active,name:e.name,type:e.type||"filemanager"}));localStorage.setItem("fileManager_activeTabId",fileManagerState.activeTabId),localStorage.setItem("fileManager_tabs",JSON.stringify(e))}catch(e){console.error("Error saving tabs to localStorage:",e)}},window.loadTabsFromLocalStorage=function(){try{const e=localStorage.getItem("fileManager_tabs");if(!e)return console.log("No saved tabs found in localStorage"),!1;const t=JSON.parse(e);if(!Array.isArray(t)||0===t.length)return console.log("Invalid or empty tabs data in localStorage"),!1;const n=localStorage.getItem("fileManager_activeTabId");return fileManagerState.tabs=t,n&&fileManagerState.tabs.find(e=>e.id===n)?(fileManagerState.activeTabId=n,fileManagerState.tabs.forEach(e=>{e.active=e.id===n})):(fileManagerState.tabs[0].active=!0,fileManagerState.activeTabId=fileManagerState.tabs[0].id),!0}catch(e){return console.error("Error loading tabs from localStorage:",e),!1}},document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("network-tab");e&&e.addEventListener("click",function(){!function(){const e=document.getElementById("portScannerForm");e&&e.addEventListener("submit",function(e){e.preventDefault(),function(){const e=document.getElementById("hostInput").value,t=parseInt(document.getElementById("startPortInput").value),n=parseInt(document.getElementById("endPortInput").value),r=parseInt(document.getElementById("timeoutInput").value),o=document.getElementById("commonPortsOnly").checked;if(!e)return void triggerAlert("warning","Please enter a host/IP address");const a=document.getElementById("portScanResults"),i=document.getElementById("scanStatus"),l=document.getElementById("portScanResultsBody");a.classList.remove("hidden"),i.textContent=`Scanning ${e}...`,l.innerHTML='<tr><td colspan="3" class="text-center py-2">Scanning...</td></tr>';c("port_scan",{host:e,start_port:t,end_port:n,timeout:r,common_ports_only:o}).then(e=>{if(e.error)return triggerAlert("warning",e.error),i.textContent=`Scan failed: ${e.error}`,void(l.innerHTML='<tr><td colspan="3" class="text-center py-2 text-red-500">Scan failed</td></tr>');i.textContent=`Scan completed for ${e.host}`,l.innerHTML="";const t=e.results.filter(e=>"open"===e.status),n=e.results.filter(e=>"closed"===e.status);if(0===t.length)l.innerHTML='<tr><td colspan="3" class="text-center py-2">No open ports found</td></tr>';else if(t.forEach(e=>{const t=document.createElement("tr");t.innerHTML=`\n                            <td class="px-4 py-2">${e.port}</td>\n                            <td class="px-4 py-2"><span class="px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">open</span></td>\n                            <td class="px-4 py-2">${e.service||"unknown"}</td>\n                        `,l.appendChild(t)}),n.length>0){const e=document.createElement("tr");e.innerHTML=`\n                            <td colspan="3" class="px-4 py-2 text-gray-500 italic">${n.length} port(s) closed or filtered</td>\n                        `,l.appendChild(e)}}).catch(e=>{triggerAlert("warning","Error performing port scan"),i.textContent="Scan failed",l.innerHTML='<tr><td colspan="3" class="text-center py-2 text-red-500">Error connecting to server</td></tr>'})}()});const t=document.getElementById("getNetworkInfo");t&&t.addEventListener("click",function(){!function(){const e=document.getElementById("networkInfoResults");e.classList.remove("hidden"),e.innerHTML='<div class="text-center py-2">Loading network information...</div>',c("network_info",{}).then(t=>{if(t.error)return triggerAlert("warning",t.error),void(e.innerHTML=`<div class="text-center py-2 text-red-500">${t.error}</div>`);let n='<div class="space-y-4">';0===t.interfaces.length?n+='<div class="text-center py-2">No network interfaces found</div>':t.interfaces.forEach(e=>{n+=`\n                            <div class="border-b pb-3 dark:border-gray-600">\n                                <h4 class="font-medium text-gray-800 dark:text-gray-200">${e.name}</h4>\n                                <div class="mt-2">\n                        `,0===e.addresses.length?n+='<p class="text-sm text-gray-600 dark:text-gray-400">No addresses</p>':e.addresses.forEach(e=>{n+=`\n                                    <div class="flex flex-col text-sm">\n                                        <span class="text-gray-700 dark:text-gray-300">\n                                            <span class="font-medium">${e.family}:</span> ${e.address}\n                                        </span>\n                                        <span class="text-gray-600 dark:text-gray-400">\n                                            Netmask: ${e.netmask||"N/A"}\n                                        </span>\n                                    </div>\n                                `}),n+="</div></div>"}),n+="</div>",e.innerHTML=n}).catch(t=>{triggerAlert("warning","Error getting network information"),e.innerHTML='<div class="text-center py-2 text-red-500">Error connecting to server</div>'})}()});const n=document.getElementById("getArpTable");n&&n.addEventListener("click",function(){!function(){const e=document.getElementById("arpTableResults");e.classList.remove("hidden"),e.innerHTML='<div class="text-center py-2">Loading ARP table...</div>',c("arp_table",{}).then(t=>{if(t.error)return triggerAlert("warning",t.error),void(e.innerHTML=`<div class="text-center py-2 text-red-500">${t.error}</div>`);if(0===t.arp_table.length)return void(e.innerHTML='<div class="text-center py-2">No ARP entries found</div>');let n='\n                    <table class="w-full text-sm text-left text-gray-500 dark:text-gray-400">\n                        <thead class="text-xs text-gray-700 uppercase bg-gray-100 dark:bg-gray-800 dark:text-gray-400">\n                            <tr>\n                                <th scope="col" class="px-4 py-2">IP Address</th>\n                                <th scope="col" class="px-4 py-2">MAC Address</th>\n                                <th scope="col" class="px-4 py-2">Interface</th>\n                            </tr>\n                        </thead>\n                        <tbody>\n                ';t.arp_table.forEach(e=>{n+=`\n                        <tr>\n                            <td class="px-4 py-2">${e.ip}</td>\n                            <td class="px-4 py-2">${e.mac}</td>\n                            <td class="px-4 py-2">${e.interface}</td>\n                        </tr>\n                    `}),n+="</tbody></table>",e.innerHTML=n}).catch(t=>{triggerAlert("warning","Error getting ARP table"),e.innerHTML='<div class="text-center py-2 text-red-500">Error connecting to server</div>'})}()});const r=document.getElementById("pingForm");r&&r.addEventListener("submit",function(e){e.preventDefault(),function(){const e=document.getElementById("pingHost").value,t=parseInt(document.getElementById("pingCount").value),n=parseInt(document.getElementById("pingTimeout").value);if(!e)return void triggerAlert("warning","Please enter a host/IP address");const r=document.getElementById("pingResults"),o=r.querySelector("div");r.classList.remove("hidden"),o.innerHTML='<div class="text-center py-2">Pinging '+e+"...</div>";c("ping",{host:e,count:t,timeout:n}).then(e=>{if(e.error)return triggerAlert("warning",e.error),void(o.innerHTML=`<div class="text-center py-2 text-red-500">${e.error}</div>`);let t="";e.results.forEach(e=>{t+=e+"<br>"}),o.innerHTML=t}).catch(e=>{triggerAlert("warning","Error performing ping"),o.innerHTML='<div class="text-center py-2 text-red-500">Error connecting to server</div>'})}()});const o=document.getElementById("dnsLookupForm");o&&o.addEventListener("submit",function(e){e.preventDefault(),function(){const e=document.getElementById("dnsHost").value,t=document.getElementById("dnsType").value;if(!e)return void triggerAlert("warning","Please enter a domain name");const n=document.getElementById("dnsResults"),r=n.querySelector("div");n.classList.remove("hidden"),r.innerHTML='<div class="text-center py-2">Looking up '+e+"...</div>";c("dns_lookup",{host:e,type:t}).then(n=>{if(n.error)return triggerAlert("warning",n.error),void(r.innerHTML=`<div class="text-center py-2 text-red-500">${n.error}</div>`);if(0===n.results.length)return void(r.innerHTML=`<div class="text-center py-2">No ${t} records found for ${e}</div>`);let o='<div class="space-y-4">';n.results.forEach(e=>{o+=`\n                        <div class="border-b pb-3 dark:border-gray-600">\n                            <h4 class="font-medium text-gray-800 dark:text-gray-200">${e.type} Record</h4>\n                            <div class="mt-2 space-y-1">\n                    `;const t=e.data;for(const[e,n]of Object.entries(t))"type"!==e&&"class"!==e&&(o+=`\n                                <div class="text-sm">\n                                    <span class="font-medium text-gray-700 dark:text-gray-300">${e}:</span>\n                                    <span class="text-gray-600 dark:text-gray-400">${n}</span>\n                                </div>\n                            `);o+="</div></div>"}),o+="</div>",r.innerHTML=o}).catch(e=>{triggerAlert("warning","Error performing DNS lookup"),r.innerHTML='<div class="text-center py-2 text-red-500">Error connecting to server</div>'})}()});const a=document.getElementById("tracerouteForm");a&&a.addEventListener("submit",function(e){e.preventDefault(),function(){const e=document.getElementById("tracerouteHost").value,t=parseInt(document.getElementById("tracerouteMaxHops").value),n=parseInt(document.getElementById("tracerouteTimeout").value);if(!e)return void triggerAlert("warning","Please enter a host/IP address");const r=document.getElementById("tracerouteResults"),o=r.querySelector("div");r.classList.remove("hidden"),o.innerHTML='<div class="text-center py-2">Tracing route to '+e+"...</div>";c("traceroute",{host:e,max_hops:t,timeout:n}).then(e=>{if(e.error)return triggerAlert("warning",e.error),void(o.innerHTML=`<div class="text-center py-2 text-red-500">${e.error}</div>`);let n='<div class="font-mono">';n+=`<div class="mb-2">Traceroute to ${e.host}, ${t} hops max:</div>`,e.results.forEach((e,t)=>{n+=`<div>${e}</div>`}),n+="</div>",o.innerHTML=n}).catch(e=>{triggerAlert("warning","Error performing traceroute"),o.innerHTML='<div class="text-center py-2 text-red-500">Error connecting to server</div>'})}()});const i=document.getElementById("whoisForm");i&&i.addEventListener("submit",function(e){e.preventDefault(),function(){const e=document.getElementById("whoisDomain").value;if(!e)return void triggerAlert("warning","Please enter a domain or IP address");const t=document.getElementById("whoisResults"),n=t.querySelector("div");t.classList.remove("hidden"),n.innerHTML='<div class="text-center py-2">Looking up WHOIS information for '+e+"...</div>";c("whois",{domain:e}).then(t=>{if(t.error)return triggerAlert("warning",t.error),void(n.innerHTML=`<div class="text-center py-2 text-red-500">${t.error}</div>`);t.results?n.textContent=t.results:n.innerHTML=`<div class="text-center py-2">No WHOIS information found for ${e}</div>`}).catch(e=>{triggerAlert("warning","Error performing WHOIS lookup"),n.innerHTML='<div class="text-center py-2 text-red-500">Error connecting to server</div>'})}()})}()})});
